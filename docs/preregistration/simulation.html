<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data simulation for preregistration – Home</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1f64a611174d0987db8176e27c99ed25.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../data/codebook.html"> 
<span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../literature_search/literature_search.html"> 
<span class="menu-text">Literature Search</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../preregistration/preregistration.html" aria-current="page"> 
<span class="menu-text">Preregistration</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/janpfander/meta_misinformation_interventions"> <i class="bi bi-github" role="img" aria-label="github">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../preregistration/simulation.html">Data simulation for preregistration</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title"><p>Data simulation for preregistration</p></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preregistration/preregistration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preregistration</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preregistration/simulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data simulation for preregistration</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#building-a-simulation-function" id="toc-building-a-simulation-function" class="nav-link" data-scroll-target="#building-a-simulation-function">Building a simulation function</a>
  <ul class="collapse">
  <li><a href="#data-generating-process" id="toc-data-generating-process" class="nav-link" data-scroll-target="#data-generating-process">Data generating process</a>
  <ul class="collapse">
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables">Variables</a></li>
  <li><a href="#design" id="toc-design" class="nav-link" data-scroll-target="#design">Design</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  </ul></li>
  <li><a href="#simulate-a-single-sample" id="toc-simulate-a-single-sample" class="nav-link" data-scroll-target="#simulate-a-single-sample">Simulate a single sample</a>
  <ul class="collapse">
  <li><a href="#stimuli-news-items" id="toc-stimuli-news-items" class="nav-link" data-scroll-target="#stimuli-news-items">Stimuli (news items)</a></li>
  <li><a href="#sujects" id="toc-sujects" class="nav-link" data-scroll-target="#sujects">Sujects</a></li>
  <li><a href="#trials-subjects-x-stimuli" id="toc-trials-subjects-x-stimuli" class="nav-link" data-scroll-target="#trials-subjects-x-stimuli">Trials (Subjects x Stimuli)</a></li>
  <li><a href="#function" id="toc-function" class="nav-link" data-scroll-target="#function">Function</a></li>
  </ul></li>
  <li><a href="#simulate-an-experiment" id="toc-simulate-an-experiment" class="nav-link" data-scroll-target="#simulate-an-experiment">Simulate an experiment</a>
  <ul class="collapse">
  <li><a href="#function-1" id="toc-function-1" class="nav-link" data-scroll-target="#function-1">Function</a></li>
  </ul></li>
  <li><a href="#simulate-various-experiments-within-a-single-paper" id="toc-simulate-various-experiments-within-a-single-paper" class="nav-link" data-scroll-target="#simulate-various-experiments-within-a-single-paper">Simulate various experiments (within a single paper)</a>
  <ul class="collapse">
  <li><a href="#function-2" id="toc-function-2" class="nav-link" data-scroll-target="#function-2">Function</a></li>
  </ul></li>
  <li><a href="#simulate-various-papers" id="toc-simulate-various-papers" class="nav-link" data-scroll-target="#simulate-various-papers">Simulate various papers</a>
  <ul class="collapse">
  <li><a href="#function-3" id="toc-function-3" class="nav-link" data-scroll-target="#function-3">Function</a></li>
  </ul></li>
  <li><a href="#model-accuracy-ratings" id="toc-model-accuracy-ratings" class="nav-link" data-scroll-target="#model-accuracy-ratings">Model accuracy ratings</a></li>
  </ul></li>
  <li><a href="#simulation-of-a-single-data-set-for-pre-registration" id="toc-simulation-of-a-single-data-set-for-pre-registration" class="nav-link" data-scroll-target="#simulation-of-a-single-data-set-for-pre-registration">Simulation of a single data set for pre-registration</a>
  <ul class="collapse">
  <li><a href="#add-moderators" id="toc-add-moderators" class="nav-link" data-scroll-target="#add-moderators">Add moderators</a>
  <ul class="collapse">
  <li><a href="#within-experiment-moderator" id="toc-within-experiment-moderator" class="nav-link" data-scroll-target="#within-experiment-moderator">Within-experiment moderator</a></li>
  <li><a href="#between-experiment-moderator" id="toc-between-experiment-moderator" class="nav-link" data-scroll-target="#between-experiment-moderator">Between-experiment moderator</a></li>
  </ul></li>
  <li><a href="#store-simulated-data" id="toc-store-simulated-data" class="nav-link" data-scroll-target="#store-simulated-data">Store simulated data</a></li>
  </ul></li>
  <li><a href="#sensitivity-analysis-and-parameter-recovery" id="toc-sensitivity-analysis-and-parameter-recovery" class="nav-link" data-scroll-target="#sensitivity-analysis-and-parameter-recovery">Sensitivity analysis and parameter recovery</a>
  <ul class="collapse">
  <li><a href="#estimator" id="toc-estimator" class="nav-link" data-scroll-target="#estimator">Estimator</a>
  <ul class="collapse">
  <li><a href="#define-the-model" id="toc-define-the-model" class="nav-link" data-scroll-target="#define-the-model">Define the model</a></li>
  <li><a href="#run-the-loop" id="toc-run-the-loop" class="nav-link" data-scroll-target="#run-the-loop">Run the loop</a></li>
  <li><a href="#run-the-meta-analysis" id="toc-run-the-meta-analysis" class="nav-link" data-scroll-target="#run-the-meta-analysis">Run the meta-analysis</a></li>
  </ul></li>
  <li><a href="#run-iterations" id="toc-run-iterations" class="nav-link" data-scroll-target="#run-iterations">Run iterations</a></li>
  </ul></li>
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis">Sensitivity analysis</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load plot theme</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/plot_theme.R"</span>) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load other functions</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/custom_functions.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a seed</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>We will generate participant-level data for a set different papers with different numbers of experiments.</p>
<p>This simulation involves three steps:</p>
<ol type="1">
<li>simulate data for a single experiment</li>
<li>simulate several experiments</li>
<li>simulate several papers</li>
</ol>
<p>To give an overview of the data generating task:</p>
<p>We model our dependent variable <code>accuracy</code> based on the variables <code>veracity</code> (false vs.&nbsp;true), <code>condition</code> (control vs.&nbsp;intervention), and their interaction. We have random effects for <code>subject_id</code>, <code>experiment_id</code> and <code>paper_id</code>.</p>
</section>
<section id="building-a-simulation-function" class="level1">
<h1>Building a simulation function</h1>
<section id="data-generating-process" class="level2">
<h2 class="anchored" data-anchor-id="data-generating-process">Data generating process</h2>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables">Variables</h3>
<ul>
<li><code>paper_id</code> (identifier of the published paper)</li>
<li><code>experiment_id</code> (identifier of experiments within a paper)</li>
<li><code>subject_id</code> (identifier of subjects within an experiment)</li>
<li><code>veracity</code> (true vs.&nbsp;fake news)</li>
<li><code>accuracy</code> (numeric accuracy rating, ranging from 0 to 1)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li><code>condition</code> (control vs.&nbsp;intervention)</li>
<li><code>n</code> (number of participants per sample)</li>
</ul>
</section>
<section id="design" class="level3">
<h3 class="anchored" data-anchor-id="design">Design</h3>
<p>The important parts of the design are:</p>
<ul>
<li>Random factors :
<ul>
<li><code>subject_id</code></li>
<li><code>experiment_id</code></li>
<li><code>paper_id</code></li>
</ul></li>
<li>Fixed factor 1: <code>veracity</code> (levels = false, true)
<ul>
<li>within subject_id</li>
<li>within experiment_id</li>
<li>within paper_id</li>
</ul></li>
<li>Fixed factor 2: <code>condition</code> (levels: control, intervention)
<ul>
<li>between subject_id</li>
<li>within experiment_id</li>
<li>within paper_id</li>
</ul></li>
<li>Fixed factor 3: <code>condition\*veracity</code>
<ul>
<li>between subject_id</li>
<li>within experiment_id</li>
<li>within paper_id</li>
</ul></li>
</ul>
<p>We assume that,</p>
<ul>
<li><code>veracity</code> varies <em>within</em> participants, i.e.&nbsp;all participants see both <code>fake</code> and <code>true</code> news</li>
<li><code>condition</code> varies <em>between</em> participants, i.e.&nbsp;a participant is either in the control group or a treatment group</li>
<li>an experiment involves only one control group, but a varying number of treatment groups (up to 3)</li>
<li>we assume <em>random effects</em> only for participants (<code>subject_id</code>), experiments (<code>experiment_id</code>) and papers (<code>paper_id</code>). We do <em>not</em> assume, random effects for different intervention types, nor for different news headlines</li>
<li>the sample size per experimental condition is 100</li>
<li>each participant rates 12 news items in total, with equal numbers of <code>fake</code> and <code>true</code> items</li>
</ul>
</section>
<section id="model" class="level3">
<h3 class="anchored" data-anchor-id="model">Model</h3>
<p>We use a generalized linear mixed model (GLMM) to generate accuracy responses. In this model, our parameters are z-values. For the interpretation of our model parameters below in terms of Signal Detection Theory (SDT) outcomes (sensitivity “d prime” and the response bias “c”), it is crucial that we use deviation coding for our veracity variable (fake = -0.5, true = 0.5), and for condition (-0.5 = control, 0.5 = intervention).</p>
<p><span class="math display">\[\begin{align*}
\eta_i &amp;= (\beta_0 + b_{0_\text{Subject}} + b_{0_\text{Experiment}} + b_{0_\text{Paper}}) \\
&amp;\quad+ (\beta_v + b_{v_\text{Subject}} + b_{v_\text{Experiment}} + b_{v_\text{Paper}}) \text{Veracity} \\
&amp;\quad+ (\beta_c + b_{c_\text{Experiment}} + b_{c_\text{Paper}}) \text{Condition} \\
&amp;\quad+ (\beta_{cv} + b_{cv_\text{Experiment}} + b_{cv_\text{Paper}}) \text{Condition*Veracity} + \epsilon
\end{align*}\]</span></p>
<p>with<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<ul>
<li>(b_{0_{}} N(0, _{_0}))</li>
<li>(b_{v_{}} N(0, _{_v}))</li>
<li>(b_{0_{}} N(0, _{_0}))</li>
<li>(b_{v_{}} N(0, _{_v}))</li>
<li>(b_{c_{}} N(0, _{_c}))</li>
<li>(b_{cv_{}} N(0, _{_cv}))</li>
<li>(b_{0_{}} N(0, _{_0}))</li>
<li>(b_{v_{}} N(0, _{_v}))</li>
<li>(b_{c_{}} N(0, _{_c}))</li>
<li>(b_{cv_{}} N(0, _{_cv}))</li>
<li>(N(0, ))</li>
</ul>
<p>where:</p>
<ul>
<li><p>_i is a z-score that can be transformed to a probability for an accuracy answer, using the probit function</p></li>
<li><p>(_0) represents - the average response bias (c), pooled across conditions</p></li>
<li><p>(b_{0_{}}), (b_{0_{}}), and (b_{0_{}}) are the subject-, experiment-, and paper-specific deviations from the average intercept.</p></li>
<li><p>(_v) represents the average sensitivity (d’) across the conditions</p></li>
<li><p>(b_{v_{}}), (b_{v_{}}), and (b_{v_{}}) are the subject-, experiment-, and paper-specific deviations from the average sensitivity (d’)</p></li>
<li><p>(_c) reflects -<span class="math inline">\(\Delta c\)</span>, i.e.&nbsp;the change in -response bias between control and treatment</p></li>
<li><p>(b_{c_{}}) and (b_{c_{}}) are the experiment-, and paper-specific deviations from -<span class="math inline">\(\Delta c\)</span></p></li>
<li><p>(_{cv}) reflects <span class="math inline">\(\Delta d'\)</span>, i.e.&nbsp;the change in sensitivity between treatment and control</p></li>
<li><p>(b_{cv_{}}) and (b_{cv_{}}) are the experiment-, and paper-specific deviations from the average <span class="math inline">\(\Delta d'\)</span></p></li>
<li><p><span class="math inline">\(\epsilon\)</span> is the error term that represents noise not accounted for by the random effects</p></li>
<li><p><span class="math inline">\(\sigma\)</span> is the standard deviation of the normal distribution that of the error term.</p></li>
<li><p><span class="math inline">\(\tau\)</span>’s are the respective standard deviations of the normal distributions of the random effects. We assume that the deviations of subjects are normally distributed around the average effects (hence a mean of <code>0</code>). Some subjects will have a positive deviation (i.e.&nbsp;larger values than the average); some will have a negative offset (i.e.&nbsp;smaller values than the average).</p></li>
</ul>
<p>The modelling of random effects as described above was simplified. It suggested that all random effects are described by independent normal distributions. But in fact, should expect that all random effects, of for example a single subject, are correlated. For example, subjects with a relatively <em>small intercept</em> (i.e.&nbsp;assigning very low accuracy when to false news) might assign all the more accuracy to true news (i.e shows a <em>larger effect for veracity</em>). In this case, the random effect distributions of the intercept and the effect of veracity for subjects are <em>negatively</em> correlated.</p>
<p>For each random effect factor (subjects, experiments, papers) we therefore model multivariate normal distributions.</p>
<p>[ b_{0_{}}, b_{v_{}} N(, 0 , ) ]</p>
<p>with variance-covariance matrix</p>
[ =
<span class="math display">\[\begin{bmatrix} \tau_{0_{\text{subj}}}^2 &amp; \rho_{0v_{\text{subj}}} \tau_{0_{\text{subj}}} \tau_{v_{\text{subj}}} \\ \rho_{0v_{\text{subj}}} \tau_{0_{\text{subj}}} \tau_{v_{\text{subj}}} &amp; \tau_{v_{\text{subj}}}^2 \end{bmatrix}\]</span>
<p>]</p>
<p>[ b_{0_{}}, b_{v_{}}, b_{c_{}}, b_{cv_{}} N(, 0, 0 , ) ]</p>
<p>with variance-covariance matrix</p>
[ =
<span class="math display">\[\begin{bmatrix}
\tau_{0_{\text{exp}}}^2 &amp; \rho_{0v_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{v_{\text{exp}}} &amp; \rho_{0c_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \rho_{0cv_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{cv_{\text{exp}}} \\
\rho_{0v_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{v_{\text{exp}}} &amp; \tau_{v_{\text{exp}}}^2 &amp; \rho_{vc_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \rho_{vcv_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{cv_{\text{exp}}} \\
\rho_{0c_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \rho_{vc_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \tau_{c_{\text{exp}}}^2  &amp; \rho_{ccv_{\text{exp}}} \tau_{c_{\text{exp}}} \tau_{cv_{\text{exp}}} \\
\rho_{0cv_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{cv_{\text{exp}}} &amp; \rho_{vcv_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{cv_{\text{exp}}} &amp; \rho_{ccv_{\text{exp}}} \tau_{c_{\text{exp}}} \tau_{cv_{\text{exp}}} &amp; \tau_{cv_{\text{exp}}}^2
\end{bmatrix}\]</span>
<p>]</p>
<p>[ b_{0_{}}, b_{v_{}}, b_{c_{}}, b_{cv_{}} N(, 0, 0 , ) ]</p>
<p>with variance-covariance matrix</p>
[ =
<span class="math display">\[\begin{bmatrix}
\tau_{0_{\text{paper}}}^2 &amp; \rho_{0v_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{v_{\text{paper}}} &amp; \rho_{0c_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \rho_{0cv_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{cv_{\text{paper}}} \\
\rho_{0v_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{v_{\text{paper}}} &amp; \tau_{v_{\text{paper}}}^2 &amp; \rho_{vc_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \rho_{vcv_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{cv_{\text{paper}}} \\
\rho_{0c_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \rho_{vc_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \tau_{c_{\text{paper}}}^2  &amp; \rho_{ccv_{\text{paper}}} \tau_{c_{\text{paper}}} \tau_{cv_{\text{paper}}} \\
\rho_{0cv_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{cv_{\text{paper}}} &amp; \rho_{vcv_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{cv_{\text{paper}}} &amp; \rho_{ccv_{\text{paper}}} \tau_{c_{\text{paper}}} \tau_{cv_{\text{paper}}} &amp; \tau_{cv_{\text{paper}}}^2
\end{bmatrix}\]</span>
<p>]</p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(\tau\)</span>’s are the standard deviations of the random effects distributions</p></li>
<li><p><span class="math inline">\(\rho\)</span>’s are the correlation coefficients.</p></li>
</ul>
<p>We then transform the z-values <span class="math inline">\(\eta_i\)</span> to probabilities using the probit function.</p>
<p><span class="math display">\[p_i = \Phi(\eta_i)\]</span> where <span class="math inline">\(\Phi\)</span> is the cumulative distribution function (CDF) of the standard normal distribution (or probit function). It maps the z-scores (<span class="math inline">\(\eta_i\)</span>) to probabilities.</p>
<p><span class="math display">\[
\Phi(\eta_i) = \int_{-\infty}^{\eta_i} \frac{1}{\sqrt{2\pi}} e^{-\frac{z^2}{2}} \, dz
\]</span></p>
<p>The integral calculates the area under the standard normal curve from negative infinity up to the value <span class="math inline">\(\eta_i\)</span> and thus translates the z-value into a cumulative probability, which represents the likelihood of observing a value less than or equal to <span class="math inline">\(\eta_i\)</span>.</p>
<p>Based on these probabilities, we simulate binary response (accurate = 1 or not accurate = 0), by using a Bernoulli (i.e.&nbsp;a binomial with one trial) function.</p>
<p><span class="math display">\[y_i \sim Bernoulli(p_i)\]</span></p>
</section>
<section id="parameters" class="level3">
<h3 class="anchored" data-anchor-id="parameters">Parameters</h3>
<p>We use the following prefixes to designate model parameters and sampled values:</p>
<ul>
<li><code>beta_*</code>: fixed effect parameters</li>
<li><code>subj_*</code>: random effect parameters associated with subjects</li>
<li><code>exp_*</code>: random effect parameters associated with experiment</li>
<li><code>paper_*</code>: random effect parameters associated with paper</li>
<li><code>SU_*</code>: sampled values for subject random effects</li>
<li><code>EXP_*</code>: sampled values for experiment random effects</li>
<li><code>PAP_*</code>: sampled values for paper random effects</li>
<li><code>B_*</code>: sums of added beta’s</li>
<li><code>e_*</code>: residual sd</li>
</ul>
<p>We use the following suffices to refer to certain variables:</p>
<ul>
<li><code>*_0</code>: intercept</li>
<li><code>*_v</code>: veracity</li>
<li><code>*_c</code>: condition</li>
<li><code>*_cv</code>: condition*veracity (interaction)</li>
</ul>
<p>Other terms:</p>
<ul>
<li><code>*_rho</code>: correlations for that group’s random effects</li>
<li><code>n_*</code>: sample size</li>
<li><code>sigma</code>: residual (error) sd</li>
</ul>
<p>Below, we set our parameters. The values are probably off, but the main point is to see how well our analysis does in uncovering them.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed effects</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>beta_0   <span class="ot">=</span> <span class="sc">-</span><span class="dv">0</span> <span class="co"># intercept (- average response bias )</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>beta_v   <span class="ot">=</span> <span class="dv">1</span> <span class="co"># average sensitivity (d prime) </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>beta_c   <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="co"># - delta response bias (i.e. - delta c)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>beta_cv   <span class="ot">=</span> <span class="fl">0.5</span> <span class="co"># delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># subjects</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>subj_0   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-subject intercept sd</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>subj_v   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-subject sensitivity (d prime) sd</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>subj_rho_0v <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># experiments</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>exp_0   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment intercept sd</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>exp_v   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment sensitivity (d prime) sd</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>exp_c   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment - delta response bias (i.e. - delta c) sd</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>exp_cv   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment delta sensitivity (i.e. delta d prime) sd</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>exp_rho_0v <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>exp_rho_0c <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept and - delta response bias (i.e. - delta c)</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>exp_rho_0cv <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept (- average response bias) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>exp_rho_vc <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between sensitivity (d prime) and - delta response bias (i.e. - delta c)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>exp_rho_vcv <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between sensitivity (d prime) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>exp_rho_ccv <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between - delta response bias (i.e. - delta c) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># papers</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>paper_0   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># analogous to experiment random effects</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>paper_v   <span class="ot">=</span> <span class="fl">0.1</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>paper_c   <span class="ot">=</span> <span class="fl">0.1</span> </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>paper_cv   <span class="ot">=</span> <span class="fl">0.1</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>paper_rho_0v <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>paper_rho_0c <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>paper_rho_0cv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>paper_rho_vc <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>paper_rho_vcv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>paper_rho_ccv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>sigma    <span class="ot">=</span> <span class="fl">0.5</span> <span class="co"># residual (error) sd (i.e. all variation that the model cannot account for)</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation related</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>n_subj  <span class="ot">=</span> <span class="dv">100</span> <span class="co"># number of subjects for each experimental arm (i.e. an experiment with a control and one intervention group has n = 400)</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>n_fake  <span class="ot">=</span>  <span class="dv">5</span> <span class="co"># number of fake news items </span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>n_true  <span class="ot">=</span>  <span class="dv">5</span> <span class="co"># number of true news items</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>n_max_conditions <span class="ot">=</span> <span class="dv">4</span> <span class="co"># maximum number of possible conditions for a single experiment</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>n_max_experiments <span class="ot">=</span> <span class="dv">4</span> <span class="co"># maximum number of possible experiments within a single paper</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>n_papers <span class="ot">=</span> <span class="dv">10</span> <span class="co"># number of papers in the meta analysis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We store a complete list of parameters in a list so that we can call them for functions later.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># complete list of parameters (including some that will be introduced later)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fixed effects</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_0   =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="co"># intercept (- average response bias )</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_v   =</span> <span class="dv">1</span>, <span class="co"># average sensitivity (d prime) </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_c   =</span> <span class="sc">-</span> <span class="fl">0.1</span>, <span class="co"># - delta response bias (i.e. - delta c)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_cv   =</span> <span class="fl">0.1</span>, <span class="co"># delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># random effects</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subjects</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">subj_0   =</span> <span class="fl">0.1</span>, <span class="co"># by-subject intercept sd</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">subj_v   =</span> <span class="fl">0.1</span>, <span class="co"># by-subject sensitivity (d prime) sd</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">subj_rho_0v =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># experiments</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_0   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment intercept sd</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_v   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment sensitivity (d prime) sd</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_c   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment - delta response bias (i.e. - delta c) sd</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_cv   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment delta sensitivity (i.e. delta d prime) sd</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_0v =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_0c =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept and - delta response bias (i.e. - delta c)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_0cv =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept (- average response bias) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_vc =</span> <span class="dv">0</span>, <span class="co"># correlation between sensitivity (d prime) and - delta response bias (i.e. - delta c)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_vcv =</span> <span class="dv">0</span>, <span class="co"># correlation between sensitivity (d prime) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_ccv =</span> <span class="dv">0</span>, <span class="co"># correlation between - delta response bias (i.e. - delta c) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># papers</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_0   =</span> <span class="fl">0.1</span>, <span class="co"># analogous to experiment random effects</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_v   =</span> <span class="fl">0.1</span>, </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_c   =</span> <span class="fl">0.1</span>, </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_cv   =</span> <span class="fl">0.1</span>, </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_0v =</span> <span class="dv">0</span>, </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_0c =</span> <span class="dv">0</span>, </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_0cv =</span> <span class="dv">0</span>, </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_vc =</span> <span class="dv">0</span>, </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_vcv =</span> <span class="dv">0</span>, </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_ccv =</span> <span class="dv">0</span>, </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma    =</span> <span class="fl">0.5</span>, <span class="co"># residual (error) sd (i.e. all variation that the model cannot account for)</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulation related</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_subj  =</span> <span class="dv">100</span>, <span class="co"># number of subjects for each experimental arm (i.e. an experiment with a control and one intervention group has n = 200)</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_fake  =</span>  <span class="dv">5</span>, <span class="co"># number of fake news items </span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_true  =</span>  <span class="dv">5</span>, <span class="co"># number of true news items</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max_conditions =</span> <span class="dv">4</span>, <span class="co"># maximum number of possible conditions for a single experiment</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max_experiments =</span> <span class="dv">4</span>, <span class="co"># maximum number of possible experiments within a single paper</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_papers =</span> <span class="dv">10</span> <span class="co"># number of papers in the meta analysis</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simulate-a-single-sample" class="level2">
<h2 class="anchored" data-anchor-id="simulate-a-single-sample">Simulate a single sample</h2>
<section id="stimuli-news-items" class="level3">
<h3 class="anchored" data-anchor-id="stimuli-news-items">Stimuli (news items)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a sample of items</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n_items <span class="ot">&lt;-</span> n_fake <span class="sc">+</span> n_true</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>items <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">item_id =</span> <span class="fu">seq_len</span>(n_items),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">veracity =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"fake"</span>, <span class="st">"true"</span>), <span class="fu">c</span>(n_fake, n_true)),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get a numeric version of veracity that is effect-coded (i.e. not 0 vs. 1, </span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># but -0.5 and 0.5)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">veracity_effect_code =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(n_fake, n_true))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sujects" class="level3">
<h3 class="anchored" data-anchor-id="sujects">Sujects</h3>
<p>We use the function <code>MASS::mvrnorm</code> to calculate the variance-covariance matrix between the two by-subject random effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a sample of subjects</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate random intercept / random slope covariance</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">&lt;-</span> subj_rho_0v <span class="sc">*</span> subj_0 <span class="sc">*</span> subj_v</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># put values into variance-covariance matrix</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>cov_mx  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(subj_0<span class="sc">^</span><span class="dv">2</span>, covar,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    covar,   subj_v<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># generate the by-subject random effects</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>subject_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_subj,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">SU_0 =</span> <span class="dv">0</span>, <span class="at">SU_v =</span> <span class="dv">0</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Sigma =</span> cov_mx)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># combine with subject IDs</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>subjects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">subject_id =</span> <span class="fu">seq_len</span>(n_subj),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                       subject_rfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check values.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">"subj_0"</span>, <span class="st">"subj_v"</span>, <span class="st">"subj_rho_0v"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(subj_0, subj_v, subj_rho_0v),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">simulated =</span> <span class="fu">c</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(subjects<span class="sc">$</span>SU_0),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(subjects<span class="sc">$</span>SU_v), </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>(subjects<span class="sc">$</span>SU_0, subjects<span class="sc">$</span>SU_v)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    parameter value  simulated
1      subj_0   0.1 0.10321873
2      subj_v   0.1 0.10044053
3 subj_rho_0v   0.0 0.02538285</code></pre>
</div>
</div>
</section>
<section id="trials-subjects-x-stimuli" class="level3">
<h3 class="anchored" data-anchor-id="trials-subjects-x-stimuli">Trials (Subjects x Stimuli)</h3>
<p>We combine the two data frames <code>subjects</code> and <code>items</code> we generated. We also draw a residual error for each trial/observation (<code>e_s</code> for error term for each combination of subject and stimulus).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross subject and item IDs; add an error term</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow(.) is the number of rows in the table</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">crossing</span>(subjects, items)  <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_s =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="function" class="level3">
<h3 class="anchored" data-anchor-id="function">Function</h3>
<p>We put all the previous steps in a function.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the custom data simulation function</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>draw_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed effects</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  beta_0,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  beta_v,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  beta_c,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  beta_cv,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># random effects</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  subj_0,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  subj_v,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  subj_rho_0v,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulation related</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  n_subj,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  n_fake,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  n_true,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  sigma,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  ...  <span class="co"># This allows additional parameters to be ignored</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>) { </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate a sample of items</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  n_items <span class="ot">&lt;-</span> n_fake <span class="sc">+</span> n_true</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  items <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">item_id =</span> <span class="fu">seq_len</span>(n_items),</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">veracity =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"fake"</span>, <span class="st">"true"</span>), <span class="fu">c</span>(n_fake, n_true)),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get a numeric version of veracity that is effect-coded (i.e. not 0 vs. 1, </span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># but -0.5 and 0.5)</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">veracity_effect_code =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(n_fake, n_true))</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate a sample of subjects</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate random intercept / random slope covariance</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  covar <span class="ot">&lt;-</span> subj_rho_0v <span class="sc">*</span> subj_0 <span class="sc">*</span> subj_v</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put values into variance-covariance matrix</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  cov_mx  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(subj_0<span class="sc">^</span><span class="dv">2</span>, covar,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>      covar,   subj_v<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the by-subject random effects</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  subject_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_subj,</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">SU_0 =</span> <span class="dv">0</span>, <span class="at">SU_v =</span> <span class="dv">0</span>),</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Sigma =</span> cov_mx)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine with subject IDs</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  subjects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">subject_id =</span> <span class="fu">seq_len</span>(n_subj),</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>                         subject_rfx)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cross subject and item IDs and calculate accuracy</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(subjects, items)  <span class="sc">%&gt;%</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">e_s =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># test function</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_sample, parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simulate-an-experiment" class="level2">
<h2 class="anchored" data-anchor-id="simulate-an-experiment">Simulate an experiment</h2>
<p>We know how to generate a sample, which corresponds to all participants assigned to the same experimental condition. However, an experiment consists of several conditions, and thus several samples.</p>
<p>For example, we might have three conditions, one control group, and two intervention groups.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>n_conditions <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>n_interventions <span class="ot">&lt;-</span> n_conditions <span class="sc">-</span> <span class="dv">1</span> <span class="co"># we assume always one control group</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># draw control condition</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_sample, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"control"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># draw interventions</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>interventions <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_interventions <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing intervention number "</span>, x))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      single_intervention <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_sample, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"intervention"</span>, </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">intervention_id =</span> x)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_intervention)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "drawing intervention number  1"
[1] "drawing intervention number  2"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine control and interventions data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(control, interventions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-1" class="level3">
<h3 class="anchored" data-anchor-id="function-1">Function</h3>
<p>In our function, we allow the number of conditions to vary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate an experiment</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>draw_experiment <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_max_conditions =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate random number of conditions</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  possible_n_conditions <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> n_max_conditions, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  n_conditions <span class="ot">&lt;-</span> <span class="fu">sample</span>(possible_n_conditions, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  n_interventions <span class="ot">&lt;-</span> n_conditions <span class="sc">-</span> <span class="dv">1</span> <span class="co"># we assume always one control group</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw control condition</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  control <span class="ot">&lt;-</span> <span class="fu">draw_sample</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"control"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># draw interventions</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>interventions <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_interventions <span class="sc">%&gt;%</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing intervention number "</span>, x))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>      single_intervention <span class="ot">&lt;-</span> <span class="fu">draw_sample</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"intervention"</span>, </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">intervention_id =</span> x)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_intervention)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine control and interventions data</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(control, interventions)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># test  </span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_experiment, parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simulate-various-experiments-within-a-single-paper" class="level2">
<h2 class="anchored" data-anchor-id="simulate-various-experiments-within-a-single-paper">Simulate various experiments (within a single paper)</h2>
<p>A single paper can contain multiple experiments. For example, we might have three experiments.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>n_experiments <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># draw experiments</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>experiments <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_experiments <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing experiment number "</span>, x))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      single_experiment <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_experiment, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">experiment_id =</span> x)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_experiment)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>experiments <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(experiment_id, intervention_id) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
# Groups:   experiment_id, intervention_id [9]
  experiment_id intervention_id     n
          &lt;int&gt;           &lt;int&gt; &lt;int&gt;
1             1               1  1000
2             1               2  1000
3             1               3  1000
4             1              NA  1000
5             2               1  1000
6             2               2  1000
7             2              NA  1000
8             3               1  1000
9             3              NA  1000</code></pre>
</div>
</div>
<p>We assume experiments to have random effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate covariances</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>covar_0v_exp <span class="ot">&lt;-</span> exp_rho_0v <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_v</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>covar_0c_exp <span class="ot">&lt;-</span> exp_rho_0c <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_c</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>covar_0cv_exp <span class="ot">&lt;-</span> exp_rho_0cv <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_cv</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>covar_vc_exp <span class="ot">&lt;-</span> exp_rho_vc <span class="sc">*</span> exp_v <span class="sc">*</span> exp_c</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>covar_vcv_exp <span class="ot">&lt;-</span> exp_rho_vcv <span class="sc">*</span> exp_v <span class="sc">*</span> exp_cv</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>covar_cc_exp <span class="ot">&lt;-</span> exp_rho_ccv <span class="sc">*</span> exp_c <span class="sc">*</span> exp_cv</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>cov_mx_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(exp_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_exp, covar_0c_exp, covar_0cv_exp,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    covar_0v_exp, exp_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_exp, covar_vcv_exp,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    covar_0c_exp, covar_vc_exp, exp_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_exp,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    covar_0cv_exp, covar_vcv_exp, covar_cc_exp, exp_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the by-experiment random effects</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>exp_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_experiments,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">EXP_0 =</span> <span class="dv">0</span>, <span class="at">EXP_v =</span> <span class="dv">0</span>, <span class="at">EXP_c =</span> <span class="dv">0</span>, <span class="at">EXP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sigma =</span> cov_mx_exp)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the value of n_experiments</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_experiments <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape to wide format</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(exp_rfx) <span class="sc">%&gt;%</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">effect =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> effect, <span class="at">values_from =</span> <span class="st">"exp_rfx"</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with experiment IDs</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">experiment_id =</span> <span class="fu">seq_len</span>(n_experiments), exp_rfx)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co"># add random effects to experiment data</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>experiments <span class="ot">&lt;-</span> <span class="fu">left_join</span>(experiments, exp_rfx, <span class="at">by =</span> <span class="st">"experiment_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-2" class="level3">
<h3 class="anchored" data-anchor-id="function-2">Function</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate multiple experiments</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>draw_multiple_experiments <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    n_max_experiments, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    exp_0, <span class="co"># by-experiment intercept sd</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    exp_v, <span class="co"># by-experiment sensitivity (d prime) sd</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    exp_c, <span class="co"># by-experiment - delta response bias (i.e. - delta c) sd</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    exp_cv, <span class="co"># by-experiment delta sensitivity (i.e. delta d prime) sd</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    exp_rho_0v, <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    exp_rho_0c, <span class="co"># correlation between intercept and - delta response bias (i.e. - delta c)</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    exp_rho_0cv, <span class="co"># correlation between intercept (- average response bias) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    exp_rho_vc, <span class="co"># correlation between sensitivity (d prime) and - delta response bias (i.e. - delta c)</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    exp_rho_vcv, <span class="co"># correlation between sensitivity (d prime) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    exp_rho_ccv, <span class="co"># correlation between - delta response bias (i.e. - delta c) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    ...) {</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate random number of experiments</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  possible_n_experiments <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> n_max_experiments, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  n_experiments <span class="ot">&lt;-</span> <span class="fu">sample</span>(possible_n_experiments, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw experiments</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  experiments <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_experiments <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing experiment number "</span>, x))</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>      single_experiment <span class="ot">&lt;-</span> <span class="fu">draw_experiment</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">experiment_id =</span> x)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_experiment)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate covariances</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  covar_0v_exp <span class="ot">&lt;-</span> exp_rho_0v <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_v</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  covar_0c_exp <span class="ot">&lt;-</span> exp_rho_0c <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_c</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  covar_0cv_exp <span class="ot">&lt;-</span> exp_rho_0cv <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_cv</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  covar_vc_exp <span class="ot">&lt;-</span> exp_rho_vc <span class="sc">*</span> exp_v <span class="sc">*</span> exp_c</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  covar_vcv_exp <span class="ot">&lt;-</span> exp_rho_vcv <span class="sc">*</span> exp_v <span class="sc">*</span> exp_cv</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  covar_cc_exp <span class="ot">&lt;-</span> exp_rho_ccv <span class="sc">*</span> exp_c <span class="sc">*</span> exp_cv</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>  cov_mx_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(exp_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_exp, covar_0c_exp, covar_0cv_exp,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>      covar_0v_exp, exp_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_exp, covar_vcv_exp,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>      covar_0c_exp, covar_vc_exp, exp_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_exp,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>      covar_0cv_exp, covar_vcv_exp, covar_cc_exp, exp_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the by-experiment random effects</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  exp_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_experiments,</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">EXP_0 =</span> <span class="dv">0</span>, <span class="at">EXP_v =</span> <span class="dv">0</span>, <span class="at">EXP_c =</span> <span class="dv">0</span>, <span class="at">EXP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Sigma =</span> cov_mx_exp)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check the value of n_experiments</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n_experiments <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if n == 1, mvnorm seems to return a vector, which data.frame then turns </span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># into long format data (instead of wide-format when n_experiments &gt; 1)</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape to wide format</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>    exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(exp_rfx) <span class="sc">%&gt;%</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">effect =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> effect, <span class="at">values_from =</span> <span class="st">"exp_rfx"</span>)</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with experiment IDs</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>  exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">experiment_id =</span> <span class="fu">seq_len</span>(n_experiments), exp_rfx)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random effects to experiment data</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>  experiments <span class="ot">&lt;-</span> <span class="fu">left_join</span>(experiments, exp_rfx, <span class="at">by =</span> <span class="st">"experiment_id"</span>)</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(experiments)</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_multiple_experiments, parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="simulate-various-papers" class="level2">
<h2 class="anchored" data-anchor-id="simulate-various-papers">Simulate various papers</h2>
<p>Finally, we have various papers. As for experiments, we expect random effects for papers (because of authors, country, time, etc.).</p>
<p>For example, we might have 20 papers.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>n_papers <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># draw papers</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>papers <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_papers <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing paper number "</span>, x))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      single_paper <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_multiple_experiments, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">paper_id =</span> x)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_paper)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "drawing paper number  1"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  2"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  3"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing paper number  4"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  5"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing paper number  6"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  7"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  8"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  9"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing paper number  10"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  11"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing paper number  12"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  4"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  13"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing experiment number  4"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  14"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing paper number  15"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  16"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing paper number  17"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  18"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing experiment number  4"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  19"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  20"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"</code></pre>
</div>
</div>
<p>And the random effects random effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate covariances</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>covar_0v_paper <span class="ot">&lt;-</span> paper_rho_0v <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_v</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>covar_0c_paper <span class="ot">&lt;-</span> paper_rho_0c <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_c</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>covar_0cv_paper <span class="ot">&lt;-</span> paper_rho_0cv <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_cv</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>covar_vc_paper <span class="ot">&lt;-</span> paper_rho_vc <span class="sc">*</span> paper_v <span class="sc">*</span> paper_c</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>covar_vcv_paper <span class="ot">&lt;-</span> paper_rho_vcv <span class="sc">*</span> paper_v <span class="sc">*</span> paper_cv</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>covar_cc_paper <span class="ot">&lt;-</span> paper_rho_ccv <span class="sc">*</span> paper_c <span class="sc">*</span> paper_cv</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>cov_mx_paper <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(paper_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_paper, covar_0c_paper, covar_0cv_paper,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    covar_0v_paper, paper_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_paper, covar_vcv_paper,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    covar_0c_paper, covar_vc_paper, paper_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_paper,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    covar_0cv_paper, covar_vcv_paper, covar_cc_paper, paper_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the by-paper random effects</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>paper_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_papers,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">PAP_0 =</span> <span class="dv">0</span>, <span class="at">PAP_v =</span> <span class="dv">0</span>, <span class="at">PAP_c =</span> <span class="dv">0</span>, <span class="at">PAP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sigma =</span> cov_mx_paper)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with paper IDs</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>paper_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">paper_id =</span> <span class="fu">seq_len</span>(n_papers), paper_rfx)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># add random effects to paper data</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>papers <span class="ot">&lt;-</span> <span class="fu">left_join</span>(papers, paper_rfx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, we want to be able to uniquely identify participants and experiments across papers (for now, there is a participant labeled “1” in each experiment, and there is an experiment “1” in each paper).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>papers <span class="ot">&lt;-</span> papers <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(    </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique experiment identifier</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_experiment_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, <span class="at">sep =</span> <span class="st">"_"</span>), </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique participant identifier</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_subject_id =</span> <span class="fu">paste0</span>(paper_id, <span class="st">"_"</span>, experiment_id, intervention_id, <span class="st">"_"</span>, subject_id), </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique intervention identifier</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_intervention_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, intervention_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-3" class="level3">
<h3 class="anchored" data-anchor-id="function-3">Function</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate papers</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>draw_papers <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    paper_0, <span class="co"># analogous to experiment random effects</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    paper_v,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    paper_c,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    paper_cv,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    paper_rho_0v,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    paper_rho_0c,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    paper_rho_0cv,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    paper_rho_vc,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    paper_rho_vcv, </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    paper_rho_ccv,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_papers =</span> <span class="dv">10</span>, <span class="co"># number of papers in the meta analysis</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    ...) {</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw papers</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  papers <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_papers <span class="sc">%&gt;%</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing paper number "</span>, x))</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      single_paper <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_multiple_experiments, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">paper_id =</span> x)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_paper)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate covariances</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  covar_0v_paper <span class="ot">&lt;-</span> paper_rho_0v <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_v</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  covar_0c_paper <span class="ot">&lt;-</span> paper_rho_0c <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_c</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  covar_0cv_paper <span class="ot">&lt;-</span> paper_rho_0cv <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_cv</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  covar_vc_paper <span class="ot">&lt;-</span> paper_rho_vc <span class="sc">*</span> paper_v <span class="sc">*</span> paper_c</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  covar_vcv_paper <span class="ot">&lt;-</span> paper_rho_vcv <span class="sc">*</span> paper_v <span class="sc">*</span> paper_cv</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  covar_cc_paper <span class="ot">&lt;-</span> paper_rho_ccv <span class="sc">*</span> paper_c <span class="sc">*</span> paper_cv</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  cov_mx_paper <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(paper_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_paper, covar_0c_paper, covar_0cv_paper,</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>      covar_0v_paper, paper_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_paper, covar_vcv_paper,</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>      covar_0c_paper, covar_vc_paper, paper_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_paper,</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>      covar_0cv_paper, covar_vcv_paper, covar_cc_paper, paper_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the by-paper random effects</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  paper_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_papers,</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">PAP_0 =</span> <span class="dv">0</span>, <span class="at">PAP_v =</span> <span class="dv">0</span>, <span class="at">PAP_c =</span> <span class="dv">0</span>, <span class="at">PAP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Sigma =</span> cov_mx_paper)</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with paper IDs</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>  paper_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">paper_id =</span> <span class="fu">seq_len</span>(n_papers), paper_rfx)</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random effects to paper data</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  papers <span class="ot">&lt;-</span> <span class="fu">left_join</span>(papers, paper_rfx) <span class="sc">%&gt;%</span> </span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(    </span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique experiment identifier</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_experiment_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, <span class="at">sep =</span> <span class="st">"_"</span>), </span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique participant identifier</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_subject_id =</span> <span class="fu">paste0</span>(paper_id, <span class="st">"_"</span>, experiment_id, intervention_id, <span class="st">"_"</span>, subject_id), </span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique intervention identifier</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_intervention_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, intervention_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_papers, parameters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="model-accuracy-ratings" class="level2">
<h2 class="anchored" data-anchor-id="model-accuracy-ratings">Model accuracy ratings</h2>
<p>At this point, we have simulated data with all necessary information to generate accuracy ratings, according to our model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate accuracy</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> papers <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make numeric helper variables using deviation coding</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">veracity_numeric =</span> <span class="fu">ifelse</span>(veracity <span class="sc">==</span> <span class="st">"true"</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition_numeric =</span> <span class="fu">ifelse</span>(condition <span class="sc">==</span> <span class="st">"intervention"</span>,  <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate z-value accuracy</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy_z_value =</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      (beta_0 <span class="sc">+</span> SU_0 <span class="sc">+</span> EXP_0 <span class="sc">+</span> PAP_0) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      (beta_v <span class="sc">+</span> SU_v <span class="sc">+</span> EXP_v <span class="sc">+</span> PAP_v)<span class="sc">*</span>veracity_numeric <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      (beta_c <span class="sc">+</span> EXP_c <span class="sc">+</span> PAP_c )<span class="sc">*</span>condition_numeric<span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>      (beta_cv <span class="sc">+</span> EXP_cv <span class="sc">+</span> PAP_cv)<span class="sc">*</span>(condition_numeric<span class="sc">*</span>veracity_numeric) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      e_s,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use the probit function (i.e. cumulative distribution function of the standard normal distribution)</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to optain probabilities from the z-values</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy_probability =</span> <span class="fu">pnorm</span>(accuracy_z_value), </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate a binary accuracy response by sampling from a bernoulli distribution</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (i.e. binomial distribution with one trial)</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(.), <span class="dv">1</span>, accuracy_probability)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove random effect variables</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"SU|EXP|PAP"</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="function-4" class="level4">
<h4 class="anchored" data-anchor-id="function-4">Function</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate accuracy outcomes</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>calculate_accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    data, </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fixed effects</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    beta_0, <span class="co"># intercept (- average response bias )</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    beta_v, <span class="co"># average sensitivity (d prime) </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    beta_c, <span class="co"># - delta response bias (i.e. - delta c)</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    beta_cv, <span class="co"># delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    ){</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># make numeric helper variables using deviation coding</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">veracity_numeric =</span> <span class="fu">ifelse</span>(veracity <span class="sc">==</span> <span class="st">"true"</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">condition_numeric =</span> <span class="fu">ifelse</span>(condition <span class="sc">==</span> <span class="st">"intervention"</span>,  <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate z-value accuracy</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy_z_value =</span> </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        (beta_0 <span class="sc">+</span> SU_0 <span class="sc">+</span> EXP_0 <span class="sc">+</span> PAP_0) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        (beta_v <span class="sc">+</span> SU_v <span class="sc">+</span> EXP_v <span class="sc">+</span> PAP_v)<span class="sc">*</span>veracity_numeric <span class="sc">+</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        (beta_c <span class="sc">+</span> EXP_c <span class="sc">+</span> PAP_c )<span class="sc">*</span>condition_numeric<span class="sc">+</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        (beta_cv <span class="sc">+</span> EXP_cv <span class="sc">+</span> PAP_cv)<span class="sc">*</span>(condition_numeric<span class="sc">*</span>veracity_numeric) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        e_s,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># use the probit function (i.e. cumulative distribution function of the standard normal distribution)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># to optain probabilities from the z-values</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy_probability =</span> <span class="fu">pnorm</span>(accuracy_z_value), </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># generate a binary accuracy response by sampling from a bernoulli distribution</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># (i.e. binomial distribution with one trial)</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(.), <span class="dv">1</span>, accuracy_probability)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove random effect variables</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"SU|EXP|PAP"</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- calculate_accuracy(papers)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="simulation-of-a-single-data-set-for-pre-registration" class="level1">
<h1>Simulation of a single data set for pre-registration</h1>
<p>We to use all the previous functions in a single simulation, we combine the <code>draw_papers()</code> and <code>call_accuracy()</code> functions. We call the final function <code>simulate_data()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># final data simulation function</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>simulate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  papers <span class="ot">&lt;-</span> <span class="fu">draw_papers</span>(...)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">calculate_accuracy</span>(papers, ...)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_data)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then simulate our participant-level data, based on the previously set parameters.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">do.call</span>(simulate_data, parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "drawing paper number  1"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing paper number  2"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing paper number  3"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing paper number  4"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing paper number  5"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing paper number  6"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing paper number  7"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  8"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing paper number  9"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing paper number  10"
[1] "drawing experiment number  1"
[1] "drawing intervention number  1"
[1] "drawing experiment number  2"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing experiment number  3"
[1] "drawing intervention number  1"
[1] "drawing intervention number  2"
[1] "drawing intervention number  3"</code></pre>
</div>
</div>
<section id="add-moderators" class="level2">
<h2 class="anchored" data-anchor-id="add-moderators">Add moderators</h2>
<section id="within-experiment-moderator" class="level3">
<h3 class="anchored" data-anchor-id="within-experiment-moderator">Within-experiment moderator</h3>
<p>The most important within-participant moderator we will look at is political concordance. Let’s assume that half our our news item ratings were politically concordant and half not.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add some other variables for demonstration purpose</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># political concordance</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">political_concordance =</span> <span class="fu">ifelse</span>(item_id <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"concordant"</span>, <span class="st">"discordant"</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add a deviation coded version for the political concordance variable</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">concordance_numeric =</span> <span class="fu">ifelse</span>(political_concordance <span class="sc">==</span> <span class="st">"discordant"</span>, </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">-</span><span class="fl">0.5</span>, <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(political_concordance), </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="fl">0.5</span>, </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                                              <span class="cn">NA</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># data %&gt;% </span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(concordance_numeric, political_concordance)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A second moderator that varies within experiments, but between participants, is age.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly assing intervention types</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>participant_ages <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique combinations of unique_experiment_id and condition</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(unique_subject_id) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample from intervention types only when condition is not "control"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">70</span>), <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add intervention types to data</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, participant_ages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="between-experiment-moderator" class="level3">
<h3 class="anchored" data-anchor-id="between-experiment-moderator">Between-experiment moderator</h3>
<p>The most important between-experiment moderator we will look at is intervention type. To illustrate, let’s assume that all used interventions can be classified as one out of three broad categories of interventions (let’s call them “literacy tips”, “priming”, “warning labels”).</p>
<p>Sometimes, within the same experiment, researchers might have tested different interventions. Since we will likely have to deal with that case, we should simulate it here.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly assing intervention types</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>intervention_types <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique combinations of unique_experiment_id and condition</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(unique_intervention_id, condition) <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample from intervention types only when condition is not "control"</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">intervention_type =</span> <span class="fu">ifelse</span>(condition <span class="sc">!=</span> <span class="st">"control"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"literacy tips"</span>, <span class="st">"priming"</span>, <span class="st">"warning labels"</span>), </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">size =</span> <span class="fu">sum</span>(condition <span class="sc">!=</span> <span class="st">"control"</span>), </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"control"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># add intervention types to data</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, intervention_types)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="store-simulated-data" class="level2">
<h2 class="anchored" data-anchor-id="store-simulated-data">Store simulated data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store individual level data</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"../data/simulations/individual_level.csv"</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(data, filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="sensitivity-analysis-and-parameter-recovery" class="level1">
<h1>Sensitivity analysis and parameter recovery</h1>
<p>We will run a kind of sensitivity analysis.</p>
<p>For the simulation, we–conservatively–assumed that the meta-analysis sample will consist of 10 papers. We assumed that each paper has between 1 and 4 experiments, and each experiment can have between two and four experimental arms (one of which is always the control condition). For each experimental arm, we assumed a sample size of 100 participants. The number of experiments per paper and arms per experiments was chosen randomly for each study. We further assumed that participants always saw 5 true and 5 false news. For details about other parameter assumptions, see the parameter list specified above. Although our final sample of papers will probably have properties quite different from what we assumed here, we believe these assumptions are rather conservative.</p>
<p>In our simulations, we vary the values for the true effect sizes for d’prime and c in the data. For each combination of effect sizes, we run 100 iterations, i.e.&nbsp;100 times we generate a different sample of 10 papers, and run our meta-analysis on that sample. The aim of the sensitivity analysis consists in checking how many of these 100 meta-analyses find a significant effect. The share of analyses that detect the true effect is the statistical power.</p>
<p>Instead of only checking whether our models find a significant effect or not, we also descriptively check how well our model estimates recover the data generating parameters.</p>
<section id="estimator" class="level2">
<h2 class="anchored" data-anchor-id="estimator">Estimator</h2>
<p>We start by defining the model we use to estimate our effects, and select the outcomes of interest. We will run a participant-level meta analysis using a two-stage approach: First, for each experiment, we calculate the above mixed model. The resulting estimates are our effect sizes. Second, we run a meta analysis on these effect sizes.</p>
<section id="define-the-model" class="level3">
<h3 class="anchored" data-anchor-id="define-the-model">Define the model</h3>
<p>We first write a function for calculating the model for each experiment.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate model function</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>calculate_SDT_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">glmer</span>(accuracy <span class="sc">~</span> veracity_numeric <span class="sc">+</span> condition_numeric <span class="sc">+</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                     veracity_numeric<span class="sc">*</span>condition_numeric <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                     (<span class="dv">1</span> <span class="sc">+</span> veracity_numeric <span class="sc">|</span> unique_subject_id),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> data, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">round</span>(time[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">60</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get a tidy version</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">tidy</span>(model, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add time</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_minutes =</span> time)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># give nicer names in SDT terminology to estimates (! and reverse estimates for response bias !)</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> </span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reverse c and delta c estimates</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">|</span> term <span class="sc">==</span> <span class="st">"condition_numeric"</span>, </span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>estimate, estimate),</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">case_when</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="st">"average response bias (c)"</span>, </span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>                       term <span class="sc">==</span> <span class="st">"veracity_numeric"</span> <span class="sc">~</span> <span class="st">"average sensitivity (d')"</span>, </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>                       term <span class="sc">==</span> <span class="st">"condition_numeric"</span> <span class="sc">~</span> <span class="st">"delta c"</span>,</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>                       term <span class="sc">==</span> <span class="st">"veracity_numeric:condition_numeric"</span> <span class="sc">~</span> <span class="st">"delta d'"</span>,</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">TRUE</span> <span class="sc">~</span> term</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">sampling_variance =</span> std.error<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_model &lt;- calculate_SDT_model(data %&gt;% filter(unique_experiment_id == "1_1"))</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run-the-loop" class="level3">
<h3 class="anchored" data-anchor-id="run-the-loop">Run the loop</h3>
<p>We then run a for loop, to calculate one model per experiment and store the results in a common data frame.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over experiments</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>run_SDT_model_loop <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a vector with all unique experiment ids</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  experiments <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(unique_experiment_id) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># slice(1:3) %&gt;% # to test loop</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>()</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run one model per experiment and store the results in a common data frame</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> experiments <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># restrict data to only the respective experiment</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        experiment <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(unique_experiment_id <span class="sc">==</span> x)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># extract paper id</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        paper_id <span class="ot">&lt;-</span> <span class="fu">unique</span>(experiment<span class="sc">$</span>paper_id)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To keep track of progress</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"calculating model for experiment "</span>, x))</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        model_experiment <span class="ot">&lt;-</span> <span class="fu">calculate_SDT_model</span>(experiment) <span class="sc">%&gt;%</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">unique_experiment_id =</span> x,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">paper_id =</span> paper_id)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(model_experiment)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Elapsed time: "</span>, <span class="fu">round</span>(time[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">60</span>, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">" minutes"</span>))</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a><span class="co"># experiment_ids_to_test &lt;- data %&gt;% distinct(unique_experiment_id) %&gt;% slice(1:5) %&gt;% pull()</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- run_SDT_model_loop(data%&gt;% filter(unique_experiment_id %in% experiment_ids_to_test))</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="run-the-meta-analysis" class="level3">
<h3 class="anchored" data-anchor-id="run-the-meta-analysis">Run the meta-analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate meta models</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>calculate_meta_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yi, vi, <span class="at">robust =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># provide metafor compatible names</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  metafor_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">yi =</span> {{yi}}, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">vi =</span> {{vi}})</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multilevel random effect model for accuracy</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span>  metafor<span class="sc">::</span><span class="fu">rma.mv</span>(yi, vi, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> paper_id <span class="sc">/</span> unique_experiment_id, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> metafor_data)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(robust <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with robust standard errors clustered at the paper level </span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    robust_model <span class="ot">&lt;-</span> <span class="fu">robust</span>(model, <span class="at">cluster =</span> data<span class="sc">$</span>paper_id)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(robust_model)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co"># generate some model output</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># experiment_ids_to_test &lt;- data %&gt;% distinct(unique_experiment_id) %&gt;% slice(1:5) %&gt;% pull()</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co"># test_model_output &lt;- run_SDT_model_loop(data%&gt;% filter(unique_experiment_id %in% experiment_ids_to_test))</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># # model for delta dprime</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co"># delta_dprime &lt;- calculate_meta_model(data = test_model_output  %&gt;% </span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        filter(term == "delta d'"), yi = estimate, </span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      vi = sampling_variance, robust = TRUE) %&gt;% </span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   tidy() %&gt;% </span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(term = ifelse(term == "overall", "delta d'", NA))</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co"># # model for delta c</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co"># delta_c &lt;- calculate_meta_model(data = test_model_output  %&gt;% </span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   filter(term == "delta c"), yi = estimate, </span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 vi = sampling_variance, robust = TRUE) %&gt;% </span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   tidy() %&gt;% </span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(term = ifelse(term == "overall", "delta c", NA))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We combine all these analysis steps in a single estimate function.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># final function for running all models </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>get_meta_estimates <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate outcome data for all experiments</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  outcome_data <span class="ot">&lt;-</span> <span class="fu">run_SDT_model_loop</span>(data)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate meta model for delta dprime</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  delta_dprime <span class="ot">&lt;-</span> <span class="fu">calculate_meta_model</span>(<span class="at">data =</span> outcome_data  <span class="sc">%&gt;%</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"delta d'"</span>), </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">yi =</span> estimate, </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">vi =</span> sampling_variance, </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"overall"</span>, <span class="st">"delta d'"</span>, <span class="cn">NA</span>))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate meta model for delta c</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  delta_c <span class="ot">&lt;-</span> <span class="fu">calculate_meta_model</span>(<span class="at">data =</span> outcome_data  <span class="sc">%&gt;%</span> </span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"delta c"</span>), </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yi =</span> estimate, </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">vi =</span> sampling_variance, </span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"overall"</span>, <span class="st">"delta c"</span>, <span class="cn">NA</span>))</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  estimates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(delta_dprime, delta_c)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estimates)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce data to some experiments only</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># experiment_ids_to_test &lt;- data %&gt;% distinct(unique_experiment_id) %&gt;% slice(1:5) %&gt;% pull()</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="co"># result &lt;- get_meta_estimates(data %&gt;% filter(unique_experiment_id %in% experiment_ids_to_test))</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co"># result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="run-iterations" class="level2">
<h2 class="anchored" data-anchor-id="run-iterations">Run iterations</h2>
<p>For each combination of effect sizes, we run several iterations, so that we can get an impression of how well different meta-analytic samples recover the parameters. For each iteration, the function first generates a set of studies to run the meta-analysis on, and then runs the meta-analysis. The results will be stored in a single data frame, in which iterations are labeled.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat the process and store some information on it (e.g. time taken, number of iteration)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>iterate <span class="ot">&lt;-</span> <span class="cf">function</span>(iterations, ...) {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create data frame with model results for generated samples</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>iterations <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_df</span>(<span class="cf">function</span>(x) {</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Measure time for each iteration</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      iteration_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># generate data</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        participant_level_data <span class="ot">&lt;-</span> <span class="fu">simulate_data</span>(...)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># run models on the data</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>        estimates <span class="ot">&lt;-</span> <span class="fu">get_meta_estimates</span>(participant_level_data)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add iteration number and time in minutes to estimates</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>      estimates <span class="ot">&lt;-</span> estimates <span class="sc">%&gt;%</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">iteration =</span> x,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">time_taken_minutes =</span> iteration_time[<span class="dv">3</span>] <span class="sc">/</span> <span class="dv">60</span>)  <span class="co"># Convert time to minutes</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"iteration number "</span>, x))}</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(estimates)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="co"># note that even for just 10 meta-analyses, this takes quite a while, ~1min per iteration</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(iterate, c(parameters, list(iterations = 4)))</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(test %&gt;% filter(term == "delta d'"), aes(x = estimate)) +</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram() +</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_vline(xintercept = parameters$beta_cv, linetype = "dotted", color = "black")</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(test %&gt;% filter(term == "delta c"), aes(x = estimate)) +</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram() +</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_vline(xintercept = -parameters$beta_c, linetype = "dotted", color = "black")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="sensitivity-analysis" class="level1">
<h1>Sensitivity analysis</h1>
<p>For a start, we will have three different effect sizes (small = 0.1, medium = 0.5, large = 1) and run 100 meta-analyses on each combination. We will check calculate the statistical power we have for each effect.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run sensitivity analysis</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sensitivity_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(file_name, effect_sizes_to_try, iterations, ...) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make full file name</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  full_file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"../data/simulations/"</span>, file_name)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only run analysis if a file with that name does not yet exists</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(full_file_name)) {</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    sensitivity_data <span class="ot">&lt;-</span> <span class="fu">pmap_df</span>(effect_sizes_to_try, <span class="cf">function</span>(delta_d_prime, delta_c) {</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"test for delta c = "</span>, delta_c, <span class="st">"; delta d' = "</span>, delta_d_prime))</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate the results for a specific combination of parameters</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>      combination_result <span class="ot">&lt;-</span>  <span class="fu">iterate</span>(<span class="at">iterations =</span> iterations, </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">beta_cv =</span> delta_d_prime, </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># make sure to reverse the data generating parameter for response bias</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">beta_c =</span> <span class="sc">-</span>delta_c, </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>                                     ...</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>                                     )</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># add combination of parameters to data frame</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>      combination_result <span class="ot">&lt;-</span> combination_result <span class="sc">%&gt;%</span> </span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">parameter_delta_d_prime =</span> delta_d_prime, </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">parameter_delta_c =</span> delta_c)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(sensitivity_data, full_file_name)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(sensitivity_data)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="co"># the code below tests the function content, not the function itself</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="co"># # make a data frame with sample sizes</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_sizes_to_try &lt;- crossing(delta_d_prime = c(0.1, 1),</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 # reverse response bias estimates</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 delta_c = c(-0.1, -1))</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove initial parameters from list since we want to replace it</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # with the respective effect size combination every time.</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters[["beta_cv"]] &lt;- NULL</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters[["beta_c"]] &lt;- NULL</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- pmap_df(effect_sizes_to_try, function(delta_d_prime, delta_c) {</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   # To keep track of progress</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   print(paste("test for delta c = ", delta_c, "; delta d' = ", delta_d_prime))</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   # calculate the results for a specific combination of parameters</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   combination_result &lt;-  do.call(iterate, </span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  c(parameters,</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    list(beta_cv = delta_d_prime, </span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         # make sure to reverse the data generating parameter for response bias</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         beta_c = -delta_c), </span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    list(iterations = 2)</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  )</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   # add combination of parameters to data frame</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   combination_result &lt;- combination_result %&gt;% </span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(parameter_delta_d_prime = delta_d_prime, </span></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a><span class="co">#            parameter_delta_c = delta_c)</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We first make changes to the parameter list. Since we are now varying the effect sizes of delta d’ and delta c, we remove them from the orgininal parameter list.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove initial parameters from list since we want to replace it</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with the respective effect size combination every time.</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>parameters[[<span class="st">"beta_cv"</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>parameters[[<span class="st">"beta_c"</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can then run the sensitivity analysis. Note that while we could feed the whole data frame of <code>effect_sizes_to_try</code> into the function, this would take very long. For each pair of effect sizes (i.e.&nbsp;one row in the data frame), the model takes approx. half a minute per iteration on my machine.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run sensitivity analysis</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># you could just run this, but it would take reaaaally long</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_sizes_to_try &lt;- crossing(delta_d_prime = c(0.2, 0.5, 0.8),</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 delta_c = c(0.2, 0.5, 0.8))</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># do.call(sensitivity_analysis, c(parameters, </span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 list(file_name = "sensitivity_analysis.csv", </span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      effect_sizes_to_try = effect_sizes_to_try, </span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      iterations = 2)</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- read_csv("data/sensitivity_analysis.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Since I’m running this code locally on my computer, I have two different solutions. The first is to run the code in several chunks, exporting a each data frame and appending it to a common result data frame. To do this, we need to slightly modify the function from before.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modified function to run the simulation chunk by chunk</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_analysis &lt;- function(file_name, effect_sizes_to_try, iterations, ...) {</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   sensitivity_data &lt;- pmap_df(effect_sizes_to_try, function(delta_d_prime, delta_c) {</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     # To keep track of progress</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(paste("test for delta c = ", delta_c, "; delta d' = ", delta_d_prime))</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     # calculate the results for a specific combination of parameters</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     combination_result &lt;-  iterate(iterations = iterations, </span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    beta_cv = delta_d_prime, </span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    # make sure to reverse the data generating parameter for response bias</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    beta_c = -delta_c, </span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    ...</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     # add combination of parameters to data frame</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     combination_result &lt;- combination_result %&gt;% </span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       mutate(parameter_delta_d_prime = delta_d_prime, </span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">#              parameter_delta_c = delta_c)</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   })</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   # make full file name</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   full_file_name &lt;- paste0("data/simulations/", file_name)</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Check if the CSV file already exists</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (file.exists(full_file_name)) {</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Append to the existing CSV</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     write_csv(sensitivity_data, full_file_name, append = TRUE)</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Write a new CSV file if it doesn't exist</span></span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     write_csv(sensitivity_data, full_file_name)</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(sensitivity_data)</span></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="co"># # check current combinations</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- read_csv("data/simulations/sensitivity_analysis.csv")</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data %&gt;% distinct(parameter_delta_c, parameter_delta_d_prime)</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # run sensitivity analysis chunk by chunk</span></span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_sizes_to_try &lt;- crossing(delta_d_prime = c(0.1, 0.5, 1),</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 delta_c = c(0.1, 0.5, 1))</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="co"># do.call(sensitivity_analysis, c(parameters, </span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 list(file_name = "sensitivity_analysis.csv", </span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      effect_sizes_to_try = effect_sizes_to_try %&gt;% </span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        # modify this for new analyses</span></span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        slice(1)</span></span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        , </span></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      iterations = 2)</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- read_csv("data/simulations/sensitivity_analysis.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The second option, which I have used for our project, is to run the simulation based on an R script in the console. This way, R can run the simulation in the background, while you can use the computer as normal (given that the computations are not too heavy for your computer to handle it all at the same time). To do so, we first copy all the function from this .qmd file to a separate .R script, which we call <code>sensitivity_simulation.R</code>.</p>
<p>We then run this script in the terminal (<code>Rscript sensitivity_simulation.R</code>), by making sure to specify the correct project working directory (<code>cd YOUR/DIRECTORY</code>).</p>
<p>If you do this, make sure to not let your computer go to sleep, e.g.&nbsp;by using <a href="https://www.theapplegeek.co.uk/blog/caffeinate">‘caffeinate’</a>, or <a href="https://apps.apple.com/us/app/amphetamine/id937984704?mt=12">amphetamine</a>.</p>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>for binary variables, this is the probability of choosing accurate as an answer.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Note that the distributions here are assumed to be independent. Below, we specify that they are from multivariate distributions.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb44" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> |</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">  Data simulation for preregistration</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> true</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> ../references.bib</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages}</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="in">library(kableExtra)  </span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="in">library(lme4)</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="in">library(lmerTest)</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="in">library(afex)</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom)</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="in">library(broom.mixed)</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="in">library(metafor)   </span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r functions}</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="in"># load plot theme</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="in">source("../R/plot_theme.R") </span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="in"># load other functions</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="in">source("../R/custom_functions.R")</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a seed</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>We will generate participant-level data for a set different papers with different numbers of experiments.</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>This simulation involves three steps:</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>simulate data for a single experiment</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>simulate several experiments</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>simulate several papers </span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>To give an overview of the data generating task: </span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>We model our dependent variable <span class="in">`accuracy`</span> based on the variables <span class="in">`veracity`</span> (false vs. true), <span class="in">`condition`</span> (control vs. intervention), and their interaction. We have random effects for <span class="in">`subject_id`</span>, <span class="in">`experiment_id`</span> and <span class="in">`paper_id`</span>. </span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a><span class="fu"># Building a simulation function</span></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data generating process</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variables</span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`paper_id`</span> (identifier of the published paper)</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`experiment_id`</span> (identifier of experiments within a paper)</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`subject_id`</span> (identifier of subjects within an experiment)</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`veracity`</span>  (true vs. fake news)</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`accuracy`</span> (numeric accuracy rating, ranging from 0 to 1)^<span class="co">[</span><span class="ot">for binary variables, this is the probability of choosing accurate as an answer.</span><span class="co">]</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`condition`</span> (control vs. intervention)</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`n`</span> (number of participants per sample)</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a><span class="fu">### Design</span></span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a>The important parts of the design are:</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Random factors : </span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span><span class="in">`subject_id`</span> </span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span><span class="in">`experiment_id`</span></span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span><span class="in">`paper_id`</span></span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Fixed factor 1: <span class="in">`veracity`</span> (levels = false, true)</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within subject_id </span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within experiment_id</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within paper_id</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Fixed factor 2: <span class="in">`condition`</span> (levels: control, intervention)</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>between subject_id</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within experiment_id</span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within paper_id</span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Fixed factor 3: <span class="in">`condition\*veracity`</span> </span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>between subject_id</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within experiment_id</span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>within paper_id</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>We assume that,</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`veracity`</span> varies _within_ participants, i.e. all participants see both <span class="in">`fake`</span> and <span class="in">`true`</span> news </span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`condition`</span> varies _between_ participants, i.e. a participant is either in the control group or a treatment group</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>an experiment involves only one control group, but a varying number of treatment groups (up to 3)</span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>we assume _random effects_ only for participants (<span class="in">`subject_id`</span>), experiments (<span class="in">`experiment_id`</span>) and papers (<span class="in">`paper_id`</span>). We do *not* assume, random effects for different intervention types, nor for different news headlines</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the sample size per experimental condition is 100</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>each participant rates 12 news items in total, with equal numbers of <span class="in">`fake`</span> and <span class="in">`true`</span> items</span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model</span></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a>We use a generalized linear mixed model (GLMM) to generate accuracy responses. In this model, our parameters are z-values. For the interpretation of our model parameters below in terms of Signal Detection Theory (SDT) outcomes (sensitivity "d prime" and the response bias "c"), it is crucial that we use deviation coding for our veracity variable (fake = -0.5, true = 0.5), and for condition (-0.5 = control, 0.5 = intervention).</span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a>\begin{align*}</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a>\eta_i &amp;= (\beta_0 + b_{0_\text{Subject}} + b_{0_\text{Experiment}} + b_{0_\text{Paper}}) <span class="sc">\\</span></span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a>&amp;\quad+ (\beta_v + b_{v_\text{Subject}} + b_{v_\text{Experiment}} + b_{v_\text{Paper}}) \text{Veracity} <span class="sc">\\</span></span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a>&amp;\quad+ (\beta_c + b_{c_\text{Experiment}} + b_{c_\text{Paper}}) \text{Condition} <span class="sc">\\</span></span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>&amp;\quad+ (\beta_{cv} + b_{cv_\text{Experiment}} + b_{cv_\text{Paper}}) \text{Condition*Veracity} + \epsilon</span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>\end{align*}</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>with^<span class="co">[</span><span class="ot">Note that the distributions here are assumed to be independent. Below, we specify that they are from multivariate distributions.</span><span class="co">]</span>:</span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{0_{\text{Subject}}} \sim N(0, \tau_{\text{subj}_0})<span class="sc">\)</span></span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{v_{\text{Subject}}} \sim N(0, \tau_{\text{subj}_v})<span class="sc">\)</span></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{0_{\text{Experiment}}} \sim N(0, \tau_{\text{exp}_0})<span class="sc">\)</span> </span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{v_{\text{Experiment}}} \sim N(0, \tau_{\text{exp}_v})<span class="sc">\)</span></span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{c_{\text{Experiment}}} \sim N(0, \tau_{\text{exp}_c})<span class="sc">\)</span></span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{cv_{\text{Experiment}}} \sim N(0, \tau_{\text{exp}_cv})<span class="sc">\)</span></span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{0_{\text{Paper}}} \sim N(0, \tau_{\text{paper}_0})<span class="sc">\)</span></span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{v_{\text{Paper}}} \sim N(0, \tau_{\text{paper}_v})<span class="sc">\)</span></span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{c_{\text{Paper}}} \sim N(0, \tau_{\text{paper}_c})<span class="sc">\)</span></span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{cv_{\text{Paper}}} \sim N(0, \tau_{\text{paper}_cv})<span class="sc">\)</span></span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>\epsilon \sim N(0, \sigma)<span class="sc">\)</span></span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>\eta_i is a z-score that can be transformed to a probability for an accuracy answer, using the probit function</span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>\beta_0<span class="sc">\)</span> represents - the average response bias (c), pooled across conditions</span>
<span id="cb44-132"><a href="#cb44-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-133"><a href="#cb44-133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{0_{\text{Subject}}}\), \(b_{0_{\text{Experiment}}}\), and \(b_{0_{\text{Paper}}}<span class="sc">\)</span> are the subject-, experiment-, and paper-specific deviations from the average intercept.</span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>\beta_v<span class="sc">\)</span> represents the average sensitivity (d') across the conditions</span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{v_{\text{Subject}}}\), \(b_{v_{\text{Experiment}}}\), and \(b_{v_{\text{Paper}}}<span class="sc">\)</span> are the subject-, experiment-, and paper-specific deviations from the average sensitivity (d')</span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>\beta_c<span class="sc">\)</span> reflects -$\Delta c$, i.e. the change in -response bias between control and treatment</span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{c_{\text{Experiment}}}\) and \(b_{c_{\text{Paper}}}<span class="sc">\)</span> are the experiment-, and paper-specific deviations from -$\Delta c$</span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>\beta_{cv}<span class="sc">\)</span> reflects $\Delta d'$, i.e. the change in sensitivity between treatment and control</span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-145"><a href="#cb44-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="sc">\(</span>b_{cv_{\text{Experiment}}}\) and \(b_{cv_{\text{Paper}}}<span class="sc">\)</span> are the experiment-, and paper-specific deviations from the average $\Delta d'$</span>
<span id="cb44-146"><a href="#cb44-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\epsilon$ is the error term that represents noise not accounted for by the random effects</span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\sigma$ is the standard deviation of the normal distribution that of the error term.</span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\tau$'s are the respective standard deviations of the normal distributions of the random effects. We assume that the deviations of subjects are normally distributed around the average effects (hence a mean of <span class="in">`0`</span>). Some subjects will have a positive deviation (i.e. larger values than the average); some will have a negative offset (i.e. smaller values than the average).</span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a>The modelling of random effects as described above was simplified. It suggested that all random effects are described by independent normal distributions. But in fact, should expect that all random effects, of for example a single subject, are correlated. For example, subjects with a relatively *small intercept* (i.e. assigning very low accuracy when to false news) might assign all the more accuracy to true news (i.e shows a *larger effect for veracity*). In this case, the random effect distributions of the intercept and the effect of veracity for subjects are *negatively* correlated.</span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a>For each random effect factor (subjects, experiments, papers) we therefore model multivariate normal distributions.</span>
<span id="cb44-156"><a href="#cb44-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-157"><a href="#cb44-157" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a>\langle b_{0_{\text{Subject}}}, b_{v_{\text{Subject}}} \rangle \sim N(\langle 0, 0 \rangle, \Sigma)</span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a>with variance-covariance matrix</span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a>\Sigma = \begin{bmatrix} \tau_{0_{\text{subj}}}^2 &amp; \rho_{0v_{\text{subj}}} \tau_{0_{\text{subj}}} \tau_{v_{\text{subj}}} <span class="sc">\\</span> \rho_{0v_{\text{subj}}} \tau_{0_{\text{subj}}} \tau_{v_{\text{subj}}} &amp; \tau_{v_{\text{subj}}}^2 \end{bmatrix}</span>
<span id="cb44-165"><a href="#cb44-165" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb44-166"><a href="#cb44-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a>\langle b_{0_{\text{Experiment}}}, b_{v_{\text{Experiment}}}, b_{c_{\text{Experiment}}}, b_{cv_{\text{Experiment}}} \rangle \sim N(\langle 0, 0, 0 \rangle, \Sigma)</span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-171"><a href="#cb44-171" aria-hidden="true" tabindex="-1"></a>with variance-covariance matrix</span>
<span id="cb44-172"><a href="#cb44-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-173"><a href="#cb44-173" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb44-174"><a href="#cb44-174" aria-hidden="true" tabindex="-1"></a>\Sigma = \begin{bmatrix} </span>
<span id="cb44-175"><a href="#cb44-175" aria-hidden="true" tabindex="-1"></a>\tau_{0_{\text{exp}}}^2 &amp; \rho_{0v_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{v_{\text{exp}}} &amp; \rho_{0c_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \rho_{0cv_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{cv_{\text{exp}}} <span class="sc">\\</span></span>
<span id="cb44-176"><a href="#cb44-176" aria-hidden="true" tabindex="-1"></a>\rho_{0v_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{v_{\text{exp}}} &amp; \tau_{v_{\text{exp}}}^2 &amp; \rho_{vc_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \rho_{vcv_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{cv_{\text{exp}}} <span class="sc">\\</span></span>
<span id="cb44-177"><a href="#cb44-177" aria-hidden="true" tabindex="-1"></a>\rho_{0c_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \rho_{vc_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{c_{\text{exp}}} &amp; \tau_{c_{\text{exp}}}^2  &amp; \rho_{ccv_{\text{exp}}} \tau_{c_{\text{exp}}} \tau_{cv_{\text{exp}}} <span class="sc">\\</span></span>
<span id="cb44-178"><a href="#cb44-178" aria-hidden="true" tabindex="-1"></a>\rho_{0cv_{\text{exp}}} \tau_{0_{\text{exp}}} \tau_{cv_{\text{exp}}} &amp; \rho_{vcv_{\text{exp}}} \tau_{v_{\text{exp}}} \tau_{cv_{\text{exp}}} &amp; \rho_{ccv_{\text{exp}}} \tau_{c_{\text{exp}}} \tau_{cv_{\text{exp}}} &amp; \tau_{cv_{\text{exp}}}^2 </span>
<span id="cb44-179"><a href="#cb44-179" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb44-180"><a href="#cb44-180" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb44-181"><a href="#cb44-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-182"><a href="#cb44-182" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb44-183"><a href="#cb44-183" aria-hidden="true" tabindex="-1"></a>\langle b_{0_{\text{Paper}}}, b_{v_{\text{Paper}}}, b_{c_{\text{Paper}}}, b_{cv_{\text{Paper}}} \rangle \sim N(\langle 0, 0, 0 \rangle, \Sigma)</span>
<span id="cb44-184"><a href="#cb44-184" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb44-185"><a href="#cb44-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-186"><a href="#cb44-186" aria-hidden="true" tabindex="-1"></a>with variance-covariance matrix</span>
<span id="cb44-187"><a href="#cb44-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-188"><a href="#cb44-188" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb44-189"><a href="#cb44-189" aria-hidden="true" tabindex="-1"></a>\Sigma = \begin{bmatrix} </span>
<span id="cb44-190"><a href="#cb44-190" aria-hidden="true" tabindex="-1"></a>\tau_{0_{\text{paper}}}^2 &amp; \rho_{0v_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{v_{\text{paper}}} &amp; \rho_{0c_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \rho_{0cv_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{cv_{\text{paper}}} <span class="sc">\\</span></span>
<span id="cb44-191"><a href="#cb44-191" aria-hidden="true" tabindex="-1"></a>\rho_{0v_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{v_{\text{paper}}} &amp; \tau_{v_{\text{paper}}}^2 &amp; \rho_{vc_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \rho_{vcv_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{cv_{\text{paper}}} <span class="sc">\\</span></span>
<span id="cb44-192"><a href="#cb44-192" aria-hidden="true" tabindex="-1"></a>\rho_{0c_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \rho_{vc_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{c_{\text{paper}}} &amp; \tau_{c_{\text{paper}}}^2  &amp; \rho_{ccv_{\text{paper}}} \tau_{c_{\text{paper}}} \tau_{cv_{\text{paper}}} <span class="sc">\\</span></span>
<span id="cb44-193"><a href="#cb44-193" aria-hidden="true" tabindex="-1"></a>\rho_{0cv_{\text{paper}}} \tau_{0_{\text{paper}}} \tau_{cv_{\text{paper}}} &amp; \rho_{vcv_{\text{paper}}} \tau_{v_{\text{paper}}} \tau_{cv_{\text{paper}}} &amp; \rho_{ccv_{\text{paper}}} \tau_{c_{\text{paper}}} \tau_{cv_{\text{paper}}} &amp; \tau_{cv_{\text{paper}}}^2 </span>
<span id="cb44-194"><a href="#cb44-194" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb44-195"><a href="#cb44-195" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb44-196"><a href="#cb44-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-197"><a href="#cb44-197" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb44-198"><a href="#cb44-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-199"><a href="#cb44-199" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\tau$'s are the standard deviations of the random effects distributions</span>
<span id="cb44-200"><a href="#cb44-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-201"><a href="#cb44-201" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\rho$'s are the correlation coefficients.</span>
<span id="cb44-202"><a href="#cb44-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-203"><a href="#cb44-203" aria-hidden="true" tabindex="-1"></a>We then transform the z-values $\eta_i$ to probabilities using the probit function.</span>
<span id="cb44-204"><a href="#cb44-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-205"><a href="#cb44-205" aria-hidden="true" tabindex="-1"></a>$$p_i = \Phi(\eta_i)$$</span>
<span id="cb44-206"><a href="#cb44-206" aria-hidden="true" tabindex="-1"></a>where $\Phi$ is the cumulative distribution function (CDF) of the standard normal distribution (or probit function). It maps the z-scores ($\eta_i$) to probabilities.</span>
<span id="cb44-207"><a href="#cb44-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-208"><a href="#cb44-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb44-209"><a href="#cb44-209" aria-hidden="true" tabindex="-1"></a>\Phi(\eta_i) = \int_{-\infty}^{\eta_i} \frac{1}{\sqrt{2\pi}} e^{-\frac{z^2}{2}} \, dz</span>
<span id="cb44-210"><a href="#cb44-210" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb44-211"><a href="#cb44-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-212"><a href="#cb44-212" aria-hidden="true" tabindex="-1"></a>The integral calculates the area under the standard normal curve from negative infinity up to the value $\eta_i$ and thus translates the z-value into a cumulative probability, which represents the likelihood of observing a value less than or equal to $\eta_i$.</span>
<span id="cb44-213"><a href="#cb44-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-214"><a href="#cb44-214" aria-hidden="true" tabindex="-1"></a>Based on these probabilities, we simulate binary response (accurate = 1 or not accurate = 0), by using a Bernoulli (i.e. a binomial with one trial) function.  </span>
<span id="cb44-215"><a href="#cb44-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-216"><a href="#cb44-216" aria-hidden="true" tabindex="-1"></a>$$y_i \sim Bernoulli(p_i)$$</span>
<span id="cb44-217"><a href="#cb44-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-218"><a href="#cb44-218" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parameters</span></span>
<span id="cb44-219"><a href="#cb44-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-220"><a href="#cb44-220" aria-hidden="true" tabindex="-1"></a>We use the following prefixes to designate model parameters and sampled values: </span>
<span id="cb44-221"><a href="#cb44-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-222"><a href="#cb44-222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`beta_*`</span>: fixed effect parameters</span>
<span id="cb44-223"><a href="#cb44-223" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`subj_*`</span>: random effect parameters associated with subjects</span>
<span id="cb44-224"><a href="#cb44-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`exp_*`</span>: random effect parameters associated with experiment</span>
<span id="cb44-225"><a href="#cb44-225" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`paper_*`</span>: random effect parameters associated with paper</span>
<span id="cb44-226"><a href="#cb44-226" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`SU_*`</span>: sampled values for subject random effects</span>
<span id="cb44-227"><a href="#cb44-227" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`EXP_*`</span>: sampled values for experiment random effects</span>
<span id="cb44-228"><a href="#cb44-228" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`PAP_*`</span>: sampled values for paper random effects</span>
<span id="cb44-229"><a href="#cb44-229" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`B_*`</span>: sums of added beta's</span>
<span id="cb44-230"><a href="#cb44-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`e_*`</span>: residual sd</span>
<span id="cb44-231"><a href="#cb44-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-232"><a href="#cb44-232" aria-hidden="true" tabindex="-1"></a>We use the following suffices to refer to certain variables:</span>
<span id="cb44-233"><a href="#cb44-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-234"><a href="#cb44-234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`*_0`</span>: intercept</span>
<span id="cb44-235"><a href="#cb44-235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`*_v`</span>: veracity</span>
<span id="cb44-236"><a href="#cb44-236" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`*_c`</span>: condition</span>
<span id="cb44-237"><a href="#cb44-237" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`*_cv`</span>: condition<span class="sc">\*</span>veracity (interaction)</span>
<span id="cb44-238"><a href="#cb44-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-239"><a href="#cb44-239" aria-hidden="true" tabindex="-1"></a>Other terms:</span>
<span id="cb44-240"><a href="#cb44-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-241"><a href="#cb44-241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`*_rho`</span>: correlations for that group's random effects</span>
<span id="cb44-242"><a href="#cb44-242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`n_*`</span>: sample size</span>
<span id="cb44-243"><a href="#cb44-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`sigma`</span>: residual (error) sd</span>
<span id="cb44-244"><a href="#cb44-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-245"><a href="#cb44-245" aria-hidden="true" tabindex="-1"></a>Below, we set our parameters. The values are probably off, but the main point is to see how well our analysis does in uncovering them. </span>
<span id="cb44-246"><a href="#cb44-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-249"><a href="#cb44-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-250"><a href="#cb44-250" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters</span></span>
<span id="cb44-251"><a href="#cb44-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-252"><a href="#cb44-252" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed effects</span></span>
<span id="cb44-253"><a href="#cb44-253" aria-hidden="true" tabindex="-1"></a>beta_0   <span class="ot">=</span> <span class="sc">-</span><span class="dv">0</span> <span class="co"># intercept (- average response bias )</span></span>
<span id="cb44-254"><a href="#cb44-254" aria-hidden="true" tabindex="-1"></a>beta_v   <span class="ot">=</span> <span class="dv">1</span> <span class="co"># average sensitivity (d prime) </span></span>
<span id="cb44-255"><a href="#cb44-255" aria-hidden="true" tabindex="-1"></a>beta_c   <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="co"># - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-256"><a href="#cb44-256" aria-hidden="true" tabindex="-1"></a>beta_cv   <span class="ot">=</span> <span class="fl">0.5</span> <span class="co"># delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-257"><a href="#cb44-257" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects</span></span>
<span id="cb44-258"><a href="#cb44-258" aria-hidden="true" tabindex="-1"></a><span class="co"># subjects</span></span>
<span id="cb44-259"><a href="#cb44-259" aria-hidden="true" tabindex="-1"></a>subj_0   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-subject intercept sd</span></span>
<span id="cb44-260"><a href="#cb44-260" aria-hidden="true" tabindex="-1"></a>subj_v   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-subject sensitivity (d prime) sd</span></span>
<span id="cb44-261"><a href="#cb44-261" aria-hidden="true" tabindex="-1"></a>subj_rho_0v <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb44-262"><a href="#cb44-262" aria-hidden="true" tabindex="-1"></a><span class="co"># experiments</span></span>
<span id="cb44-263"><a href="#cb44-263" aria-hidden="true" tabindex="-1"></a>exp_0   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment intercept sd</span></span>
<span id="cb44-264"><a href="#cb44-264" aria-hidden="true" tabindex="-1"></a>exp_v   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment sensitivity (d prime) sd</span></span>
<span id="cb44-265"><a href="#cb44-265" aria-hidden="true" tabindex="-1"></a>exp_c   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment - delta response bias (i.e. - delta c) sd</span></span>
<span id="cb44-266"><a href="#cb44-266" aria-hidden="true" tabindex="-1"></a>exp_cv   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># by-experiment delta sensitivity (i.e. delta d prime) sd</span></span>
<span id="cb44-267"><a href="#cb44-267" aria-hidden="true" tabindex="-1"></a>exp_rho_0v <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb44-268"><a href="#cb44-268" aria-hidden="true" tabindex="-1"></a>exp_rho_0c <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept and - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-269"><a href="#cb44-269" aria-hidden="true" tabindex="-1"></a>exp_rho_0cv <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between intercept (- average response bias) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-270"><a href="#cb44-270" aria-hidden="true" tabindex="-1"></a>exp_rho_vc <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between sensitivity (d prime) and - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-271"><a href="#cb44-271" aria-hidden="true" tabindex="-1"></a>exp_rho_vcv <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between sensitivity (d prime) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-272"><a href="#cb44-272" aria-hidden="true" tabindex="-1"></a>exp_rho_ccv <span class="ot">=</span> <span class="dv">0</span> <span class="co"># correlation between - delta response bias (i.e. - delta c) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-273"><a href="#cb44-273" aria-hidden="true" tabindex="-1"></a><span class="co"># papers</span></span>
<span id="cb44-274"><a href="#cb44-274" aria-hidden="true" tabindex="-1"></a>paper_0   <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># analogous to experiment random effects</span></span>
<span id="cb44-275"><a href="#cb44-275" aria-hidden="true" tabindex="-1"></a>paper_v   <span class="ot">=</span> <span class="fl">0.1</span> </span>
<span id="cb44-276"><a href="#cb44-276" aria-hidden="true" tabindex="-1"></a>paper_c   <span class="ot">=</span> <span class="fl">0.1</span> </span>
<span id="cb44-277"><a href="#cb44-277" aria-hidden="true" tabindex="-1"></a>paper_cv   <span class="ot">=</span> <span class="fl">0.1</span> </span>
<span id="cb44-278"><a href="#cb44-278" aria-hidden="true" tabindex="-1"></a>paper_rho_0v <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb44-279"><a href="#cb44-279" aria-hidden="true" tabindex="-1"></a>paper_rho_0c <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb44-280"><a href="#cb44-280" aria-hidden="true" tabindex="-1"></a>paper_rho_0cv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb44-281"><a href="#cb44-281" aria-hidden="true" tabindex="-1"></a>paper_rho_vc <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb44-282"><a href="#cb44-282" aria-hidden="true" tabindex="-1"></a>paper_rho_vcv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb44-283"><a href="#cb44-283" aria-hidden="true" tabindex="-1"></a>paper_rho_ccv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb44-284"><a href="#cb44-284" aria-hidden="true" tabindex="-1"></a>sigma    <span class="ot">=</span> <span class="fl">0.5</span> <span class="co"># residual (error) sd (i.e. all variation that the model cannot account for)</span></span>
<span id="cb44-285"><a href="#cb44-285" aria-hidden="true" tabindex="-1"></a><span class="co"># simulation related</span></span>
<span id="cb44-286"><a href="#cb44-286" aria-hidden="true" tabindex="-1"></a>n_subj  <span class="ot">=</span> <span class="dv">100</span> <span class="co"># number of subjects for each experimental arm (i.e. an experiment with a control and one intervention group has n = 400)</span></span>
<span id="cb44-287"><a href="#cb44-287" aria-hidden="true" tabindex="-1"></a>n_fake  <span class="ot">=</span>  <span class="dv">5</span> <span class="co"># number of fake news items </span></span>
<span id="cb44-288"><a href="#cb44-288" aria-hidden="true" tabindex="-1"></a>n_true  <span class="ot">=</span>  <span class="dv">5</span> <span class="co"># number of true news items</span></span>
<span id="cb44-289"><a href="#cb44-289" aria-hidden="true" tabindex="-1"></a>n_max_conditions <span class="ot">=</span> <span class="dv">4</span> <span class="co"># maximum number of possible conditions for a single experiment</span></span>
<span id="cb44-290"><a href="#cb44-290" aria-hidden="true" tabindex="-1"></a>n_max_experiments <span class="ot">=</span> <span class="dv">4</span> <span class="co"># maximum number of possible experiments within a single paper</span></span>
<span id="cb44-291"><a href="#cb44-291" aria-hidden="true" tabindex="-1"></a>n_papers <span class="ot">=</span> <span class="dv">10</span> <span class="co"># number of papers in the meta analysis</span></span>
<span id="cb44-292"><a href="#cb44-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-293"><a href="#cb44-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-294"><a href="#cb44-294" aria-hidden="true" tabindex="-1"></a>We store a complete list of parameters in a list so that we can call them for functions later.</span>
<span id="cb44-295"><a href="#cb44-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-298"><a href="#cb44-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-299"><a href="#cb44-299" aria-hidden="true" tabindex="-1"></a><span class="co"># complete list of parameters (including some that will be introduced later)</span></span>
<span id="cb44-300"><a href="#cb44-300" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb44-301"><a href="#cb44-301" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fixed effects</span></span>
<span id="cb44-302"><a href="#cb44-302" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_0   =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="co"># intercept (- average response bias )</span></span>
<span id="cb44-303"><a href="#cb44-303" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_v   =</span> <span class="dv">1</span>, <span class="co"># average sensitivity (d prime) </span></span>
<span id="cb44-304"><a href="#cb44-304" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_c   =</span> <span class="sc">-</span> <span class="fl">0.1</span>, <span class="co"># - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-305"><a href="#cb44-305" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_cv   =</span> <span class="fl">0.1</span>, <span class="co"># delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-306"><a href="#cb44-306" aria-hidden="true" tabindex="-1"></a>  <span class="co"># random effects</span></span>
<span id="cb44-307"><a href="#cb44-307" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subjects</span></span>
<span id="cb44-308"><a href="#cb44-308" aria-hidden="true" tabindex="-1"></a>  <span class="at">subj_0   =</span> <span class="fl">0.1</span>, <span class="co"># by-subject intercept sd</span></span>
<span id="cb44-309"><a href="#cb44-309" aria-hidden="true" tabindex="-1"></a>  <span class="at">subj_v   =</span> <span class="fl">0.1</span>, <span class="co"># by-subject sensitivity (d prime) sd</span></span>
<span id="cb44-310"><a href="#cb44-310" aria-hidden="true" tabindex="-1"></a>  <span class="at">subj_rho_0v =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb44-311"><a href="#cb44-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># experiments</span></span>
<span id="cb44-312"><a href="#cb44-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_0   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment intercept sd</span></span>
<span id="cb44-313"><a href="#cb44-313" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_v   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment sensitivity (d prime) sd</span></span>
<span id="cb44-314"><a href="#cb44-314" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_c   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment - delta response bias (i.e. - delta c) sd</span></span>
<span id="cb44-315"><a href="#cb44-315" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_cv   =</span> <span class="fl">0.1</span>, <span class="co"># by-experiment delta sensitivity (i.e. delta d prime) sd</span></span>
<span id="cb44-316"><a href="#cb44-316" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_0v =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb44-317"><a href="#cb44-317" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_0c =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept and - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-318"><a href="#cb44-318" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_0cv =</span> <span class="dv">0</span>, <span class="co"># correlation between intercept (- average response bias) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-319"><a href="#cb44-319" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_vc =</span> <span class="dv">0</span>, <span class="co"># correlation between sensitivity (d prime) and - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-320"><a href="#cb44-320" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_vcv =</span> <span class="dv">0</span>, <span class="co"># correlation between sensitivity (d prime) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-321"><a href="#cb44-321" aria-hidden="true" tabindex="-1"></a>  <span class="at">exp_rho_ccv =</span> <span class="dv">0</span>, <span class="co"># correlation between - delta response bias (i.e. - delta c) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-322"><a href="#cb44-322" aria-hidden="true" tabindex="-1"></a>  <span class="co"># papers</span></span>
<span id="cb44-323"><a href="#cb44-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_0   =</span> <span class="fl">0.1</span>, <span class="co"># analogous to experiment random effects</span></span>
<span id="cb44-324"><a href="#cb44-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_v   =</span> <span class="fl">0.1</span>, </span>
<span id="cb44-325"><a href="#cb44-325" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_c   =</span> <span class="fl">0.1</span>, </span>
<span id="cb44-326"><a href="#cb44-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_cv   =</span> <span class="fl">0.1</span>, </span>
<span id="cb44-327"><a href="#cb44-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_0v =</span> <span class="dv">0</span>, </span>
<span id="cb44-328"><a href="#cb44-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_0c =</span> <span class="dv">0</span>, </span>
<span id="cb44-329"><a href="#cb44-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_0cv =</span> <span class="dv">0</span>, </span>
<span id="cb44-330"><a href="#cb44-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_vc =</span> <span class="dv">0</span>, </span>
<span id="cb44-331"><a href="#cb44-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_vcv =</span> <span class="dv">0</span>, </span>
<span id="cb44-332"><a href="#cb44-332" aria-hidden="true" tabindex="-1"></a>  <span class="at">paper_rho_ccv =</span> <span class="dv">0</span>, </span>
<span id="cb44-333"><a href="#cb44-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma    =</span> <span class="fl">0.5</span>, <span class="co"># residual (error) sd (i.e. all variation that the model cannot account for)</span></span>
<span id="cb44-334"><a href="#cb44-334" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulation related</span></span>
<span id="cb44-335"><a href="#cb44-335" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_subj  =</span> <span class="dv">100</span>, <span class="co"># number of subjects for each experimental arm (i.e. an experiment with a control and one intervention group has n = 200)</span></span>
<span id="cb44-336"><a href="#cb44-336" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_fake  =</span>  <span class="dv">5</span>, <span class="co"># number of fake news items </span></span>
<span id="cb44-337"><a href="#cb44-337" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_true  =</span>  <span class="dv">5</span>, <span class="co"># number of true news items</span></span>
<span id="cb44-338"><a href="#cb44-338" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max_conditions =</span> <span class="dv">4</span>, <span class="co"># maximum number of possible conditions for a single experiment</span></span>
<span id="cb44-339"><a href="#cb44-339" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max_experiments =</span> <span class="dv">4</span>, <span class="co"># maximum number of possible experiments within a single paper</span></span>
<span id="cb44-340"><a href="#cb44-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_papers =</span> <span class="dv">10</span> <span class="co"># number of papers in the meta analysis</span></span>
<span id="cb44-341"><a href="#cb44-341" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-342"><a href="#cb44-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-343"><a href="#cb44-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-344"><a href="#cb44-344" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulate a single sample</span></span>
<span id="cb44-345"><a href="#cb44-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-346"><a href="#cb44-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stimuli (news items)</span></span>
<span id="cb44-347"><a href="#cb44-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-350"><a href="#cb44-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-351"><a href="#cb44-351" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a sample of items</span></span>
<span id="cb44-352"><a href="#cb44-352" aria-hidden="true" tabindex="-1"></a>n_items <span class="ot">&lt;-</span> n_fake <span class="sc">+</span> n_true</span>
<span id="cb44-353"><a href="#cb44-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-354"><a href="#cb44-354" aria-hidden="true" tabindex="-1"></a>items <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-355"><a href="#cb44-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">item_id =</span> <span class="fu">seq_len</span>(n_items),</span>
<span id="cb44-356"><a href="#cb44-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">veracity =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"fake"</span>, <span class="st">"true"</span>), <span class="fu">c</span>(n_fake, n_true)),</span>
<span id="cb44-357"><a href="#cb44-357" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get a numeric version of veracity that is effect-coded (i.e. not 0 vs. 1, </span></span>
<span id="cb44-358"><a href="#cb44-358" aria-hidden="true" tabindex="-1"></a>  <span class="co"># but -0.5 and 0.5)</span></span>
<span id="cb44-359"><a href="#cb44-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">veracity_effect_code =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(n_fake, n_true))</span>
<span id="cb44-360"><a href="#cb44-360" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-361"><a href="#cb44-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-362"><a href="#cb44-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-363"><a href="#cb44-363" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sujects</span></span>
<span id="cb44-364"><a href="#cb44-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-365"><a href="#cb44-365" aria-hidden="true" tabindex="-1"></a>We use the function <span class="in">`MASS::mvrnorm`</span> to calculate the variance-covariance matrix between the two by-subject random effects.</span>
<span id="cb44-366"><a href="#cb44-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-369"><a href="#cb44-369" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-370"><a href="#cb44-370" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a sample of subjects</span></span>
<span id="cb44-371"><a href="#cb44-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-372"><a href="#cb44-372" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate random intercept / random slope covariance</span></span>
<span id="cb44-373"><a href="#cb44-373" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">&lt;-</span> subj_rho_0v <span class="sc">*</span> subj_0 <span class="sc">*</span> subj_v</span>
<span id="cb44-374"><a href="#cb44-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-375"><a href="#cb44-375" aria-hidden="true" tabindex="-1"></a><span class="co"># put values into variance-covariance matrix</span></span>
<span id="cb44-376"><a href="#cb44-376" aria-hidden="true" tabindex="-1"></a>cov_mx  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb44-377"><a href="#cb44-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(subj_0<span class="sc">^</span><span class="dv">2</span>, covar,</span>
<span id="cb44-378"><a href="#cb44-378" aria-hidden="true" tabindex="-1"></a>    covar,   subj_v<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb44-379"><a href="#cb44-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-380"><a href="#cb44-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-381"><a href="#cb44-381" aria-hidden="true" tabindex="-1"></a><span class="co"># generate the by-subject random effects</span></span>
<span id="cb44-382"><a href="#cb44-382" aria-hidden="true" tabindex="-1"></a>subject_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_subj,</span>
<span id="cb44-383"><a href="#cb44-383" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">SU_0 =</span> <span class="dv">0</span>, <span class="at">SU_v =</span> <span class="dv">0</span>),</span>
<span id="cb44-384"><a href="#cb44-384" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Sigma =</span> cov_mx)</span>
<span id="cb44-385"><a href="#cb44-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-386"><a href="#cb44-386" aria-hidden="true" tabindex="-1"></a><span class="co"># combine with subject IDs</span></span>
<span id="cb44-387"><a href="#cb44-387" aria-hidden="true" tabindex="-1"></a>subjects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">subject_id =</span> <span class="fu">seq_len</span>(n_subj),</span>
<span id="cb44-388"><a href="#cb44-388" aria-hidden="true" tabindex="-1"></a>                       subject_rfx)</span>
<span id="cb44-389"><a href="#cb44-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-390"><a href="#cb44-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-391"><a href="#cb44-391" aria-hidden="true" tabindex="-1"></a>Check values.</span>
<span id="cb44-392"><a href="#cb44-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-395"><a href="#cb44-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-396"><a href="#cb44-396" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb44-397"><a href="#cb44-397" aria-hidden="true" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">"subj_0"</span>, <span class="st">"subj_v"</span>, <span class="st">"subj_rho_0v"</span>),</span>
<span id="cb44-398"><a href="#cb44-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(subj_0, subj_v, subj_rho_0v),</span>
<span id="cb44-399"><a href="#cb44-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">simulated =</span> <span class="fu">c</span>(</span>
<span id="cb44-400"><a href="#cb44-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(subjects<span class="sc">$</span>SU_0),</span>
<span id="cb44-401"><a href="#cb44-401" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(subjects<span class="sc">$</span>SU_v), </span>
<span id="cb44-402"><a href="#cb44-402" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>(subjects<span class="sc">$</span>SU_0, subjects<span class="sc">$</span>SU_v)</span>
<span id="cb44-403"><a href="#cb44-403" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-404"><a href="#cb44-404" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-405"><a href="#cb44-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-406"><a href="#cb44-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-407"><a href="#cb44-407" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trials (Subjects x Stimuli)</span></span>
<span id="cb44-408"><a href="#cb44-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-409"><a href="#cb44-409" aria-hidden="true" tabindex="-1"></a>We combine the two data frames <span class="in">`subjects`</span> and <span class="in">`items`</span> we generated. We also draw a residual error for each trial/observation (<span class="in">`e_s`</span> for error term for each combination of subject and stimulus).</span>
<span id="cb44-410"><a href="#cb44-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-413"><a href="#cb44-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-414"><a href="#cb44-414" aria-hidden="true" tabindex="-1"></a><span class="co"># cross subject and item IDs; add an error term</span></span>
<span id="cb44-415"><a href="#cb44-415" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow(.) is the number of rows in the table</span></span>
<span id="cb44-416"><a href="#cb44-416" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">crossing</span>(subjects, items)  <span class="sc">%&gt;%</span></span>
<span id="cb44-417"><a href="#cb44-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_s =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span>
<span id="cb44-418"><a href="#cb44-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-419"><a href="#cb44-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-420"><a href="#cb44-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function</span></span>
<span id="cb44-421"><a href="#cb44-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-422"><a href="#cb44-422" aria-hidden="true" tabindex="-1"></a>We put all the previous steps in a function. </span>
<span id="cb44-423"><a href="#cb44-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-426"><a href="#cb44-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-427"><a href="#cb44-427" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the custom data simulation function</span></span>
<span id="cb44-428"><a href="#cb44-428" aria-hidden="true" tabindex="-1"></a>draw_sample <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb44-429"><a href="#cb44-429" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed effects</span></span>
<span id="cb44-430"><a href="#cb44-430" aria-hidden="true" tabindex="-1"></a>  beta_0,</span>
<span id="cb44-431"><a href="#cb44-431" aria-hidden="true" tabindex="-1"></a>  beta_v,</span>
<span id="cb44-432"><a href="#cb44-432" aria-hidden="true" tabindex="-1"></a>  beta_c,</span>
<span id="cb44-433"><a href="#cb44-433" aria-hidden="true" tabindex="-1"></a>  beta_cv,</span>
<span id="cb44-434"><a href="#cb44-434" aria-hidden="true" tabindex="-1"></a>  <span class="co"># random effects</span></span>
<span id="cb44-435"><a href="#cb44-435" aria-hidden="true" tabindex="-1"></a>  subj_0,</span>
<span id="cb44-436"><a href="#cb44-436" aria-hidden="true" tabindex="-1"></a>  subj_v,</span>
<span id="cb44-437"><a href="#cb44-437" aria-hidden="true" tabindex="-1"></a>  subj_rho_0v,</span>
<span id="cb44-438"><a href="#cb44-438" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulation related</span></span>
<span id="cb44-439"><a href="#cb44-439" aria-hidden="true" tabindex="-1"></a>  n_subj,</span>
<span id="cb44-440"><a href="#cb44-440" aria-hidden="true" tabindex="-1"></a>  n_fake,</span>
<span id="cb44-441"><a href="#cb44-441" aria-hidden="true" tabindex="-1"></a>  n_true,</span>
<span id="cb44-442"><a href="#cb44-442" aria-hidden="true" tabindex="-1"></a>  sigma,</span>
<span id="cb44-443"><a href="#cb44-443" aria-hidden="true" tabindex="-1"></a>  ...  <span class="co"># This allows additional parameters to be ignored</span></span>
<span id="cb44-444"><a href="#cb44-444" aria-hidden="true" tabindex="-1"></a>) { </span>
<span id="cb44-445"><a href="#cb44-445" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-446"><a href="#cb44-446" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate a sample of items</span></span>
<span id="cb44-447"><a href="#cb44-447" aria-hidden="true" tabindex="-1"></a>  n_items <span class="ot">&lt;-</span> n_fake <span class="sc">+</span> n_true</span>
<span id="cb44-448"><a href="#cb44-448" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-449"><a href="#cb44-449" aria-hidden="true" tabindex="-1"></a>  items <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-450"><a href="#cb44-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">item_id =</span> <span class="fu">seq_len</span>(n_items),</span>
<span id="cb44-451"><a href="#cb44-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">veracity =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"fake"</span>, <span class="st">"true"</span>), <span class="fu">c</span>(n_fake, n_true)),</span>
<span id="cb44-452"><a href="#cb44-452" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get a numeric version of veracity that is effect-coded (i.e. not 0 vs. 1, </span></span>
<span id="cb44-453"><a href="#cb44-453" aria-hidden="true" tabindex="-1"></a>    <span class="co"># but -0.5 and 0.5)</span></span>
<span id="cb44-454"><a href="#cb44-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">veracity_effect_code =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="fu">c</span>(n_fake, n_true))</span>
<span id="cb44-455"><a href="#cb44-455" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-456"><a href="#cb44-456" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-457"><a href="#cb44-457" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate a sample of subjects</span></span>
<span id="cb44-458"><a href="#cb44-458" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-459"><a href="#cb44-459" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate random intercept / random slope covariance</span></span>
<span id="cb44-460"><a href="#cb44-460" aria-hidden="true" tabindex="-1"></a>  covar <span class="ot">&lt;-</span> subj_rho_0v <span class="sc">*</span> subj_0 <span class="sc">*</span> subj_v</span>
<span id="cb44-461"><a href="#cb44-461" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-462"><a href="#cb44-462" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put values into variance-covariance matrix</span></span>
<span id="cb44-463"><a href="#cb44-463" aria-hidden="true" tabindex="-1"></a>  cov_mx  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb44-464"><a href="#cb44-464" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(subj_0<span class="sc">^</span><span class="dv">2</span>, covar,</span>
<span id="cb44-465"><a href="#cb44-465" aria-hidden="true" tabindex="-1"></a>      covar,   subj_v<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb44-466"><a href="#cb44-466" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-467"><a href="#cb44-467" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-468"><a href="#cb44-468" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate the by-subject random effects</span></span>
<span id="cb44-469"><a href="#cb44-469" aria-hidden="true" tabindex="-1"></a>  subject_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_subj,</span>
<span id="cb44-470"><a href="#cb44-470" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">SU_0 =</span> <span class="dv">0</span>, <span class="at">SU_v =</span> <span class="dv">0</span>),</span>
<span id="cb44-471"><a href="#cb44-471" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Sigma =</span> cov_mx)</span>
<span id="cb44-472"><a href="#cb44-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-473"><a href="#cb44-473" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine with subject IDs</span></span>
<span id="cb44-474"><a href="#cb44-474" aria-hidden="true" tabindex="-1"></a>  subjects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">subject_id =</span> <span class="fu">seq_len</span>(n_subj),</span>
<span id="cb44-475"><a href="#cb44-475" aria-hidden="true" tabindex="-1"></a>                         subject_rfx)</span>
<span id="cb44-476"><a href="#cb44-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-477"><a href="#cb44-477" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cross subject and item IDs and calculate accuracy</span></span>
<span id="cb44-478"><a href="#cb44-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(subjects, items)  <span class="sc">%&gt;%</span></span>
<span id="cb44-479"><a href="#cb44-479" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">e_s =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma))</span>
<span id="cb44-480"><a href="#cb44-480" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-481"><a href="#cb44-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-482"><a href="#cb44-482" aria-hidden="true" tabindex="-1"></a><span class="co"># test function</span></span>
<span id="cb44-483"><a href="#cb44-483" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_sample, parameters)</span></span>
<span id="cb44-484"><a href="#cb44-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-485"><a href="#cb44-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-486"><a href="#cb44-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-487"><a href="#cb44-487" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulate an experiment</span></span>
<span id="cb44-488"><a href="#cb44-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-489"><a href="#cb44-489" aria-hidden="true" tabindex="-1"></a>We know how to generate a sample, which corresponds to all participants assigned to the same experimental condition. However, an experiment consists of several conditions, and thus several samples. </span>
<span id="cb44-490"><a href="#cb44-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-491"><a href="#cb44-491" aria-hidden="true" tabindex="-1"></a>For example, we might have three conditions, one control group, and two intervention groups.</span>
<span id="cb44-492"><a href="#cb44-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-495"><a href="#cb44-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-496"><a href="#cb44-496" aria-hidden="true" tabindex="-1"></a>n_conditions <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb44-497"><a href="#cb44-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-498"><a href="#cb44-498" aria-hidden="true" tabindex="-1"></a>n_interventions <span class="ot">&lt;-</span> n_conditions <span class="sc">-</span> <span class="dv">1</span> <span class="co"># we assume always one control group</span></span>
<span id="cb44-499"><a href="#cb44-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-500"><a href="#cb44-500" aria-hidden="true" tabindex="-1"></a><span class="co"># draw control condition</span></span>
<span id="cb44-501"><a href="#cb44-501" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_sample, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb44-502"><a href="#cb44-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"control"</span>)</span>
<span id="cb44-503"><a href="#cb44-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-504"><a href="#cb44-504" aria-hidden="true" tabindex="-1"></a><span class="co"># draw interventions</span></span>
<span id="cb44-505"><a href="#cb44-505" aria-hidden="true" tabindex="-1"></a>interventions <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_interventions <span class="sc">%&gt;%</span></span>
<span id="cb44-506"><a href="#cb44-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-507"><a href="#cb44-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-508"><a href="#cb44-508" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-509"><a href="#cb44-509" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing intervention number "</span>, x))</span>
<span id="cb44-510"><a href="#cb44-510" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-511"><a href="#cb44-511" aria-hidden="true" tabindex="-1"></a>      single_intervention <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_sample, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb44-512"><a href="#cb44-512" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"intervention"</span>, </span>
<span id="cb44-513"><a href="#cb44-513" aria-hidden="true" tabindex="-1"></a>               <span class="at">intervention_id =</span> x)</span>
<span id="cb44-514"><a href="#cb44-514" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-515"><a href="#cb44-515" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_intervention)</span>
<span id="cb44-516"><a href="#cb44-516" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-517"><a href="#cb44-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-518"><a href="#cb44-518" aria-hidden="true" tabindex="-1"></a><span class="co"># combine control and interventions data</span></span>
<span id="cb44-519"><a href="#cb44-519" aria-hidden="true" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(control, interventions)</span>
<span id="cb44-520"><a href="#cb44-520" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-521"><a href="#cb44-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-522"><a href="#cb44-522" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function</span></span>
<span id="cb44-523"><a href="#cb44-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-524"><a href="#cb44-524" aria-hidden="true" tabindex="-1"></a>In our function, we allow the number of conditions to vary. </span>
<span id="cb44-525"><a href="#cb44-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-528"><a href="#cb44-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-529"><a href="#cb44-529" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate an experiment</span></span>
<span id="cb44-530"><a href="#cb44-530" aria-hidden="true" tabindex="-1"></a>draw_experiment <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_max_conditions =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb44-531"><a href="#cb44-531" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-532"><a href="#cb44-532" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate random number of conditions</span></span>
<span id="cb44-533"><a href="#cb44-533" aria-hidden="true" tabindex="-1"></a>  possible_n_conditions <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> n_max_conditions, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb44-534"><a href="#cb44-534" aria-hidden="true" tabindex="-1"></a>  n_conditions <span class="ot">&lt;-</span> <span class="fu">sample</span>(possible_n_conditions, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb44-535"><a href="#cb44-535" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-536"><a href="#cb44-536" aria-hidden="true" tabindex="-1"></a>  n_interventions <span class="ot">&lt;-</span> n_conditions <span class="sc">-</span> <span class="dv">1</span> <span class="co"># we assume always one control group</span></span>
<span id="cb44-537"><a href="#cb44-537" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-538"><a href="#cb44-538" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw control condition</span></span>
<span id="cb44-539"><a href="#cb44-539" aria-hidden="true" tabindex="-1"></a>  control <span class="ot">&lt;-</span> <span class="fu">draw_sample</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb44-540"><a href="#cb44-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"control"</span>)</span>
<span id="cb44-541"><a href="#cb44-541" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-542"><a href="#cb44-542" aria-hidden="true" tabindex="-1"></a><span class="co"># draw interventions</span></span>
<span id="cb44-543"><a href="#cb44-543" aria-hidden="true" tabindex="-1"></a>interventions <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_interventions <span class="sc">%&gt;%</span></span>
<span id="cb44-544"><a href="#cb44-544" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-545"><a href="#cb44-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-546"><a href="#cb44-546" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-547"><a href="#cb44-547" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing intervention number "</span>, x))</span>
<span id="cb44-548"><a href="#cb44-548" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-549"><a href="#cb44-549" aria-hidden="true" tabindex="-1"></a>      single_intervention <span class="ot">&lt;-</span> <span class="fu">draw_sample</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb44-550"><a href="#cb44-550" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="st">"intervention"</span>, </span>
<span id="cb44-551"><a href="#cb44-551" aria-hidden="true" tabindex="-1"></a>               <span class="at">intervention_id =</span> x)</span>
<span id="cb44-552"><a href="#cb44-552" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-553"><a href="#cb44-553" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_intervention)</span>
<span id="cb44-554"><a href="#cb44-554" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-555"><a href="#cb44-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-556"><a href="#cb44-556" aria-hidden="true" tabindex="-1"></a><span class="co"># combine control and interventions data</span></span>
<span id="cb44-557"><a href="#cb44-557" aria-hidden="true" tabindex="-1"></a>experiment <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(control, interventions)</span>
<span id="cb44-558"><a href="#cb44-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-559"><a href="#cb44-559" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb44-560"><a href="#cb44-560" aria-hidden="true" tabindex="-1"></a><span class="co"># test  </span></span>
<span id="cb44-561"><a href="#cb44-561" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_experiment, parameters)</span></span>
<span id="cb44-562"><a href="#cb44-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-563"><a href="#cb44-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-564"><a href="#cb44-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulate various experiments (within a single paper)</span></span>
<span id="cb44-565"><a href="#cb44-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-566"><a href="#cb44-566" aria-hidden="true" tabindex="-1"></a>A single paper can contain multiple experiments. For example, we might have three experiments. </span>
<span id="cb44-567"><a href="#cb44-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-570"><a href="#cb44-570" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-571"><a href="#cb44-571" aria-hidden="true" tabindex="-1"></a>n_experiments <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb44-572"><a href="#cb44-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-573"><a href="#cb44-573" aria-hidden="true" tabindex="-1"></a><span class="co"># draw experiments</span></span>
<span id="cb44-574"><a href="#cb44-574" aria-hidden="true" tabindex="-1"></a>experiments <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_experiments <span class="sc">%&gt;%</span></span>
<span id="cb44-575"><a href="#cb44-575" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-576"><a href="#cb44-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-577"><a href="#cb44-577" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-578"><a href="#cb44-578" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing experiment number "</span>, x))</span>
<span id="cb44-579"><a href="#cb44-579" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-580"><a href="#cb44-580" aria-hidden="true" tabindex="-1"></a>      single_experiment <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_experiment, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb44-581"><a href="#cb44-581" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">experiment_id =</span> x)</span>
<span id="cb44-582"><a href="#cb44-582" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-583"><a href="#cb44-583" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_experiment)</span>
<span id="cb44-584"><a href="#cb44-584" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-585"><a href="#cb44-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-586"><a href="#cb44-586" aria-hidden="true" tabindex="-1"></a>experiments <span class="sc">%&gt;%</span> </span>
<span id="cb44-587"><a href="#cb44-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(experiment_id, intervention_id) <span class="sc">%&gt;%</span> </span>
<span id="cb44-588"><a href="#cb44-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb44-589"><a href="#cb44-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-590"><a href="#cb44-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-591"><a href="#cb44-591" aria-hidden="true" tabindex="-1"></a>We assume experiments to have random effects. </span>
<span id="cb44-592"><a href="#cb44-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-595"><a href="#cb44-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-596"><a href="#cb44-596" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate covariances</span></span>
<span id="cb44-597"><a href="#cb44-597" aria-hidden="true" tabindex="-1"></a>covar_0v_exp <span class="ot">&lt;-</span> exp_rho_0v <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_v</span>
<span id="cb44-598"><a href="#cb44-598" aria-hidden="true" tabindex="-1"></a>covar_0c_exp <span class="ot">&lt;-</span> exp_rho_0c <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_c</span>
<span id="cb44-599"><a href="#cb44-599" aria-hidden="true" tabindex="-1"></a>covar_0cv_exp <span class="ot">&lt;-</span> exp_rho_0cv <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_cv</span>
<span id="cb44-600"><a href="#cb44-600" aria-hidden="true" tabindex="-1"></a>covar_vc_exp <span class="ot">&lt;-</span> exp_rho_vc <span class="sc">*</span> exp_v <span class="sc">*</span> exp_c</span>
<span id="cb44-601"><a href="#cb44-601" aria-hidden="true" tabindex="-1"></a>covar_vcv_exp <span class="ot">&lt;-</span> exp_rho_vcv <span class="sc">*</span> exp_v <span class="sc">*</span> exp_cv</span>
<span id="cb44-602"><a href="#cb44-602" aria-hidden="true" tabindex="-1"></a>covar_cc_exp <span class="ot">&lt;-</span> exp_rho_ccv <span class="sc">*</span> exp_c <span class="sc">*</span> exp_cv</span>
<span id="cb44-603"><a href="#cb44-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-604"><a href="#cb44-604" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb44-605"><a href="#cb44-605" aria-hidden="true" tabindex="-1"></a>cov_mx_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb44-606"><a href="#cb44-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(exp_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_exp, covar_0c_exp, covar_0cv_exp,</span>
<span id="cb44-607"><a href="#cb44-607" aria-hidden="true" tabindex="-1"></a>    covar_0v_exp, exp_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_exp, covar_vcv_exp,</span>
<span id="cb44-608"><a href="#cb44-608" aria-hidden="true" tabindex="-1"></a>    covar_0c_exp, covar_vc_exp, exp_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_exp,</span>
<span id="cb44-609"><a href="#cb44-609" aria-hidden="true" tabindex="-1"></a>    covar_0cv_exp, covar_vcv_exp, covar_cc_exp, exp_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb44-610"><a href="#cb44-610" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb44-611"><a href="#cb44-611" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-612"><a href="#cb44-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-613"><a href="#cb44-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the by-experiment random effects</span></span>
<span id="cb44-614"><a href="#cb44-614" aria-hidden="true" tabindex="-1"></a>exp_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_experiments,</span>
<span id="cb44-615"><a href="#cb44-615" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">EXP_0 =</span> <span class="dv">0</span>, <span class="at">EXP_v =</span> <span class="dv">0</span>, <span class="at">EXP_c =</span> <span class="dv">0</span>, <span class="at">EXP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb44-616"><a href="#cb44-616" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sigma =</span> cov_mx_exp)</span>
<span id="cb44-617"><a href="#cb44-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-618"><a href="#cb44-618" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the value of n_experiments</span></span>
<span id="cb44-619"><a href="#cb44-619" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_experiments <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb44-620"><a href="#cb44-620" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape to wide format</span></span>
<span id="cb44-621"><a href="#cb44-621" aria-hidden="true" tabindex="-1"></a>  exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(exp_rfx) <span class="sc">%&gt;%</span></span>
<span id="cb44-622"><a href="#cb44-622" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">effect =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-623"><a href="#cb44-623" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> effect, <span class="at">values_from =</span> <span class="st">"exp_rfx"</span>)</span>
<span id="cb44-624"><a href="#cb44-624" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-625"><a href="#cb44-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-626"><a href="#cb44-626" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with experiment IDs</span></span>
<span id="cb44-627"><a href="#cb44-627" aria-hidden="true" tabindex="-1"></a>exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">experiment_id =</span> <span class="fu">seq_len</span>(n_experiments), exp_rfx)</span>
<span id="cb44-628"><a href="#cb44-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-629"><a href="#cb44-629" aria-hidden="true" tabindex="-1"></a><span class="co"># add random effects to experiment data</span></span>
<span id="cb44-630"><a href="#cb44-630" aria-hidden="true" tabindex="-1"></a>experiments <span class="ot">&lt;-</span> <span class="fu">left_join</span>(experiments, exp_rfx, <span class="at">by =</span> <span class="st">"experiment_id"</span>)</span>
<span id="cb44-631"><a href="#cb44-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-632"><a href="#cb44-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-633"><a href="#cb44-633" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function</span></span>
<span id="cb44-634"><a href="#cb44-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-637"><a href="#cb44-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-638"><a href="#cb44-638" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate multiple experiments</span></span>
<span id="cb44-639"><a href="#cb44-639" aria-hidden="true" tabindex="-1"></a>draw_multiple_experiments <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb44-640"><a href="#cb44-640" aria-hidden="true" tabindex="-1"></a>    n_max_experiments, </span>
<span id="cb44-641"><a href="#cb44-641" aria-hidden="true" tabindex="-1"></a>    exp_0, <span class="co"># by-experiment intercept sd</span></span>
<span id="cb44-642"><a href="#cb44-642" aria-hidden="true" tabindex="-1"></a>    exp_v, <span class="co"># by-experiment sensitivity (d prime) sd</span></span>
<span id="cb44-643"><a href="#cb44-643" aria-hidden="true" tabindex="-1"></a>    exp_c, <span class="co"># by-experiment - delta response bias (i.e. - delta c) sd</span></span>
<span id="cb44-644"><a href="#cb44-644" aria-hidden="true" tabindex="-1"></a>    exp_cv, <span class="co"># by-experiment delta sensitivity (i.e. delta d prime) sd</span></span>
<span id="cb44-645"><a href="#cb44-645" aria-hidden="true" tabindex="-1"></a>    exp_rho_0v, <span class="co"># correlation between intercept (- average response bias) and sensitivity (d prime)</span></span>
<span id="cb44-646"><a href="#cb44-646" aria-hidden="true" tabindex="-1"></a>    exp_rho_0c, <span class="co"># correlation between intercept and - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-647"><a href="#cb44-647" aria-hidden="true" tabindex="-1"></a>    exp_rho_0cv, <span class="co"># correlation between intercept (- average response bias) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-648"><a href="#cb44-648" aria-hidden="true" tabindex="-1"></a>    exp_rho_vc, <span class="co"># correlation between sensitivity (d prime) and - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-649"><a href="#cb44-649" aria-hidden="true" tabindex="-1"></a>    exp_rho_vcv, <span class="co"># correlation between sensitivity (d prime) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-650"><a href="#cb44-650" aria-hidden="true" tabindex="-1"></a>    exp_rho_ccv, <span class="co"># correlation between - delta response bias (i.e. - delta c) and delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-651"><a href="#cb44-651" aria-hidden="true" tabindex="-1"></a>    ...) {</span>
<span id="cb44-652"><a href="#cb44-652" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-653"><a href="#cb44-653" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate random number of experiments</span></span>
<span id="cb44-654"><a href="#cb44-654" aria-hidden="true" tabindex="-1"></a>  possible_n_experiments <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> n_max_experiments, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb44-655"><a href="#cb44-655" aria-hidden="true" tabindex="-1"></a>  n_experiments <span class="ot">&lt;-</span> <span class="fu">sample</span>(possible_n_experiments, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb44-656"><a href="#cb44-656" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-657"><a href="#cb44-657" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw experiments</span></span>
<span id="cb44-658"><a href="#cb44-658" aria-hidden="true" tabindex="-1"></a>  experiments <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_experiments <span class="sc">%&gt;%</span></span>
<span id="cb44-659"><a href="#cb44-659" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-660"><a href="#cb44-660" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-661"><a href="#cb44-661" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-662"><a href="#cb44-662" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing experiment number "</span>, x))</span>
<span id="cb44-663"><a href="#cb44-663" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-664"><a href="#cb44-664" aria-hidden="true" tabindex="-1"></a>      single_experiment <span class="ot">&lt;-</span> <span class="fu">draw_experiment</span>(...) <span class="sc">%&gt;%</span> </span>
<span id="cb44-665"><a href="#cb44-665" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">experiment_id =</span> x)</span>
<span id="cb44-666"><a href="#cb44-666" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-667"><a href="#cb44-667" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_experiment)</span>
<span id="cb44-668"><a href="#cb44-668" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-669"><a href="#cb44-669" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-670"><a href="#cb44-670" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate covariances</span></span>
<span id="cb44-671"><a href="#cb44-671" aria-hidden="true" tabindex="-1"></a>  covar_0v_exp <span class="ot">&lt;-</span> exp_rho_0v <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_v</span>
<span id="cb44-672"><a href="#cb44-672" aria-hidden="true" tabindex="-1"></a>  covar_0c_exp <span class="ot">&lt;-</span> exp_rho_0c <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_c</span>
<span id="cb44-673"><a href="#cb44-673" aria-hidden="true" tabindex="-1"></a>  covar_0cv_exp <span class="ot">&lt;-</span> exp_rho_0cv <span class="sc">*</span> exp_0 <span class="sc">*</span> exp_cv</span>
<span id="cb44-674"><a href="#cb44-674" aria-hidden="true" tabindex="-1"></a>  covar_vc_exp <span class="ot">&lt;-</span> exp_rho_vc <span class="sc">*</span> exp_v <span class="sc">*</span> exp_c</span>
<span id="cb44-675"><a href="#cb44-675" aria-hidden="true" tabindex="-1"></a>  covar_vcv_exp <span class="ot">&lt;-</span> exp_rho_vcv <span class="sc">*</span> exp_v <span class="sc">*</span> exp_cv</span>
<span id="cb44-676"><a href="#cb44-676" aria-hidden="true" tabindex="-1"></a>  covar_cc_exp <span class="ot">&lt;-</span> exp_rho_ccv <span class="sc">*</span> exp_c <span class="sc">*</span> exp_cv</span>
<span id="cb44-677"><a href="#cb44-677" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-678"><a href="#cb44-678" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb44-679"><a href="#cb44-679" aria-hidden="true" tabindex="-1"></a>  cov_mx_exp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb44-680"><a href="#cb44-680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(exp_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_exp, covar_0c_exp, covar_0cv_exp,</span>
<span id="cb44-681"><a href="#cb44-681" aria-hidden="true" tabindex="-1"></a>      covar_0v_exp, exp_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_exp, covar_vcv_exp,</span>
<span id="cb44-682"><a href="#cb44-682" aria-hidden="true" tabindex="-1"></a>      covar_0c_exp, covar_vc_exp, exp_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_exp,</span>
<span id="cb44-683"><a href="#cb44-683" aria-hidden="true" tabindex="-1"></a>      covar_0cv_exp, covar_vcv_exp, covar_cc_exp, exp_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb44-684"><a href="#cb44-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb44-685"><a href="#cb44-685" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-686"><a href="#cb44-686" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-687"><a href="#cb44-687" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the by-experiment random effects</span></span>
<span id="cb44-688"><a href="#cb44-688" aria-hidden="true" tabindex="-1"></a>  exp_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_experiments,</span>
<span id="cb44-689"><a href="#cb44-689" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">EXP_0 =</span> <span class="dv">0</span>, <span class="at">EXP_v =</span> <span class="dv">0</span>, <span class="at">EXP_c =</span> <span class="dv">0</span>, <span class="at">EXP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb44-690"><a href="#cb44-690" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Sigma =</span> cov_mx_exp)</span>
<span id="cb44-691"><a href="#cb44-691" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-692"><a href="#cb44-692" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check the value of n_experiments</span></span>
<span id="cb44-693"><a href="#cb44-693" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n_experiments <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb44-694"><a href="#cb44-694" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if n == 1, mvnorm seems to return a vector, which data.frame then turns </span></span>
<span id="cb44-695"><a href="#cb44-695" aria-hidden="true" tabindex="-1"></a>    <span class="co"># into long format data (instead of wide-format when n_experiments &gt; 1)</span></span>
<span id="cb44-696"><a href="#cb44-696" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reshape to wide format</span></span>
<span id="cb44-697"><a href="#cb44-697" aria-hidden="true" tabindex="-1"></a>    exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(exp_rfx) <span class="sc">%&gt;%</span></span>
<span id="cb44-698"><a href="#cb44-698" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">effect =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-699"><a href="#cb44-699" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> effect, <span class="at">values_from =</span> <span class="st">"exp_rfx"</span>)</span>
<span id="cb44-700"><a href="#cb44-700" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-701"><a href="#cb44-701" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-702"><a href="#cb44-702" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with experiment IDs</span></span>
<span id="cb44-703"><a href="#cb44-703" aria-hidden="true" tabindex="-1"></a>  exp_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">experiment_id =</span> <span class="fu">seq_len</span>(n_experiments), exp_rfx)</span>
<span id="cb44-704"><a href="#cb44-704" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-705"><a href="#cb44-705" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random effects to experiment data</span></span>
<span id="cb44-706"><a href="#cb44-706" aria-hidden="true" tabindex="-1"></a>  experiments <span class="ot">&lt;-</span> <span class="fu">left_join</span>(experiments, exp_rfx, <span class="at">by =</span> <span class="st">"experiment_id"</span>)</span>
<span id="cb44-707"><a href="#cb44-707" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-708"><a href="#cb44-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(experiments)</span>
<span id="cb44-709"><a href="#cb44-709" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-710"><a href="#cb44-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-711"><a href="#cb44-711" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb44-712"><a href="#cb44-712" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_multiple_experiments, parameters)</span></span>
<span id="cb44-713"><a href="#cb44-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-714"><a href="#cb44-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-715"><a href="#cb44-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulate various papers</span></span>
<span id="cb44-716"><a href="#cb44-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-717"><a href="#cb44-717" aria-hidden="true" tabindex="-1"></a>Finally, we have various papers. As for experiments, we expect random effects for papers (because of authors, country, time, etc.). </span>
<span id="cb44-718"><a href="#cb44-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-719"><a href="#cb44-719" aria-hidden="true" tabindex="-1"></a>For example, we might have 20 papers. </span>
<span id="cb44-720"><a href="#cb44-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-723"><a href="#cb44-723" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-724"><a href="#cb44-724" aria-hidden="true" tabindex="-1"></a>n_papers <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb44-725"><a href="#cb44-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-726"><a href="#cb44-726" aria-hidden="true" tabindex="-1"></a><span class="co"># draw papers</span></span>
<span id="cb44-727"><a href="#cb44-727" aria-hidden="true" tabindex="-1"></a>papers <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_papers <span class="sc">%&gt;%</span></span>
<span id="cb44-728"><a href="#cb44-728" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-729"><a href="#cb44-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-730"><a href="#cb44-730" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-731"><a href="#cb44-731" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing paper number "</span>, x))</span>
<span id="cb44-732"><a href="#cb44-732" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-733"><a href="#cb44-733" aria-hidden="true" tabindex="-1"></a>      single_paper <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_multiple_experiments, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb44-734"><a href="#cb44-734" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">paper_id =</span> x)</span>
<span id="cb44-735"><a href="#cb44-735" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-736"><a href="#cb44-736" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_paper)</span>
<span id="cb44-737"><a href="#cb44-737" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-738"><a href="#cb44-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-739"><a href="#cb44-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-740"><a href="#cb44-740" aria-hidden="true" tabindex="-1"></a>And the random effects random effects. </span>
<span id="cb44-741"><a href="#cb44-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-744"><a href="#cb44-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-745"><a href="#cb44-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate covariances</span></span>
<span id="cb44-746"><a href="#cb44-746" aria-hidden="true" tabindex="-1"></a>covar_0v_paper <span class="ot">&lt;-</span> paper_rho_0v <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_v</span>
<span id="cb44-747"><a href="#cb44-747" aria-hidden="true" tabindex="-1"></a>covar_0c_paper <span class="ot">&lt;-</span> paper_rho_0c <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_c</span>
<span id="cb44-748"><a href="#cb44-748" aria-hidden="true" tabindex="-1"></a>covar_0cv_paper <span class="ot">&lt;-</span> paper_rho_0cv <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_cv</span>
<span id="cb44-749"><a href="#cb44-749" aria-hidden="true" tabindex="-1"></a>covar_vc_paper <span class="ot">&lt;-</span> paper_rho_vc <span class="sc">*</span> paper_v <span class="sc">*</span> paper_c</span>
<span id="cb44-750"><a href="#cb44-750" aria-hidden="true" tabindex="-1"></a>covar_vcv_paper <span class="ot">&lt;-</span> paper_rho_vcv <span class="sc">*</span> paper_v <span class="sc">*</span> paper_cv</span>
<span id="cb44-751"><a href="#cb44-751" aria-hidden="true" tabindex="-1"></a>covar_cc_paper <span class="ot">&lt;-</span> paper_rho_ccv <span class="sc">*</span> paper_c <span class="sc">*</span> paper_cv</span>
<span id="cb44-752"><a href="#cb44-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-753"><a href="#cb44-753" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb44-754"><a href="#cb44-754" aria-hidden="true" tabindex="-1"></a>cov_mx_paper <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb44-755"><a href="#cb44-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(paper_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_paper, covar_0c_paper, covar_0cv_paper,</span>
<span id="cb44-756"><a href="#cb44-756" aria-hidden="true" tabindex="-1"></a>    covar_0v_paper, paper_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_paper, covar_vcv_paper,</span>
<span id="cb44-757"><a href="#cb44-757" aria-hidden="true" tabindex="-1"></a>    covar_0c_paper, covar_vc_paper, paper_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_paper,</span>
<span id="cb44-758"><a href="#cb44-758" aria-hidden="true" tabindex="-1"></a>    covar_0cv_paper, covar_vcv_paper, covar_cc_paper, paper_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb44-759"><a href="#cb44-759" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb44-760"><a href="#cb44-760" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-761"><a href="#cb44-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-762"><a href="#cb44-762" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the by-paper random effects</span></span>
<span id="cb44-763"><a href="#cb44-763" aria-hidden="true" tabindex="-1"></a>paper_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_papers,</span>
<span id="cb44-764"><a href="#cb44-764" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">PAP_0 =</span> <span class="dv">0</span>, <span class="at">PAP_v =</span> <span class="dv">0</span>, <span class="at">PAP_c =</span> <span class="dv">0</span>, <span class="at">PAP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb44-765"><a href="#cb44-765" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sigma =</span> cov_mx_paper)</span>
<span id="cb44-766"><a href="#cb44-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-767"><a href="#cb44-767" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with paper IDs</span></span>
<span id="cb44-768"><a href="#cb44-768" aria-hidden="true" tabindex="-1"></a>paper_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">paper_id =</span> <span class="fu">seq_len</span>(n_papers), paper_rfx)</span>
<span id="cb44-769"><a href="#cb44-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-770"><a href="#cb44-770" aria-hidden="true" tabindex="-1"></a><span class="co"># add random effects to paper data</span></span>
<span id="cb44-771"><a href="#cb44-771" aria-hidden="true" tabindex="-1"></a>papers <span class="ot">&lt;-</span> <span class="fu">left_join</span>(papers, paper_rfx)</span>
<span id="cb44-772"><a href="#cb44-772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-773"><a href="#cb44-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-774"><a href="#cb44-774" aria-hidden="true" tabindex="-1"></a>Finally, we want to be able to uniquely identify participants and experiments across papers (for now, there is a participant labeled "1" in each experiment, and there is an experiment "1" in each paper).</span>
<span id="cb44-775"><a href="#cb44-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-778"><a href="#cb44-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-779"><a href="#cb44-779" aria-hidden="true" tabindex="-1"></a>papers <span class="ot">&lt;-</span> papers <span class="sc">%&gt;%</span> </span>
<span id="cb44-780"><a href="#cb44-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(    </span>
<span id="cb44-781"><a href="#cb44-781" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique experiment identifier</span></span>
<span id="cb44-782"><a href="#cb44-782" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_experiment_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, <span class="at">sep =</span> <span class="st">"_"</span>), </span>
<span id="cb44-783"><a href="#cb44-783" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique participant identifier</span></span>
<span id="cb44-784"><a href="#cb44-784" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_subject_id =</span> <span class="fu">paste0</span>(paper_id, <span class="st">"_"</span>, experiment_id, intervention_id, <span class="st">"_"</span>, subject_id), </span>
<span id="cb44-785"><a href="#cb44-785" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique intervention identifier</span></span>
<span id="cb44-786"><a href="#cb44-786" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_intervention_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, intervention_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb44-787"><a href="#cb44-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-788"><a href="#cb44-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-789"><a href="#cb44-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Function</span></span>
<span id="cb44-790"><a href="#cb44-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-793"><a href="#cb44-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-794"><a href="#cb44-794" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate papers</span></span>
<span id="cb44-795"><a href="#cb44-795" aria-hidden="true" tabindex="-1"></a>draw_papers <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb44-796"><a href="#cb44-796" aria-hidden="true" tabindex="-1"></a>    paper_0, <span class="co"># analogous to experiment random effects</span></span>
<span id="cb44-797"><a href="#cb44-797" aria-hidden="true" tabindex="-1"></a>    paper_v,</span>
<span id="cb44-798"><a href="#cb44-798" aria-hidden="true" tabindex="-1"></a>    paper_c,</span>
<span id="cb44-799"><a href="#cb44-799" aria-hidden="true" tabindex="-1"></a>    paper_cv,</span>
<span id="cb44-800"><a href="#cb44-800" aria-hidden="true" tabindex="-1"></a>    paper_rho_0v,</span>
<span id="cb44-801"><a href="#cb44-801" aria-hidden="true" tabindex="-1"></a>    paper_rho_0c,</span>
<span id="cb44-802"><a href="#cb44-802" aria-hidden="true" tabindex="-1"></a>    paper_rho_0cv,</span>
<span id="cb44-803"><a href="#cb44-803" aria-hidden="true" tabindex="-1"></a>    paper_rho_vc,</span>
<span id="cb44-804"><a href="#cb44-804" aria-hidden="true" tabindex="-1"></a>    paper_rho_vcv, </span>
<span id="cb44-805"><a href="#cb44-805" aria-hidden="true" tabindex="-1"></a>    paper_rho_ccv,</span>
<span id="cb44-806"><a href="#cb44-806" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_papers =</span> <span class="dv">10</span>, <span class="co"># number of papers in the meta analysis</span></span>
<span id="cb44-807"><a href="#cb44-807" aria-hidden="true" tabindex="-1"></a>    ...) {</span>
<span id="cb44-808"><a href="#cb44-808" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-809"><a href="#cb44-809" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw papers</span></span>
<span id="cb44-810"><a href="#cb44-810" aria-hidden="true" tabindex="-1"></a>  papers <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span>n_papers <span class="sc">%&gt;%</span></span>
<span id="cb44-811"><a href="#cb44-811" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-812"><a href="#cb44-812" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-813"><a href="#cb44-813" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-814"><a href="#cb44-814" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"drawing paper number "</span>, x))</span>
<span id="cb44-815"><a href="#cb44-815" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-816"><a href="#cb44-816" aria-hidden="true" tabindex="-1"></a>      single_paper <span class="ot">&lt;-</span> <span class="fu">do.call</span>(draw_multiple_experiments, parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb44-817"><a href="#cb44-817" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">paper_id =</span> x)</span>
<span id="cb44-818"><a href="#cb44-818" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-819"><a href="#cb44-819" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(single_paper)</span>
<span id="cb44-820"><a href="#cb44-820" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-821"><a href="#cb44-821" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-822"><a href="#cb44-822" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate covariances</span></span>
<span id="cb44-823"><a href="#cb44-823" aria-hidden="true" tabindex="-1"></a>  covar_0v_paper <span class="ot">&lt;-</span> paper_rho_0v <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_v</span>
<span id="cb44-824"><a href="#cb44-824" aria-hidden="true" tabindex="-1"></a>  covar_0c_paper <span class="ot">&lt;-</span> paper_rho_0c <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_c</span>
<span id="cb44-825"><a href="#cb44-825" aria-hidden="true" tabindex="-1"></a>  covar_0cv_paper <span class="ot">&lt;-</span> paper_rho_0cv <span class="sc">*</span> paper_0 <span class="sc">*</span> paper_cv</span>
<span id="cb44-826"><a href="#cb44-826" aria-hidden="true" tabindex="-1"></a>  covar_vc_paper <span class="ot">&lt;-</span> paper_rho_vc <span class="sc">*</span> paper_v <span class="sc">*</span> paper_c</span>
<span id="cb44-827"><a href="#cb44-827" aria-hidden="true" tabindex="-1"></a>  covar_vcv_paper <span class="ot">&lt;-</span> paper_rho_vcv <span class="sc">*</span> paper_v <span class="sc">*</span> paper_cv</span>
<span id="cb44-828"><a href="#cb44-828" aria-hidden="true" tabindex="-1"></a>  covar_cc_paper <span class="ot">&lt;-</span> paper_rho_ccv <span class="sc">*</span> paper_c <span class="sc">*</span> paper_cv</span>
<span id="cb44-829"><a href="#cb44-829" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-830"><a href="#cb44-830" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the variance-covariance matrix</span></span>
<span id="cb44-831"><a href="#cb44-831" aria-hidden="true" tabindex="-1"></a>  cov_mx_paper <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb44-832"><a href="#cb44-832" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(paper_0<span class="sc">^</span><span class="dv">2</span>, covar_0v_paper, covar_0c_paper, covar_0cv_paper,</span>
<span id="cb44-833"><a href="#cb44-833" aria-hidden="true" tabindex="-1"></a>      covar_0v_paper, paper_v<span class="sc">^</span><span class="dv">2</span>, covar_vc_paper, covar_vcv_paper,</span>
<span id="cb44-834"><a href="#cb44-834" aria-hidden="true" tabindex="-1"></a>      covar_0c_paper, covar_vc_paper, paper_c<span class="sc">^</span><span class="dv">2</span>, covar_cc_paper,</span>
<span id="cb44-835"><a href="#cb44-835" aria-hidden="true" tabindex="-1"></a>      covar_0cv_paper, covar_vcv_paper, covar_cc_paper, paper_cv<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb44-836"><a href="#cb44-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb44-837"><a href="#cb44-837" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-838"><a href="#cb44-838" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-839"><a href="#cb44-839" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate the by-paper random effects</span></span>
<span id="cb44-840"><a href="#cb44-840" aria-hidden="true" tabindex="-1"></a>  paper_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_papers,</span>
<span id="cb44-841"><a href="#cb44-841" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">PAP_0 =</span> <span class="dv">0</span>, <span class="at">PAP_v =</span> <span class="dv">0</span>, <span class="at">PAP_c =</span> <span class="dv">0</span>, <span class="at">PAP_cv =</span> <span class="dv">0</span>),</span>
<span id="cb44-842"><a href="#cb44-842" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Sigma =</span> cov_mx_paper)</span>
<span id="cb44-843"><a href="#cb44-843" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-844"><a href="#cb44-844" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with paper IDs</span></span>
<span id="cb44-845"><a href="#cb44-845" aria-hidden="true" tabindex="-1"></a>  paper_rfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">paper_id =</span> <span class="fu">seq_len</span>(n_papers), paper_rfx)</span>
<span id="cb44-846"><a href="#cb44-846" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-847"><a href="#cb44-847" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random effects to paper data</span></span>
<span id="cb44-848"><a href="#cb44-848" aria-hidden="true" tabindex="-1"></a>  papers <span class="ot">&lt;-</span> <span class="fu">left_join</span>(papers, paper_rfx) <span class="sc">%&gt;%</span> </span>
<span id="cb44-849"><a href="#cb44-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(    </span>
<span id="cb44-850"><a href="#cb44-850" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique experiment identifier</span></span>
<span id="cb44-851"><a href="#cb44-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_experiment_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, <span class="at">sep =</span> <span class="st">"_"</span>), </span>
<span id="cb44-852"><a href="#cb44-852" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique participant identifier</span></span>
<span id="cb44-853"><a href="#cb44-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_subject_id =</span> <span class="fu">paste0</span>(paper_id, <span class="st">"_"</span>, experiment_id, intervention_id, <span class="st">"_"</span>, subject_id), </span>
<span id="cb44-854"><a href="#cb44-854" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique intervention identifier</span></span>
<span id="cb44-855"><a href="#cb44-855" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_intervention_id =</span> <span class="fu">paste</span>(paper_id, experiment_id, intervention_id, <span class="at">sep =</span> <span class="st">"_"</span>))</span>
<span id="cb44-856"><a href="#cb44-856" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-857"><a href="#cb44-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-858"><a href="#cb44-858" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb44-859"><a href="#cb44-859" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(draw_papers, parameters)</span></span>
<span id="cb44-860"><a href="#cb44-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-861"><a href="#cb44-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-862"><a href="#cb44-862" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model accuracy ratings</span></span>
<span id="cb44-863"><a href="#cb44-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-864"><a href="#cb44-864" aria-hidden="true" tabindex="-1"></a>At this point, we have simulated data with all necessary information to generate accuracy ratings, according to our model. </span>
<span id="cb44-865"><a href="#cb44-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-868"><a href="#cb44-868" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-869"><a href="#cb44-869" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate accuracy</span></span>
<span id="cb44-870"><a href="#cb44-870" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> papers <span class="sc">%&gt;%</span> </span>
<span id="cb44-871"><a href="#cb44-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-872"><a href="#cb44-872" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make numeric helper variables using deviation coding</span></span>
<span id="cb44-873"><a href="#cb44-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">veracity_numeric =</span> <span class="fu">ifelse</span>(veracity <span class="sc">==</span> <span class="st">"true"</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb44-874"><a href="#cb44-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">condition_numeric =</span> <span class="fu">ifelse</span>(condition <span class="sc">==</span> <span class="st">"intervention"</span>,  <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb44-875"><a href="#cb44-875" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate z-value accuracy</span></span>
<span id="cb44-876"><a href="#cb44-876" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy_z_value =</span> </span>
<span id="cb44-877"><a href="#cb44-877" aria-hidden="true" tabindex="-1"></a>      (beta_0 <span class="sc">+</span> SU_0 <span class="sc">+</span> EXP_0 <span class="sc">+</span> PAP_0) <span class="sc">+</span></span>
<span id="cb44-878"><a href="#cb44-878" aria-hidden="true" tabindex="-1"></a>      (beta_v <span class="sc">+</span> SU_v <span class="sc">+</span> EXP_v <span class="sc">+</span> PAP_v)<span class="sc">*</span>veracity_numeric <span class="sc">+</span></span>
<span id="cb44-879"><a href="#cb44-879" aria-hidden="true" tabindex="-1"></a>      (beta_c <span class="sc">+</span> EXP_c <span class="sc">+</span> PAP_c )<span class="sc">*</span>condition_numeric<span class="sc">+</span></span>
<span id="cb44-880"><a href="#cb44-880" aria-hidden="true" tabindex="-1"></a>      (beta_cv <span class="sc">+</span> EXP_cv <span class="sc">+</span> PAP_cv)<span class="sc">*</span>(condition_numeric<span class="sc">*</span>veracity_numeric) <span class="sc">+</span></span>
<span id="cb44-881"><a href="#cb44-881" aria-hidden="true" tabindex="-1"></a>      e_s,</span>
<span id="cb44-882"><a href="#cb44-882" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use the probit function (i.e. cumulative distribution function of the standard normal distribution)</span></span>
<span id="cb44-883"><a href="#cb44-883" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to optain probabilities from the z-values</span></span>
<span id="cb44-884"><a href="#cb44-884" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy_probability =</span> <span class="fu">pnorm</span>(accuracy_z_value), </span>
<span id="cb44-885"><a href="#cb44-885" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate a binary accuracy response by sampling from a bernoulli distribution</span></span>
<span id="cb44-886"><a href="#cb44-886" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (i.e. binomial distribution with one trial)</span></span>
<span id="cb44-887"><a href="#cb44-887" aria-hidden="true" tabindex="-1"></a>    <span class="at">accuracy =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(.), <span class="dv">1</span>, accuracy_probability)</span>
<span id="cb44-888"><a href="#cb44-888" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-889"><a href="#cb44-889" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove random effect variables</span></span>
<span id="cb44-890"><a href="#cb44-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"SU|EXP|PAP"</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span>
<span id="cb44-891"><a href="#cb44-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-892"><a href="#cb44-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-893"><a href="#cb44-893" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Function</span></span>
<span id="cb44-894"><a href="#cb44-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-897"><a href="#cb44-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-898"><a href="#cb44-898" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate accuracy outcomes</span></span>
<span id="cb44-899"><a href="#cb44-899" aria-hidden="true" tabindex="-1"></a>calculate_accuracy <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb44-900"><a href="#cb44-900" aria-hidden="true" tabindex="-1"></a>    data, </span>
<span id="cb44-901"><a href="#cb44-901" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fixed effects</span></span>
<span id="cb44-902"><a href="#cb44-902" aria-hidden="true" tabindex="-1"></a>    beta_0, <span class="co"># intercept (- average response bias )</span></span>
<span id="cb44-903"><a href="#cb44-903" aria-hidden="true" tabindex="-1"></a>    beta_v, <span class="co"># average sensitivity (d prime) </span></span>
<span id="cb44-904"><a href="#cb44-904" aria-hidden="true" tabindex="-1"></a>    beta_c, <span class="co"># - delta response bias (i.e. - delta c)</span></span>
<span id="cb44-905"><a href="#cb44-905" aria-hidden="true" tabindex="-1"></a>    beta_cv, <span class="co"># delta sensitivity (i.e. delta d prime)</span></span>
<span id="cb44-906"><a href="#cb44-906" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb44-907"><a href="#cb44-907" aria-hidden="true" tabindex="-1"></a>    ){</span>
<span id="cb44-908"><a href="#cb44-908" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-909"><a href="#cb44-909" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb44-910"><a href="#cb44-910" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb44-911"><a href="#cb44-911" aria-hidden="true" tabindex="-1"></a>      <span class="co"># make numeric helper variables using deviation coding</span></span>
<span id="cb44-912"><a href="#cb44-912" aria-hidden="true" tabindex="-1"></a>      <span class="at">veracity_numeric =</span> <span class="fu">ifelse</span>(veracity <span class="sc">==</span> <span class="st">"true"</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb44-913"><a href="#cb44-913" aria-hidden="true" tabindex="-1"></a>      <span class="at">condition_numeric =</span> <span class="fu">ifelse</span>(condition <span class="sc">==</span> <span class="st">"intervention"</span>,  <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb44-914"><a href="#cb44-914" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate z-value accuracy</span></span>
<span id="cb44-915"><a href="#cb44-915" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy_z_value =</span> </span>
<span id="cb44-916"><a href="#cb44-916" aria-hidden="true" tabindex="-1"></a>        (beta_0 <span class="sc">+</span> SU_0 <span class="sc">+</span> EXP_0 <span class="sc">+</span> PAP_0) <span class="sc">+</span></span>
<span id="cb44-917"><a href="#cb44-917" aria-hidden="true" tabindex="-1"></a>        (beta_v <span class="sc">+</span> SU_v <span class="sc">+</span> EXP_v <span class="sc">+</span> PAP_v)<span class="sc">*</span>veracity_numeric <span class="sc">+</span></span>
<span id="cb44-918"><a href="#cb44-918" aria-hidden="true" tabindex="-1"></a>        (beta_c <span class="sc">+</span> EXP_c <span class="sc">+</span> PAP_c )<span class="sc">*</span>condition_numeric<span class="sc">+</span></span>
<span id="cb44-919"><a href="#cb44-919" aria-hidden="true" tabindex="-1"></a>        (beta_cv <span class="sc">+</span> EXP_cv <span class="sc">+</span> PAP_cv)<span class="sc">*</span>(condition_numeric<span class="sc">*</span>veracity_numeric) <span class="sc">+</span></span>
<span id="cb44-920"><a href="#cb44-920" aria-hidden="true" tabindex="-1"></a>        e_s,</span>
<span id="cb44-921"><a href="#cb44-921" aria-hidden="true" tabindex="-1"></a>      <span class="co"># use the probit function (i.e. cumulative distribution function of the standard normal distribution)</span></span>
<span id="cb44-922"><a href="#cb44-922" aria-hidden="true" tabindex="-1"></a>      <span class="co"># to optain probabilities from the z-values</span></span>
<span id="cb44-923"><a href="#cb44-923" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy_probability =</span> <span class="fu">pnorm</span>(accuracy_z_value), </span>
<span id="cb44-924"><a href="#cb44-924" aria-hidden="true" tabindex="-1"></a>      <span class="co"># generate a binary accuracy response by sampling from a bernoulli distribution</span></span>
<span id="cb44-925"><a href="#cb44-925" aria-hidden="true" tabindex="-1"></a>      <span class="co"># (i.e. binomial distribution with one trial)</span></span>
<span id="cb44-926"><a href="#cb44-926" aria-hidden="true" tabindex="-1"></a>      <span class="at">accuracy =</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(.), <span class="dv">1</span>, accuracy_probability)</span>
<span id="cb44-927"><a href="#cb44-927" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-928"><a href="#cb44-928" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove random effect variables</span></span>
<span id="cb44-929"><a href="#cb44-929" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"SU|EXP|PAP"</span>, <span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span>
<span id="cb44-930"><a href="#cb44-930" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-931"><a href="#cb44-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-932"><a href="#cb44-932" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb44-933"><a href="#cb44-933" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- calculate_accuracy(papers)</span></span>
<span id="cb44-934"><a href="#cb44-934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-935"><a href="#cb44-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-936"><a href="#cb44-936" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulation of a single data set for pre-registration</span></span>
<span id="cb44-937"><a href="#cb44-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-938"><a href="#cb44-938" aria-hidden="true" tabindex="-1"></a>We to use all the previous functions in a single simulation, we combine the <span class="in">`draw_papers()`</span> and <span class="in">`call_accuracy()`</span> functions. We call the final function <span class="in">`simulate_data()`</span>.</span>
<span id="cb44-939"><a href="#cb44-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-942"><a href="#cb44-942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-943"><a href="#cb44-943" aria-hidden="true" tabindex="-1"></a><span class="co"># final data simulation function</span></span>
<span id="cb44-944"><a href="#cb44-944" aria-hidden="true" tabindex="-1"></a>simulate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb44-945"><a href="#cb44-945" aria-hidden="true" tabindex="-1"></a>  papers <span class="ot">&lt;-</span> <span class="fu">draw_papers</span>(...)</span>
<span id="cb44-946"><a href="#cb44-946" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-947"><a href="#cb44-947" aria-hidden="true" tabindex="-1"></a>  final_data <span class="ot">&lt;-</span> <span class="fu">calculate_accuracy</span>(papers, ...)</span>
<span id="cb44-948"><a href="#cb44-948" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-949"><a href="#cb44-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_data)</span>
<span id="cb44-950"><a href="#cb44-950" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-951"><a href="#cb44-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-952"><a href="#cb44-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-953"><a href="#cb44-953" aria-hidden="true" tabindex="-1"></a>We can then simulate our participant-level data, based on the previously set parameters.</span>
<span id="cb44-954"><a href="#cb44-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-957"><a href="#cb44-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-958"><a href="#cb44-958" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">do.call</span>(simulate_data, parameters)</span>
<span id="cb44-959"><a href="#cb44-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-960"><a href="#cb44-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-961"><a href="#cb44-961" aria-hidden="true" tabindex="-1"></a><span class="fu">## Add moderators</span></span>
<span id="cb44-962"><a href="#cb44-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-963"><a href="#cb44-963" aria-hidden="true" tabindex="-1"></a><span class="fu">### Within-experiment moderator</span></span>
<span id="cb44-964"><a href="#cb44-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-965"><a href="#cb44-965" aria-hidden="true" tabindex="-1"></a>The most important within-participant moderator we will look at is political concordance. Let's assume that half our our news item ratings were politically concordant and half not.</span>
<span id="cb44-966"><a href="#cb44-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-969"><a href="#cb44-969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-970"><a href="#cb44-970" aria-hidden="true" tabindex="-1"></a><span class="co"># add some other variables for demonstration purpose</span></span>
<span id="cb44-971"><a href="#cb44-971" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb44-972"><a href="#cb44-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-973"><a href="#cb44-973" aria-hidden="true" tabindex="-1"></a>    <span class="co"># political concordance</span></span>
<span id="cb44-974"><a href="#cb44-974" aria-hidden="true" tabindex="-1"></a>    <span class="at">political_concordance =</span> <span class="fu">ifelse</span>(item_id <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"concordant"</span>, <span class="st">"discordant"</span>),</span>
<span id="cb44-975"><a href="#cb44-975" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add a deviation coded version for the political concordance variable</span></span>
<span id="cb44-976"><a href="#cb44-976" aria-hidden="true" tabindex="-1"></a>    <span class="at">concordance_numeric =</span> <span class="fu">ifelse</span>(political_concordance <span class="sc">==</span> <span class="st">"discordant"</span>, </span>
<span id="cb44-977"><a href="#cb44-977" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">-</span><span class="fl">0.5</span>, <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(political_concordance), </span>
<span id="cb44-978"><a href="#cb44-978" aria-hidden="true" tabindex="-1"></a>                                              <span class="fl">0.5</span>, </span>
<span id="cb44-979"><a href="#cb44-979" aria-hidden="true" tabindex="-1"></a>                                              <span class="cn">NA</span>)</span>
<span id="cb44-980"><a href="#cb44-980" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-981"><a href="#cb44-981" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb44-982"><a href="#cb44-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-983"><a href="#cb44-983" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb44-984"><a href="#cb44-984" aria-hidden="true" tabindex="-1"></a><span class="co"># data %&gt;% </span></span>
<span id="cb44-985"><a href="#cb44-985" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(concordance_numeric, political_concordance)</span></span>
<span id="cb44-986"><a href="#cb44-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-987"><a href="#cb44-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-988"><a href="#cb44-988" aria-hidden="true" tabindex="-1"></a>A second moderator that varies within experiments, but between participants, is age. </span>
<span id="cb44-989"><a href="#cb44-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-992"><a href="#cb44-992" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-993"><a href="#cb44-993" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly assing intervention types</span></span>
<span id="cb44-994"><a href="#cb44-994" aria-hidden="true" tabindex="-1"></a>participant_ages <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb44-995"><a href="#cb44-995" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique combinations of unique_experiment_id and condition</span></span>
<span id="cb44-996"><a href="#cb44-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(unique_subject_id) <span class="sc">%&gt;%</span> </span>
<span id="cb44-997"><a href="#cb44-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-998"><a href="#cb44-998" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample from intervention types only when condition is not "control"</span></span>
<span id="cb44-999"><a href="#cb44-999" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">70</span>), <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-1000"><a href="#cb44-1000" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-1001"><a href="#cb44-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1002"><a href="#cb44-1002" aria-hidden="true" tabindex="-1"></a><span class="co"># add intervention types to data</span></span>
<span id="cb44-1003"><a href="#cb44-1003" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, participant_ages)</span>
<span id="cb44-1004"><a href="#cb44-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1005"><a href="#cb44-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1006"><a href="#cb44-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">### Between-experiment moderator</span></span>
<span id="cb44-1007"><a href="#cb44-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1008"><a href="#cb44-1008" aria-hidden="true" tabindex="-1"></a>The most important between-experiment moderator we will look at is intervention type. To illustrate, let's assume that all used interventions can be classified as one out of three broad categories of interventions (let's call them "literacy tips", "priming", "warning labels").</span>
<span id="cb44-1009"><a href="#cb44-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1010"><a href="#cb44-1010" aria-hidden="true" tabindex="-1"></a>Sometimes, within the same experiment, researchers might have tested different interventions. Since we will likely have to deal with that case, we should simulate it here. </span>
<span id="cb44-1011"><a href="#cb44-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1014"><a href="#cb44-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1015"><a href="#cb44-1015" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly assing intervention types</span></span>
<span id="cb44-1016"><a href="#cb44-1016" aria-hidden="true" tabindex="-1"></a>intervention_types <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb44-1017"><a href="#cb44-1017" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique combinations of unique_experiment_id and condition</span></span>
<span id="cb44-1018"><a href="#cb44-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(unique_intervention_id, condition) <span class="sc">%&gt;%</span> </span>
<span id="cb44-1019"><a href="#cb44-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-1020"><a href="#cb44-1020" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample from intervention types only when condition is not "control"</span></span>
<span id="cb44-1021"><a href="#cb44-1021" aria-hidden="true" tabindex="-1"></a>    <span class="at">intervention_type =</span> <span class="fu">ifelse</span>(condition <span class="sc">!=</span> <span class="st">"control"</span>,</span>
<span id="cb44-1022"><a href="#cb44-1022" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"literacy tips"</span>, <span class="st">"priming"</span>, <span class="st">"warning labels"</span>), </span>
<span id="cb44-1023"><a href="#cb44-1023" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">size =</span> <span class="fu">sum</span>(condition <span class="sc">!=</span> <span class="st">"control"</span>), </span>
<span id="cb44-1024"><a href="#cb44-1024" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb44-1025"><a href="#cb44-1025" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"control"</span>)</span>
<span id="cb44-1026"><a href="#cb44-1026" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-1027"><a href="#cb44-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1028"><a href="#cb44-1028" aria-hidden="true" tabindex="-1"></a><span class="co"># add intervention types to data</span></span>
<span id="cb44-1029"><a href="#cb44-1029" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data, intervention_types)</span>
<span id="cb44-1030"><a href="#cb44-1030" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1031"><a href="#cb44-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1032"><a href="#cb44-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">## Store simulated data</span></span>
<span id="cb44-1033"><a href="#cb44-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1036"><a href="#cb44-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1037"><a href="#cb44-1037" aria-hidden="true" tabindex="-1"></a><span class="co"># store individual level data</span></span>
<span id="cb44-1038"><a href="#cb44-1038" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"../data/simulations/individual_level.csv"</span> </span>
<span id="cb44-1039"><a href="#cb44-1039" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(data, filename)</span>
<span id="cb44-1040"><a href="#cb44-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1041"><a href="#cb44-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1042"><a href="#cb44-1042" aria-hidden="true" tabindex="-1"></a><span class="fu"># Sensitivity analysis and parameter recovery</span></span>
<span id="cb44-1043"><a href="#cb44-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1044"><a href="#cb44-1044" aria-hidden="true" tabindex="-1"></a>We will run a kind of sensitivity analysis. </span>
<span id="cb44-1045"><a href="#cb44-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1046"><a href="#cb44-1046" aria-hidden="true" tabindex="-1"></a>For the simulation, we--conservatively--assumed that the meta-analysis sample will consist of 10 papers. We assumed that each paper has between 1 and 4 experiments, and each experiment can have between two and four experimental arms (one of which is always the control condition). For each experimental arm, we assumed a sample size of 100 participants. The number of experiments per paper and arms per experiments was chosen randomly for each study. We further assumed that participants always saw 5 true and 5 false news. For details about other parameter assumptions, see the parameter list specified above. Although our final sample of papers will probably have properties quite different from what we assumed here, we believe these assumptions are rather conservative. </span>
<span id="cb44-1047"><a href="#cb44-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1048"><a href="#cb44-1048" aria-hidden="true" tabindex="-1"></a>In our simulations, we vary the values for the true effect sizes for d'prime and c in the data. For each combination of effect sizes, we run 100 iterations, i.e. 100 times we generate a different sample of 10 papers, and run our meta-analysis on that sample. The aim of the sensitivity analysis consists in checking how many of these 100 meta-analyses find a significant effect. The share of analyses that detect the true effect is the statistical power.</span>
<span id="cb44-1049"><a href="#cb44-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1050"><a href="#cb44-1050" aria-hidden="true" tabindex="-1"></a>Instead of only checking whether our models find a significant effect or not, we also descriptively check how well our model estimates recover the data generating parameters. </span>
<span id="cb44-1051"><a href="#cb44-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1052"><a href="#cb44-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimator</span></span>
<span id="cb44-1053"><a href="#cb44-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1054"><a href="#cb44-1054" aria-hidden="true" tabindex="-1"></a>We start by defining the model we use to estimate our effects, and select the outcomes of interest. We will run a participant-level meta analysis using a two-stage approach: First, for each experiment, we calculate the above mixed model. The resulting estimates are our effect sizes. Second, we run a meta analysis on these effect sizes.</span>
<span id="cb44-1055"><a href="#cb44-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1056"><a href="#cb44-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">### Define the model</span></span>
<span id="cb44-1057"><a href="#cb44-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1058"><a href="#cb44-1058" aria-hidden="true" tabindex="-1"></a>We first write a function for calculating the model for each experiment.</span>
<span id="cb44-1059"><a href="#cb44-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1062"><a href="#cb44-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1063"><a href="#cb44-1063" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate model function</span></span>
<span id="cb44-1064"><a href="#cb44-1064" aria-hidden="true" tabindex="-1"></a>calculate_SDT_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb44-1065"><a href="#cb44-1065" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1066"><a href="#cb44-1066" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb44-1067"><a href="#cb44-1067" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">glmer</span>(accuracy <span class="sc">~</span> veracity_numeric <span class="sc">+</span> condition_numeric <span class="sc">+</span> </span>
<span id="cb44-1068"><a href="#cb44-1068" aria-hidden="true" tabindex="-1"></a>                     veracity_numeric<span class="sc">*</span>condition_numeric <span class="sc">+</span></span>
<span id="cb44-1069"><a href="#cb44-1069" aria-hidden="true" tabindex="-1"></a>                     (<span class="dv">1</span> <span class="sc">+</span> veracity_numeric <span class="sc">|</span> unique_subject_id),</span>
<span id="cb44-1070"><a href="#cb44-1070" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> data, </span>
<span id="cb44-1071"><a href="#cb44-1071" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>)</span>
<span id="cb44-1072"><a href="#cb44-1072" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-1073"><a href="#cb44-1073" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb44-1074"><a href="#cb44-1074" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1075"><a href="#cb44-1075" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">round</span>(time[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">60</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb44-1076"><a href="#cb44-1076" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1077"><a href="#cb44-1077" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get a tidy version</span></span>
<span id="cb44-1078"><a href="#cb44-1078" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">tidy</span>(model, <span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-1079"><a href="#cb44-1079" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add time</span></span>
<span id="cb44-1080"><a href="#cb44-1080" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time_minutes =</span> time)</span>
<span id="cb44-1081"><a href="#cb44-1081" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1082"><a href="#cb44-1082" aria-hidden="true" tabindex="-1"></a>  <span class="co"># give nicer names in SDT terminology to estimates (! and reverse estimates for response bias !)</span></span>
<span id="cb44-1083"><a href="#cb44-1083" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> </span>
<span id="cb44-1084"><a href="#cb44-1084" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb44-1085"><a href="#cb44-1085" aria-hidden="true" tabindex="-1"></a>      <span class="co"># reverse c and delta c estimates</span></span>
<span id="cb44-1086"><a href="#cb44-1086" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimate =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">|</span> term <span class="sc">==</span> <span class="st">"condition_numeric"</span>, </span>
<span id="cb44-1087"><a href="#cb44-1087" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>estimate, estimate),</span>
<span id="cb44-1088"><a href="#cb44-1088" aria-hidden="true" tabindex="-1"></a>      <span class="at">term =</span> <span class="fu">case_when</span>(term <span class="sc">==</span> <span class="st">"(Intercept)"</span> <span class="sc">~</span> <span class="st">"average response bias (c)"</span>, </span>
<span id="cb44-1089"><a href="#cb44-1089" aria-hidden="true" tabindex="-1"></a>                       term <span class="sc">==</span> <span class="st">"veracity_numeric"</span> <span class="sc">~</span> <span class="st">"average sensitivity (d')"</span>, </span>
<span id="cb44-1090"><a href="#cb44-1090" aria-hidden="true" tabindex="-1"></a>                       term <span class="sc">==</span> <span class="st">"condition_numeric"</span> <span class="sc">~</span> <span class="st">"delta c"</span>,</span>
<span id="cb44-1091"><a href="#cb44-1091" aria-hidden="true" tabindex="-1"></a>                       term <span class="sc">==</span> <span class="st">"veracity_numeric:condition_numeric"</span> <span class="sc">~</span> <span class="st">"delta d'"</span>,</span>
<span id="cb44-1092"><a href="#cb44-1092" aria-hidden="true" tabindex="-1"></a>                       <span class="cn">TRUE</span> <span class="sc">~</span> term</span>
<span id="cb44-1093"><a href="#cb44-1093" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb44-1094"><a href="#cb44-1094" aria-hidden="true" tabindex="-1"></a>      <span class="at">sampling_variance =</span> std.error<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb44-1095"><a href="#cb44-1095" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb44-1096"><a href="#cb44-1096" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1097"><a href="#cb44-1097" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb44-1098"><a href="#cb44-1098" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1099"><a href="#cb44-1099" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-1100"><a href="#cb44-1100" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb44-1101"><a href="#cb44-1101" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_model &lt;- calculate_SDT_model(data %&gt;% filter(unique_experiment_id == "1_1"))</span></span>
<span id="cb44-1102"><a href="#cb44-1102" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_model</span></span>
<span id="cb44-1103"><a href="#cb44-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1104"><a href="#cb44-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1105"><a href="#cb44-1105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run the loop</span></span>
<span id="cb44-1106"><a href="#cb44-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1107"><a href="#cb44-1107" aria-hidden="true" tabindex="-1"></a>We then run a for loop, to calculate one model per experiment and store the results in a common data frame.</span>
<span id="cb44-1108"><a href="#cb44-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1111"><a href="#cb44-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1112"><a href="#cb44-1112" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over experiments</span></span>
<span id="cb44-1113"><a href="#cb44-1113" aria-hidden="true" tabindex="-1"></a>run_SDT_model_loop <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb44-1114"><a href="#cb44-1114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1115"><a href="#cb44-1115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make a vector with all unique experiment ids</span></span>
<span id="cb44-1116"><a href="#cb44-1116" aria-hidden="true" tabindex="-1"></a>  experiments <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb44-1117"><a href="#cb44-1117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(unique_experiment_id) <span class="sc">%&gt;%</span> </span>
<span id="cb44-1118"><a href="#cb44-1118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># slice(1:3) %&gt;% # to test loop</span></span>
<span id="cb44-1119"><a href="#cb44-1119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>()</span>
<span id="cb44-1120"><a href="#cb44-1120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1121"><a href="#cb44-1121" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb44-1122"><a href="#cb44-1122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-1123"><a href="#cb44-1123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># run one model per experiment and store the results in a common data frame</span></span>
<span id="cb44-1124"><a href="#cb44-1124" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> experiments <span class="sc">%&gt;%</span></span>
<span id="cb44-1125"><a href="#cb44-1125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_dfr</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-1126"><a href="#cb44-1126" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-1127"><a href="#cb44-1127" aria-hidden="true" tabindex="-1"></a>        <span class="co"># restrict data to only the respective experiment</span></span>
<span id="cb44-1128"><a href="#cb44-1128" aria-hidden="true" tabindex="-1"></a>        experiment <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(unique_experiment_id <span class="sc">==</span> x)</span>
<span id="cb44-1129"><a href="#cb44-1129" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-1130"><a href="#cb44-1130" aria-hidden="true" tabindex="-1"></a>        <span class="co"># extract paper id</span></span>
<span id="cb44-1131"><a href="#cb44-1131" aria-hidden="true" tabindex="-1"></a>        paper_id <span class="ot">&lt;-</span> <span class="fu">unique</span>(experiment<span class="sc">$</span>paper_id)</span>
<span id="cb44-1132"><a href="#cb44-1132" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-1133"><a href="#cb44-1133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># To keep track of progress</span></span>
<span id="cb44-1134"><a href="#cb44-1134" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"calculating model for experiment "</span>, x))</span>
<span id="cb44-1135"><a href="#cb44-1135" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-1136"><a href="#cb44-1136" aria-hidden="true" tabindex="-1"></a>        model_experiment <span class="ot">&lt;-</span> <span class="fu">calculate_SDT_model</span>(experiment) <span class="sc">%&gt;%</span></span>
<span id="cb44-1137"><a href="#cb44-1137" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">unique_experiment_id =</span> x,</span>
<span id="cb44-1138"><a href="#cb44-1138" aria-hidden="true" tabindex="-1"></a>                 <span class="at">paper_id =</span> paper_id)</span>
<span id="cb44-1139"><a href="#cb44-1139" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-1140"><a href="#cb44-1140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(model_experiment)</span>
<span id="cb44-1141"><a href="#cb44-1141" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb44-1142"><a href="#cb44-1142" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb44-1143"><a href="#cb44-1143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1144"><a href="#cb44-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Elapsed time: "</span>, <span class="fu">round</span>(time[<span class="dv">3</span>]<span class="sc">/</span><span class="dv">60</span>, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">" minutes"</span>))</span>
<span id="cb44-1145"><a href="#cb44-1145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1146"><a href="#cb44-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb44-1147"><a href="#cb44-1147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-1148"><a href="#cb44-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1149"><a href="#cb44-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1150"><a href="#cb44-1150" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb44-1151"><a href="#cb44-1151" aria-hidden="true" tabindex="-1"></a><span class="co"># experiment_ids_to_test &lt;- data %&gt;% distinct(unique_experiment_id) %&gt;% slice(1:5) %&gt;% pull()</span></span>
<span id="cb44-1152"><a href="#cb44-1152" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- run_SDT_model_loop(data%&gt;% filter(unique_experiment_id %in% experiment_ids_to_test))</span></span>
<span id="cb44-1153"><a href="#cb44-1153" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb44-1154"><a href="#cb44-1154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1155"><a href="#cb44-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1156"><a href="#cb44-1156" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run the meta-analysis</span></span>
<span id="cb44-1157"><a href="#cb44-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1160"><a href="#cb44-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1161"><a href="#cb44-1161" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate meta models</span></span>
<span id="cb44-1162"><a href="#cb44-1162" aria-hidden="true" tabindex="-1"></a>calculate_meta_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data, yi, vi, <span class="at">robust =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb44-1163"><a href="#cb44-1163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1164"><a href="#cb44-1164" aria-hidden="true" tabindex="-1"></a>  <span class="co"># provide metafor compatible names</span></span>
<span id="cb44-1165"><a href="#cb44-1165" aria-hidden="true" tabindex="-1"></a>  metafor_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb44-1166"><a href="#cb44-1166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">yi =</span> {{yi}}, </span>
<span id="cb44-1167"><a href="#cb44-1167" aria-hidden="true" tabindex="-1"></a>           <span class="at">vi =</span> {{vi}})</span>
<span id="cb44-1168"><a href="#cb44-1168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1169"><a href="#cb44-1169" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multilevel random effect model for accuracy</span></span>
<span id="cb44-1170"><a href="#cb44-1170" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span>  metafor<span class="sc">::</span><span class="fu">rma.mv</span>(yi, vi, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> paper_id <span class="sc">/</span> unique_experiment_id, </span>
<span id="cb44-1171"><a href="#cb44-1171" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> metafor_data)</span>
<span id="cb44-1172"><a href="#cb44-1172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1173"><a href="#cb44-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model)</span>
<span id="cb44-1174"><a href="#cb44-1174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1175"><a href="#cb44-1175" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(robust <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb44-1176"><a href="#cb44-1176" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with robust standard errors clustered at the paper level </span></span>
<span id="cb44-1177"><a href="#cb44-1177" aria-hidden="true" tabindex="-1"></a>    robust_model <span class="ot">&lt;-</span> <span class="fu">robust</span>(model, <span class="at">cluster =</span> data<span class="sc">$</span>paper_id)</span>
<span id="cb44-1178"><a href="#cb44-1178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-1179"><a href="#cb44-1179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(robust_model)</span>
<span id="cb44-1180"><a href="#cb44-1180" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-1181"><a href="#cb44-1181" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-1182"><a href="#cb44-1182" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb44-1183"><a href="#cb44-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1184"><a href="#cb44-1184" aria-hidden="true" tabindex="-1"></a><span class="co"># generate some model output</span></span>
<span id="cb44-1185"><a href="#cb44-1185" aria-hidden="true" tabindex="-1"></a><span class="co"># experiment_ids_to_test &lt;- data %&gt;% distinct(unique_experiment_id) %&gt;% slice(1:5) %&gt;% pull()</span></span>
<span id="cb44-1186"><a href="#cb44-1186" aria-hidden="true" tabindex="-1"></a><span class="co"># test_model_output &lt;- run_SDT_model_loop(data%&gt;% filter(unique_experiment_id %in% experiment_ids_to_test))</span></span>
<span id="cb44-1187"><a href="#cb44-1187" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1188"><a href="#cb44-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># # model for delta dprime</span></span>
<span id="cb44-1189"><a href="#cb44-1189" aria-hidden="true" tabindex="-1"></a><span class="co"># delta_dprime &lt;- calculate_meta_model(data = test_model_output  %&gt;% </span></span>
<span id="cb44-1190"><a href="#cb44-1190" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        filter(term == "delta d'"), yi = estimate, </span></span>
<span id="cb44-1191"><a href="#cb44-1191" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      vi = sampling_variance, robust = TRUE) %&gt;% </span></span>
<span id="cb44-1192"><a href="#cb44-1192" aria-hidden="true" tabindex="-1"></a><span class="co">#   tidy() %&gt;% </span></span>
<span id="cb44-1193"><a href="#cb44-1193" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(term = ifelse(term == "overall", "delta d'", NA))</span></span>
<span id="cb44-1194"><a href="#cb44-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1195"><a href="#cb44-1195" aria-hidden="true" tabindex="-1"></a><span class="co"># # model for delta c</span></span>
<span id="cb44-1196"><a href="#cb44-1196" aria-hidden="true" tabindex="-1"></a><span class="co"># delta_c &lt;- calculate_meta_model(data = test_model_output  %&gt;% </span></span>
<span id="cb44-1197"><a href="#cb44-1197" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   filter(term == "delta c"), yi = estimate, </span></span>
<span id="cb44-1198"><a href="#cb44-1198" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 vi = sampling_variance, robust = TRUE) %&gt;% </span></span>
<span id="cb44-1199"><a href="#cb44-1199" aria-hidden="true" tabindex="-1"></a><span class="co">#   tidy() %&gt;% </span></span>
<span id="cb44-1200"><a href="#cb44-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(term = ifelse(term == "overall", "delta c", NA))</span></span>
<span id="cb44-1201"><a href="#cb44-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1202"><a href="#cb44-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1203"><a href="#cb44-1203" aria-hidden="true" tabindex="-1"></a>We combine all these analysis steps in a single estimate function. </span>
<span id="cb44-1204"><a href="#cb44-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1207"><a href="#cb44-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1208"><a href="#cb44-1208" aria-hidden="true" tabindex="-1"></a><span class="co"># final function for running all models </span></span>
<span id="cb44-1209"><a href="#cb44-1209" aria-hidden="true" tabindex="-1"></a>get_meta_estimates <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb44-1210"><a href="#cb44-1210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1211"><a href="#cb44-1211" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate outcome data for all experiments</span></span>
<span id="cb44-1212"><a href="#cb44-1212" aria-hidden="true" tabindex="-1"></a>  outcome_data <span class="ot">&lt;-</span> <span class="fu">run_SDT_model_loop</span>(data)</span>
<span id="cb44-1213"><a href="#cb44-1213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1214"><a href="#cb44-1214" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate meta model for delta dprime</span></span>
<span id="cb44-1215"><a href="#cb44-1215" aria-hidden="true" tabindex="-1"></a>  delta_dprime <span class="ot">&lt;-</span> <span class="fu">calculate_meta_model</span>(<span class="at">data =</span> outcome_data  <span class="sc">%&gt;%</span> </span>
<span id="cb44-1216"><a href="#cb44-1216" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"delta d'"</span>), </span>
<span id="cb44-1217"><a href="#cb44-1217" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">yi =</span> estimate, </span>
<span id="cb44-1218"><a href="#cb44-1218" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">vi =</span> sampling_variance, </span>
<span id="cb44-1219"><a href="#cb44-1219" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-1220"><a href="#cb44-1220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-1221"><a href="#cb44-1221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"overall"</span>, <span class="st">"delta d'"</span>, <span class="cn">NA</span>))</span>
<span id="cb44-1222"><a href="#cb44-1222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1223"><a href="#cb44-1223" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate meta model for delta c</span></span>
<span id="cb44-1224"><a href="#cb44-1224" aria-hidden="true" tabindex="-1"></a>  delta_c <span class="ot">&lt;-</span> <span class="fu">calculate_meta_model</span>(<span class="at">data =</span> outcome_data  <span class="sc">%&gt;%</span> </span>
<span id="cb44-1225"><a href="#cb44-1225" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"delta c"</span>), </span>
<span id="cb44-1226"><a href="#cb44-1226" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">yi =</span> estimate, </span>
<span id="cb44-1227"><a href="#cb44-1227" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">vi =</span> sampling_variance, </span>
<span id="cb44-1228"><a href="#cb44-1228" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">robust =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-1229"><a href="#cb44-1229" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-1230"><a href="#cb44-1230" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">"overall"</span>, <span class="st">"delta c"</span>, <span class="cn">NA</span>))</span>
<span id="cb44-1231"><a href="#cb44-1231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1232"><a href="#cb44-1232" aria-hidden="true" tabindex="-1"></a>  estimates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(delta_dprime, delta_c)</span>
<span id="cb44-1233"><a href="#cb44-1233" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1234"><a href="#cb44-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(estimates)</span>
<span id="cb44-1235"><a href="#cb44-1235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1236"><a href="#cb44-1236" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-1237"><a href="#cb44-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1238"><a href="#cb44-1238" aria-hidden="true" tabindex="-1"></a><span class="co"># test </span></span>
<span id="cb44-1239"><a href="#cb44-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1240"><a href="#cb44-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce data to some experiments only</span></span>
<span id="cb44-1241"><a href="#cb44-1241" aria-hidden="true" tabindex="-1"></a><span class="co"># experiment_ids_to_test &lt;- data %&gt;% distinct(unique_experiment_id) %&gt;% slice(1:5) %&gt;% pull()</span></span>
<span id="cb44-1242"><a href="#cb44-1242" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1243"><a href="#cb44-1243" aria-hidden="true" tabindex="-1"></a><span class="co"># result &lt;- get_meta_estimates(data %&gt;% filter(unique_experiment_id %in% experiment_ids_to_test))</span></span>
<span id="cb44-1244"><a href="#cb44-1244" aria-hidden="true" tabindex="-1"></a><span class="co"># result</span></span>
<span id="cb44-1245"><a href="#cb44-1245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1246"><a href="#cb44-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1247"><a href="#cb44-1247" aria-hidden="true" tabindex="-1"></a><span class="fu">## Run iterations</span></span>
<span id="cb44-1248"><a href="#cb44-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1249"><a href="#cb44-1249" aria-hidden="true" tabindex="-1"></a>For each combination of effect sizes, we run several iterations, so that we can get an impression of how well different meta-analytic samples recover the parameters. For each iteration, the function first generates a set of studies to run the meta-analysis on, and then runs the meta-analysis. The results will be stored in a single data frame, in which iterations are labeled.</span>
<span id="cb44-1250"><a href="#cb44-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1253"><a href="#cb44-1253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1254"><a href="#cb44-1254" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat the process and store some information on it (e.g. time taken, number of iteration)</span></span>
<span id="cb44-1255"><a href="#cb44-1255" aria-hidden="true" tabindex="-1"></a>iterate <span class="ot">&lt;-</span> <span class="cf">function</span>(iterations, ...) {</span>
<span id="cb44-1256"><a href="#cb44-1256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1257"><a href="#cb44-1257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create data frame with model results for generated samples</span></span>
<span id="cb44-1258"><a href="#cb44-1258" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>iterations <span class="sc">%&gt;%</span></span>
<span id="cb44-1259"><a href="#cb44-1259" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_df</span>(<span class="cf">function</span>(x) {</span>
<span id="cb44-1260"><a href="#cb44-1260" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1261"><a href="#cb44-1261" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Measure time for each iteration</span></span>
<span id="cb44-1262"><a href="#cb44-1262" aria-hidden="true" tabindex="-1"></a>      iteration_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb44-1263"><a href="#cb44-1263" aria-hidden="true" tabindex="-1"></a>        <span class="co"># generate data</span></span>
<span id="cb44-1264"><a href="#cb44-1264" aria-hidden="true" tabindex="-1"></a>        participant_level_data <span class="ot">&lt;-</span> <span class="fu">simulate_data</span>(...)</span>
<span id="cb44-1265"><a href="#cb44-1265" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb44-1266"><a href="#cb44-1266" aria-hidden="true" tabindex="-1"></a>        <span class="co"># run models on the data</span></span>
<span id="cb44-1267"><a href="#cb44-1267" aria-hidden="true" tabindex="-1"></a>        estimates <span class="ot">&lt;-</span> <span class="fu">get_meta_estimates</span>(participant_level_data)</span>
<span id="cb44-1268"><a href="#cb44-1268" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb44-1269"><a href="#cb44-1269" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1270"><a href="#cb44-1270" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add iteration number and time in minutes to estimates</span></span>
<span id="cb44-1271"><a href="#cb44-1271" aria-hidden="true" tabindex="-1"></a>      estimates <span class="ot">&lt;-</span> estimates <span class="sc">%&gt;%</span></span>
<span id="cb44-1272"><a href="#cb44-1272" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">iteration =</span> x,</span>
<span id="cb44-1273"><a href="#cb44-1273" aria-hidden="true" tabindex="-1"></a>               <span class="at">time_taken_minutes =</span> iteration_time[<span class="dv">3</span>] <span class="sc">/</span> <span class="dv">60</span>)  <span class="co"># Convert time to minutes</span></span>
<span id="cb44-1274"><a href="#cb44-1274" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1275"><a href="#cb44-1275" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-1276"><a href="#cb44-1276" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {<span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"iteration number "</span>, x))}</span>
<span id="cb44-1277"><a href="#cb44-1277" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1278"><a href="#cb44-1278" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(estimates)</span>
<span id="cb44-1279"><a href="#cb44-1279" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-1280"><a href="#cb44-1280" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1281"><a href="#cb44-1281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb44-1282"><a href="#cb44-1282" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-1283"><a href="#cb44-1283" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb44-1284"><a href="#cb44-1284" aria-hidden="true" tabindex="-1"></a><span class="co"># note that even for just 10 meta-analyses, this takes quite a while, ~1min per iteration</span></span>
<span id="cb44-1285"><a href="#cb44-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- do.call(iterate, c(parameters, list(iterations = 4)))</span></span>
<span id="cb44-1286"><a href="#cb44-1286" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1287"><a href="#cb44-1287" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(test %&gt;% filter(term == "delta d'"), aes(x = estimate)) +</span></span>
<span id="cb44-1288"><a href="#cb44-1288" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram() +</span></span>
<span id="cb44-1289"><a href="#cb44-1289" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_vline(xintercept = parameters$beta_cv, linetype = "dotted", color = "black")</span></span>
<span id="cb44-1290"><a href="#cb44-1290" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1291"><a href="#cb44-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(test %&gt;% filter(term == "delta c"), aes(x = estimate)) +</span></span>
<span id="cb44-1292"><a href="#cb44-1292" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_histogram() +</span></span>
<span id="cb44-1293"><a href="#cb44-1293" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_vline(xintercept = -parameters$beta_c, linetype = "dotted", color = "black")</span></span>
<span id="cb44-1294"><a href="#cb44-1294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1295"><a href="#cb44-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1296"><a href="#cb44-1296" aria-hidden="true" tabindex="-1"></a><span class="fu"># Sensitivity analysis</span></span>
<span id="cb44-1297"><a href="#cb44-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1298"><a href="#cb44-1298" aria-hidden="true" tabindex="-1"></a>For a start, we will have three different effect sizes (small = 0.1, medium = 0.5, large = 1) and run 100 meta-analyses on each combination. We will check calculate the statistical power we have for each effect.</span>
<span id="cb44-1299"><a href="#cb44-1299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1302"><a href="#cb44-1302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1303"><a href="#cb44-1303" aria-hidden="true" tabindex="-1"></a><span class="co"># run sensitivity analysis</span></span>
<span id="cb44-1304"><a href="#cb44-1304" aria-hidden="true" tabindex="-1"></a>sensitivity_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(file_name, effect_sizes_to_try, iterations, ...) {</span>
<span id="cb44-1305"><a href="#cb44-1305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1306"><a href="#cb44-1306" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make full file name</span></span>
<span id="cb44-1307"><a href="#cb44-1307" aria-hidden="true" tabindex="-1"></a>  full_file_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"../data/simulations/"</span>, file_name)</span>
<span id="cb44-1308"><a href="#cb44-1308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-1309"><a href="#cb44-1309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only run analysis if a file with that name does not yet exists</span></span>
<span id="cb44-1310"><a href="#cb44-1310" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(full_file_name)) {</span>
<span id="cb44-1311"><a href="#cb44-1311" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-1312"><a href="#cb44-1312" aria-hidden="true" tabindex="-1"></a>    sensitivity_data <span class="ot">&lt;-</span> <span class="fu">pmap_df</span>(effect_sizes_to_try, <span class="cf">function</span>(delta_d_prime, delta_c) {</span>
<span id="cb44-1313"><a href="#cb44-1313" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1314"><a href="#cb44-1314" aria-hidden="true" tabindex="-1"></a>      <span class="co"># To keep track of progress</span></span>
<span id="cb44-1315"><a href="#cb44-1315" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"test for delta c = "</span>, delta_c, <span class="st">"; delta d' = "</span>, delta_d_prime))</span>
<span id="cb44-1316"><a href="#cb44-1316" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1317"><a href="#cb44-1317" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate the results for a specific combination of parameters</span></span>
<span id="cb44-1318"><a href="#cb44-1318" aria-hidden="true" tabindex="-1"></a>      combination_result <span class="ot">&lt;-</span>  <span class="fu">iterate</span>(<span class="at">iterations =</span> iterations, </span>
<span id="cb44-1319"><a href="#cb44-1319" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">beta_cv =</span> delta_d_prime, </span>
<span id="cb44-1320"><a href="#cb44-1320" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># make sure to reverse the data generating parameter for response bias</span></span>
<span id="cb44-1321"><a href="#cb44-1321" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">beta_c =</span> <span class="sc">-</span>delta_c, </span>
<span id="cb44-1322"><a href="#cb44-1322" aria-hidden="true" tabindex="-1"></a>                                     ...</span>
<span id="cb44-1323"><a href="#cb44-1323" aria-hidden="true" tabindex="-1"></a>                                     )</span>
<span id="cb44-1324"><a href="#cb44-1324" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1325"><a href="#cb44-1325" aria-hidden="true" tabindex="-1"></a>      <span class="co"># add combination of parameters to data frame</span></span>
<span id="cb44-1326"><a href="#cb44-1326" aria-hidden="true" tabindex="-1"></a>      combination_result <span class="ot">&lt;-</span> combination_result <span class="sc">%&gt;%</span> </span>
<span id="cb44-1327"><a href="#cb44-1327" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">parameter_delta_d_prime =</span> delta_d_prime, </span>
<span id="cb44-1328"><a href="#cb44-1328" aria-hidden="true" tabindex="-1"></a>               <span class="at">parameter_delta_c =</span> delta_c)</span>
<span id="cb44-1329"><a href="#cb44-1329" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb44-1330"><a href="#cb44-1330" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-1331"><a href="#cb44-1331" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-1332"><a href="#cb44-1332" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(sensitivity_data, full_file_name)</span>
<span id="cb44-1333"><a href="#cb44-1333" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-1334"><a href="#cb44-1334" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(sensitivity_data)</span>
<span id="cb44-1335"><a href="#cb44-1335" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-1336"><a href="#cb44-1336" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-1337"><a href="#cb44-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1338"><a href="#cb44-1338" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb44-1339"><a href="#cb44-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1340"><a href="#cb44-1340" aria-hidden="true" tabindex="-1"></a><span class="co"># the code below tests the function content, not the function itself</span></span>
<span id="cb44-1341"><a href="#cb44-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1342"><a href="#cb44-1342" aria-hidden="true" tabindex="-1"></a><span class="co"># # make a data frame with sample sizes</span></span>
<span id="cb44-1343"><a href="#cb44-1343" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_sizes_to_try &lt;- crossing(delta_d_prime = c(0.1, 1),</span></span>
<span id="cb44-1344"><a href="#cb44-1344" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 # reverse response bias estimates</span></span>
<span id="cb44-1345"><a href="#cb44-1345" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 delta_c = c(-0.1, -1))</span></span>
<span id="cb44-1346"><a href="#cb44-1346" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1347"><a href="#cb44-1347" aria-hidden="true" tabindex="-1"></a><span class="co"># # Remove initial parameters from list since we want to replace it</span></span>
<span id="cb44-1348"><a href="#cb44-1348" aria-hidden="true" tabindex="-1"></a><span class="co"># # with the respective effect size combination every time.</span></span>
<span id="cb44-1349"><a href="#cb44-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters[["beta_cv"]] &lt;- NULL</span></span>
<span id="cb44-1350"><a href="#cb44-1350" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters[["beta_c"]] &lt;- NULL</span></span>
<span id="cb44-1351"><a href="#cb44-1351" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1352"><a href="#cb44-1352" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- pmap_df(effect_sizes_to_try, function(delta_d_prime, delta_c) {</span></span>
<span id="cb44-1353"><a href="#cb44-1353" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1354"><a href="#cb44-1354" aria-hidden="true" tabindex="-1"></a><span class="co">#   # To keep track of progress</span></span>
<span id="cb44-1355"><a href="#cb44-1355" aria-hidden="true" tabindex="-1"></a><span class="co">#   print(paste("test for delta c = ", delta_c, "; delta d' = ", delta_d_prime))</span></span>
<span id="cb44-1356"><a href="#cb44-1356" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1357"><a href="#cb44-1357" aria-hidden="true" tabindex="-1"></a><span class="co">#   # calculate the results for a specific combination of parameters</span></span>
<span id="cb44-1358"><a href="#cb44-1358" aria-hidden="true" tabindex="-1"></a><span class="co">#   combination_result &lt;-  do.call(iterate, </span></span>
<span id="cb44-1359"><a href="#cb44-1359" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  c(parameters,</span></span>
<span id="cb44-1360"><a href="#cb44-1360" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    list(beta_cv = delta_d_prime, </span></span>
<span id="cb44-1361"><a href="#cb44-1361" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         # make sure to reverse the data generating parameter for response bias</span></span>
<span id="cb44-1362"><a href="#cb44-1362" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         beta_c = -delta_c), </span></span>
<span id="cb44-1363"><a href="#cb44-1363" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    list(iterations = 2)</span></span>
<span id="cb44-1364"><a href="#cb44-1364" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  )</span></span>
<span id="cb44-1365"><a href="#cb44-1365" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb44-1366"><a href="#cb44-1366" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1367"><a href="#cb44-1367" aria-hidden="true" tabindex="-1"></a><span class="co">#   # add combination of parameters to data frame</span></span>
<span id="cb44-1368"><a href="#cb44-1368" aria-hidden="true" tabindex="-1"></a><span class="co">#   combination_result &lt;- combination_result %&gt;% </span></span>
<span id="cb44-1369"><a href="#cb44-1369" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(parameter_delta_d_prime = delta_d_prime, </span></span>
<span id="cb44-1370"><a href="#cb44-1370" aria-hidden="true" tabindex="-1"></a><span class="co">#            parameter_delta_c = delta_c)</span></span>
<span id="cb44-1371"><a href="#cb44-1371" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1372"><a href="#cb44-1372" aria-hidden="true" tabindex="-1"></a><span class="co"># })</span></span>
<span id="cb44-1373"><a href="#cb44-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1374"><a href="#cb44-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1375"><a href="#cb44-1375" aria-hidden="true" tabindex="-1"></a>We first make changes to the parameter list. Since we are now varying the effect sizes of delta d' and delta c, we remove them from the orgininal parameter list. </span>
<span id="cb44-1376"><a href="#cb44-1376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1379"><a href="#cb44-1379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1380"><a href="#cb44-1380" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove initial parameters from list since we want to replace it</span></span>
<span id="cb44-1381"><a href="#cb44-1381" aria-hidden="true" tabindex="-1"></a><span class="co"># with the respective effect size combination every time.</span></span>
<span id="cb44-1382"><a href="#cb44-1382" aria-hidden="true" tabindex="-1"></a>parameters[[<span class="st">"beta_cv"</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb44-1383"><a href="#cb44-1383" aria-hidden="true" tabindex="-1"></a>parameters[[<span class="st">"beta_c"</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb44-1384"><a href="#cb44-1384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1385"><a href="#cb44-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1386"><a href="#cb44-1386" aria-hidden="true" tabindex="-1"></a>We can then run the sensitivity analysis. Note that while we could feed the whole data frame of <span class="in">`effect_sizes_to_try`</span> into the function, this would take very long. For each pair of effect sizes (i.e. one row in the data frame), the model takes approx. half a minute per iteration on my machine. </span>
<span id="cb44-1387"><a href="#cb44-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1390"><a href="#cb44-1390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1391"><a href="#cb44-1391" aria-hidden="true" tabindex="-1"></a><span class="co"># run sensitivity analysis</span></span>
<span id="cb44-1392"><a href="#cb44-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1393"><a href="#cb44-1393" aria-hidden="true" tabindex="-1"></a><span class="co"># you could just run this, but it would take reaaaally long</span></span>
<span id="cb44-1394"><a href="#cb44-1394" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_sizes_to_try &lt;- crossing(delta_d_prime = c(0.2, 0.5, 0.8),</span></span>
<span id="cb44-1395"><a href="#cb44-1395" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 delta_c = c(0.2, 0.5, 0.8))</span></span>
<span id="cb44-1396"><a href="#cb44-1396" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1397"><a href="#cb44-1397" aria-hidden="true" tabindex="-1"></a><span class="co"># do.call(sensitivity_analysis, c(parameters, </span></span>
<span id="cb44-1398"><a href="#cb44-1398" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 list(file_name = "sensitivity_analysis.csv", </span></span>
<span id="cb44-1399"><a href="#cb44-1399" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      effect_sizes_to_try = effect_sizes_to_try, </span></span>
<span id="cb44-1400"><a href="#cb44-1400" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      iterations = 2)</span></span>
<span id="cb44-1401"><a href="#cb44-1401" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb44-1402"><a href="#cb44-1402" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb44-1403"><a href="#cb44-1403" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1404"><a href="#cb44-1404" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- read_csv("data/sensitivity_analysis.csv")</span></span>
<span id="cb44-1405"><a href="#cb44-1405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1406"><a href="#cb44-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1407"><a href="#cb44-1407" aria-hidden="true" tabindex="-1"></a>Since I'm running this code locally on my computer, I have two different solutions. The first is to run the code in several chunks, exporting a each data frame and appending it to a common result data frame. To do this, we need to slightly modify the function from before. </span>
<span id="cb44-1408"><a href="#cb44-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1411"><a href="#cb44-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb44-1412"><a href="#cb44-1412" aria-hidden="true" tabindex="-1"></a><span class="co"># modified function to run the simulation chunk by chunk</span></span>
<span id="cb44-1413"><a href="#cb44-1413" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_analysis &lt;- function(file_name, effect_sizes_to_try, iterations, ...) {</span></span>
<span id="cb44-1414"><a href="#cb44-1414" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1415"><a href="#cb44-1415" aria-hidden="true" tabindex="-1"></a><span class="co">#   sensitivity_data &lt;- pmap_df(effect_sizes_to_try, function(delta_d_prime, delta_c) {</span></span>
<span id="cb44-1416"><a href="#cb44-1416" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb44-1417"><a href="#cb44-1417" aria-hidden="true" tabindex="-1"></a><span class="co">#     # To keep track of progress</span></span>
<span id="cb44-1418"><a href="#cb44-1418" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(paste("test for delta c = ", delta_c, "; delta d' = ", delta_d_prime))</span></span>
<span id="cb44-1419"><a href="#cb44-1419" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb44-1420"><a href="#cb44-1420" aria-hidden="true" tabindex="-1"></a><span class="co">#     # calculate the results for a specific combination of parameters</span></span>
<span id="cb44-1421"><a href="#cb44-1421" aria-hidden="true" tabindex="-1"></a><span class="co">#     combination_result &lt;-  iterate(iterations = iterations, </span></span>
<span id="cb44-1422"><a href="#cb44-1422" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    beta_cv = delta_d_prime, </span></span>
<span id="cb44-1423"><a href="#cb44-1423" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    # make sure to reverse the data generating parameter for response bias</span></span>
<span id="cb44-1424"><a href="#cb44-1424" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    beta_c = -delta_c, </span></span>
<span id="cb44-1425"><a href="#cb44-1425" aria-hidden="true" tabindex="-1"></a><span class="co">#                                    ...</span></span>
<span id="cb44-1426"><a href="#cb44-1426" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb44-1427"><a href="#cb44-1427" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb44-1428"><a href="#cb44-1428" aria-hidden="true" tabindex="-1"></a><span class="co">#     # add combination of parameters to data frame</span></span>
<span id="cb44-1429"><a href="#cb44-1429" aria-hidden="true" tabindex="-1"></a><span class="co">#     combination_result &lt;- combination_result %&gt;% </span></span>
<span id="cb44-1430"><a href="#cb44-1430" aria-hidden="true" tabindex="-1"></a><span class="co">#       mutate(parameter_delta_d_prime = delta_d_prime, </span></span>
<span id="cb44-1431"><a href="#cb44-1431" aria-hidden="true" tabindex="-1"></a><span class="co">#              parameter_delta_c = delta_c)</span></span>
<span id="cb44-1432"><a href="#cb44-1432" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb44-1433"><a href="#cb44-1433" aria-hidden="true" tabindex="-1"></a><span class="co">#   })</span></span>
<span id="cb44-1434"><a href="#cb44-1434" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1435"><a href="#cb44-1435" aria-hidden="true" tabindex="-1"></a><span class="co">#   # make full file name</span></span>
<span id="cb44-1436"><a href="#cb44-1436" aria-hidden="true" tabindex="-1"></a><span class="co">#   full_file_name &lt;- paste0("data/simulations/", file_name)</span></span>
<span id="cb44-1437"><a href="#cb44-1437" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1438"><a href="#cb44-1438" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Check if the CSV file already exists</span></span>
<span id="cb44-1439"><a href="#cb44-1439" aria-hidden="true" tabindex="-1"></a><span class="co">#   if (file.exists(full_file_name)) {</span></span>
<span id="cb44-1440"><a href="#cb44-1440" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Append to the existing CSV</span></span>
<span id="cb44-1441"><a href="#cb44-1441" aria-hidden="true" tabindex="-1"></a><span class="co">#     write_csv(sensitivity_data, full_file_name, append = TRUE)</span></span>
<span id="cb44-1442"><a href="#cb44-1442" aria-hidden="true" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb44-1443"><a href="#cb44-1443" aria-hidden="true" tabindex="-1"></a><span class="co">#     # Write a new CSV file if it doesn't exist</span></span>
<span id="cb44-1444"><a href="#cb44-1444" aria-hidden="true" tabindex="-1"></a><span class="co">#     write_csv(sensitivity_data, full_file_name)</span></span>
<span id="cb44-1445"><a href="#cb44-1445" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb44-1446"><a href="#cb44-1446" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1447"><a href="#cb44-1447" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(sensitivity_data)</span></span>
<span id="cb44-1448"><a href="#cb44-1448" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb44-1449"><a href="#cb44-1449" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb44-1450"><a href="#cb44-1450" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1451"><a href="#cb44-1451" aria-hidden="true" tabindex="-1"></a><span class="co"># # check current combinations</span></span>
<span id="cb44-1452"><a href="#cb44-1452" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- read_csv("data/simulations/sensitivity_analysis.csv")</span></span>
<span id="cb44-1453"><a href="#cb44-1453" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data %&gt;% distinct(parameter_delta_c, parameter_delta_d_prime)</span></span>
<span id="cb44-1454"><a href="#cb44-1454" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1455"><a href="#cb44-1455" aria-hidden="true" tabindex="-1"></a><span class="co"># # run sensitivity analysis chunk by chunk</span></span>
<span id="cb44-1456"><a href="#cb44-1456" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1457"><a href="#cb44-1457" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_sizes_to_try &lt;- crossing(delta_d_prime = c(0.1, 0.5, 1),</span></span>
<span id="cb44-1458"><a href="#cb44-1458" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 delta_c = c(0.1, 0.5, 1))</span></span>
<span id="cb44-1459"><a href="#cb44-1459" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1460"><a href="#cb44-1460" aria-hidden="true" tabindex="-1"></a><span class="co"># do.call(sensitivity_analysis, c(parameters, </span></span>
<span id="cb44-1461"><a href="#cb44-1461" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 list(file_name = "sensitivity_analysis.csv", </span></span>
<span id="cb44-1462"><a href="#cb44-1462" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      effect_sizes_to_try = effect_sizes_to_try %&gt;% </span></span>
<span id="cb44-1463"><a href="#cb44-1463" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        # modify this for new analyses</span></span>
<span id="cb44-1464"><a href="#cb44-1464" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        slice(1)</span></span>
<span id="cb44-1465"><a href="#cb44-1465" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        , </span></span>
<span id="cb44-1466"><a href="#cb44-1466" aria-hidden="true" tabindex="-1"></a><span class="co">#                                      iterations = 2)</span></span>
<span id="cb44-1467"><a href="#cb44-1467" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb44-1468"><a href="#cb44-1468" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb44-1469"><a href="#cb44-1469" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb44-1470"><a href="#cb44-1470" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity_data &lt;- read_csv("data/simulations/sensitivity_analysis.csv")</span></span>
<span id="cb44-1471"><a href="#cb44-1471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb44-1472"><a href="#cb44-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1473"><a href="#cb44-1473" aria-hidden="true" tabindex="-1"></a>The second option, which I have used for our project, is to run the simulation based on an R script in the console. This way, R can run the simulation in the background, while you can use the computer as normal (given that the computations are not too heavy for your computer to handle it all at the same time). To do so, we first copy all the function from this .qmd file to a separate .R script, which we call <span class="in">`sensitivity_simulation.R`</span>. </span>
<span id="cb44-1474"><a href="#cb44-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1475"><a href="#cb44-1475" aria-hidden="true" tabindex="-1"></a>We then run this script in the terminal (<span class="in">`Rscript sensitivity_simulation.R`</span>), by making sure to specify the correct project working directory (<span class="in">`cd YOUR/DIRECTORY`</span>). </span>
<span id="cb44-1476"><a href="#cb44-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1477"><a href="#cb44-1477" aria-hidden="true" tabindex="-1"></a>If you do this, make sure to not let your computer go to sleep, e.g. by using <span class="co">[</span><span class="ot">'caffeinate'</span><span class="co">](https://www.theapplegeek.co.uk/blog/caffeinate)</span>, or <span class="co">[</span><span class="ot">amphetamine</span><span class="co">](https://apps.apple.com/us/app/amphetamine/id937984704?mt=12)</span>. </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Content <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2025 by Jan Pfänder<br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/janpfander/meta_misinformation_interventions">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>